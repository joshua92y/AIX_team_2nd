{% load static %}
{% load humanize %}
<!-- report_partial.html ë¦¬íŒ©í† ë§: ìƒê¶Œ ë¶„ì„ ë³´ê³ ì„œ -->
<div id="report-section" class="space-y-8">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">

  <!-- 1. í—¤ë”: ê¸°ë³¸ ì •ë³´ -->
  <section class="bg-white p-6 rounded shadow">
    <h2 class="text-2xl font-bold text-blue-800 mb-2">ğŸ“ ìƒê¶Œ ë¶„ì„ ê²°ê³¼</h2>
    <p><strong>ì£¼ì†Œ:</strong> {{ input.ì£¼ì†Œ }}</p>
    <p><strong>ì—…ì¢…:</strong> {{ input.ì—…ì¢… }}</p>
    <p><strong>ë©´ì :</strong> {{ input.ë©´ì  }}ã¡</p>
    <p><strong>ë¶„ì„ ë°˜ê²½:</strong> 100m</p>
    <p><strong>ë¶„ì„ì¼:</strong> {{ analyzed_date }}</p>
  </section>

  <!-- 2. í•µì‹¬ ì§€í‘œ ì¹´ë“œ + ìƒì¡´ í™•ë¥  -->
  <section class="grid grid-cols-2 md:grid-cols-4 gap-4">
    <div class="bg-blue-50 p-4 rounded shadow text-center">
      <h4 class="text-sm text-gray-600">ìœ ì‚¬ì—…ì¢… ìˆ˜</h4>
      <p class="text-xl font-bold text-blue-800">{{ features.ìœ ì‚¬ì—…ì¢…ìˆ˜_300m }}</p>
    </div>
    <div class="bg-blue-50 p-4 rounded shadow text-center">
      <h4 class="text-sm text-gray-600">ì „ì²´ ìŒì‹ì—…ì²´ ìˆ˜</h4>
      <p class="text-xl font-bold text-blue-800">{{ features.ì „ì²´ìŒì‹ì—…ì²´ìˆ˜ }}</p>
    </div>
    <div class="bg-blue-50 p-4 rounded shadow text-center">
      <h4 class="text-sm text-gray-600">ì§ì¥ì¸êµ¬ìˆ˜</h4>
      <p class="text-xl font-bold text-blue-800">{{ features.ì§ì¥ì¸êµ¬ìˆ˜ }}</p>
    </div>
    <div class="bg-green-50 p-4 rounded shadow text-center">
      <h4 class="text-sm text-gray-600">ìƒì¡´ í™•ë¥ </h4>
      <p class="text-xl font-bold text-green-700">{{ survival_prob_percent }}%</p>
    </div>
    <div class="bg-blue-50 p-4 rounded shadow text-center">
      <h4 class="text-sm text-gray-600">ê³µì‹œì§€ê°€ (â‚©)</h4>
      <p class="text-xl font-bold text-blue-800">{{ features.ê³µì‹œì§€ê°€|intcomma }}</p>
    </div>
  </section>

  <!-- 3. ìœ ë™ì¸êµ¬ ì‹œê°í™” -->
  <section class="bg-white p-6 rounded shadow">
    <h3 class="text-lg font-semibold mb-2">ğŸ‘£ ìœ ë™ ì¸êµ¬ êµ¬ì„±</h3>
    <canvas id="populationDonut"
      data-pop20="{{ features.ìœ ë™ì¸êµ¬.20ëŒ€ }}"
      data-pop30="{{ features.ìœ ë™ì¸êµ¬.30ëŒ€ }}"
      data-pop40="{{ features.ìœ ë™ì¸êµ¬.40ëŒ€ }}"
      data-pop50="{{ features.ìœ ë™ì¸êµ¬.50ëŒ€ }}"
      class="w-full max-w-md mx-auto"></canvas>
  </section>

  <!-- 4. SHAP ê¸°ì—¬ë„ ì‹œê°í™” -->
  <section class="bg-white p-6 rounded shadow">
    <h3 class="text-lg font-semibold mb-2">ğŸ“ˆ ì£¼ìš” í”¼ì²˜ ê¸°ì—¬ë„ (SHAP)</h3>
    <canvas id="shapChart" data-shap='{{ shap_json|safe }}'></canvas>
  </section>

  <!-- 5. ì£¼ë³€ ì‹œì„¤ -->
  <section class="grid grid-cols-2 gap-4 bg-white p-6 rounded shadow">
    <div class="text-center">
      <h4 class="text-sm text-gray-600">ê³µê³µì‹œì„¤ ìˆ˜</h4>
      <p class="text-xl font-bold">{{ features.ê³µê³µì‹œì„¤ìˆ˜ }}ê°œ</p>
    </div>
    <div class="text-center">
      <h4 class="text-sm text-gray-600">í•™êµ ìˆ˜</h4>
      <p class="text-xl font-bold">{{ features.í•™êµìˆ˜ }}ê°œ</p>
    </div>
  </section>

  <!-- 6. ìƒê¶Œ ê²½ìŸ ë¶„ì„ -->
  <section class="bg-white p-6 rounded shadow">
    <h3 class="text-lg font-semibold mb-4">ğŸ“Š ìƒê¶Œ ê²½ìŸ ë¶„ì„ (300m ë°˜ê²½)</h3>
    <div class="grid grid-cols-3 gap-4 text-center">
      <div>
        <p class="text-sm text-gray-600">ì „ì²´ ìŒì‹ì—…ì²´ ìˆ˜</p>
        <p class="text-lg font-bold">{{ features.ì „ì²´ìŒì‹ì—…ì²´ìˆ˜ }}</p>
      </div>
      <div>
        <p class="text-sm text-gray-600">ê²½ìŸì—…ì²´ ë¹„ìœ¨</p>
        <p class="text-lg font-bold">{{ features.ê²½ìŸë¹„ìœ¨|floatformat:1 }}%</p>
      </div>
      <div>
        <p class="text-sm text-gray-600">ì—…ì¢… ë‹¤ì–‘ì„±</p>
        <p class="text-lg font-bold">{{ features.ì—…ì¢…ë‹¤ì–‘ì„± }}ì¢…ë¥˜</p>
      </div>
    </div>
  </section>

  <!-- 7. AI ì¸ì‚¬ì´íŠ¸ ìš”ì•½ -->
  <section class="bg-yellow-50 p-6 rounded shadow">
    <h3 class="text-lg font-semibold text-yellow-900 mb-2">ğŸ¤– AI ë¶„ì„ ìš”ì•½</h3>
    <p><strong>ğŸ“‰ ë¦¬ìŠ¤í¬:</strong> {{ insight.risk }}</p>
    <p><strong>ğŸ’¡ ì „ëµ:</strong> {{ insight.strategy }}</p>
    <p><strong>ğŸ“Œ ìš”ì•½:</strong> {{ insight.summary }}</p>
  </section>

</div>
<!-- ì €ì¥ ë²„íŠ¼ ì¶”ê°€ -->
  <div class="text-center mt-6">
    <button id="save-pdf-button" class="btn btn-primary mt-4">PDFë¡œ ì €ì¥</button>
  </div>
</div>