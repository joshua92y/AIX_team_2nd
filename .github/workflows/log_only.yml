name: Log Commits

on:
  push:
    branches:
      - joshua  # ë˜ëŠ” 'master' ë“± ì‚¬ìš© ì¤‘ì¸ ë¸Œëžœì¹˜ ì´ë¦„

permissions:
  contents: write  # ë¡œê·¸ë¥¼ ì»¤ë°‹í•˜ë ¤ë©´ write ê¶Œí•œ í•„ìš”
  packages: write

jobs:
  log-job:
    runs-on: ubuntu-latest

    steps:
      - name: Show simple log
        run: |
          echo "âœ… GitHub Actions workflow triggered!"
          echo "ðŸ•’ Timestamp: $(date)"
          echo "ðŸ“¦ Repository: ${{ github.repository }}"
          echo "ðŸ‘¤ Triggered by: ${{ github.actor }}"

      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Git user
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions@github.com"

      - name: Extract commit info
        if: "!contains(github.event.head_commit.message, '[bot]')"  # ë´‡ ì»¤ë°‹ ì œì™¸
        run: |
          AUTHOR_NAME=$(git log -1 --pretty=format:"%an" | tr -d ' ')
          FILENAME="commit-log-${AUTHOR_NAME}.txt"
          echo "==== New Push ====" >> $FILENAME
          echo "Time: $(date '+%Y-%m-%d %H:%M:%S')" >> $FILENAME
          git log -1 --pretty=format:"Author: %an%nMessage: %s%nCommit: %H%n" >> $FILENAME
          echo "" >> $FILENAME

      - name: Commit and push log file
        if: "!contains(github.event.head_commit.message, '[bot]')"  # ë´‡ ì»¤ë°‹ ì œì™¸
        run: |
          git add commit-log.txt
          git commit -m "Update commit-log.txt [bot]" || echo "No changes to commit"
          git push
