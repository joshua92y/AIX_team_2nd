{% extends 'base.html' %}
{% load static %}

{% block title %}상권분석 LocaAI 챗봇{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/chat_styles.css' %}">
{% endblock %}

{% block content %}
<div class="container mt-3 mb-3">
  <h3 class="text-center mb-3">LocaAI 챗봇</h3>

  <div class="chat-interface-container">
    <div class="chat-messages-area" id="chatMessagesArea">
      <!-- 메시지가 여기에 동적으로 추가됩니다 -->
    </div>

    <div id="typingIndicator" class="message-entry typing-indicator-message" style="display: none;">
      <div class="message-bubble">
        답변을 생성 중입니다... 
        <span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true"></span>
      </div>
    </div>

    <div class="chat-input-area">
      <textarea
        id="messageInput"
        class="form-control"
        placeholder="메시지를 입력하세요..."
        rows="1"
        aria-label="메시지 입력"
      ></textarea>
      <button id="sendButton" class="btn btn-primary" type="button" aria-label="메시지 전송">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>
</div>

<!-- ✅ JSON 데이터 스크립트: JavaScript에서 JSON.parse로 안전하게 읽을 수 있음 -->
{{ user_info|json_script:"user-info-data" }}

<!-- ✅ DEBUG 확인용 콘솔 로그 -->
<script>
  console.log("🧪 Template user_id:", "{{ request.user.id }}");
</script>
{% endblock %}

{% block js %}
<script src="{% static 'js/chat_main.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
{% endblock %}
