{% extends 'base.html' %}
{% load static %}

{% block title %}ìƒê¶Œë¶„ì„ LocaAI ì±—ë´‡{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/chat_styles.css' %}">
{% endblock %}

{% block content %}
<div class="container mt-3 mb-3">
  <h3 class="text-center mb-3">LocaAI ì±—ë´‡</h3>

  <div class="chat-interface-container">
    <div class="chat-messages-area" id="chatMessagesArea">
      <!-- ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
    </div>

    <div id="typingIndicator" class="message-entry typing-indicator-message" style="display: none;">
      <div class="message-bubble">
        ë‹µë³€ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤... 
        <span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true"></span>
      </div>
    </div>

    <div class="chat-input-area">
      <textarea
        id="messageInput"
        class="form-control"
        placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
        rows="1"
        aria-label="ë©”ì‹œì§€ ì…ë ¥"
      ></textarea>
      <button id="sendButton" class="btn btn-primary" type="button" aria-label="ë©”ì‹œì§€ ì „ì†¡">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>
</div>

<!-- âœ… JSON ë°ì´í„° ìŠ¤í¬ë¦½íŠ¸: JavaScriptì—ì„œ JSON.parseë¡œ ì•ˆì „í•˜ê²Œ ì½ì„ ìˆ˜ ìˆìŒ -->
{{ user_info|json_script:"user-info-data" }}

<!-- âœ… DEBUG í™•ì¸ìš© ì½˜ì†” ë¡œê·¸ -->
<script>
  console.log("ğŸ§ª Template user_id:", "{{ request.user.id }}");
</script>
{% endblock %}

{% block js %}
<script src="{% static 'js/chat_main.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
{% endblock %}
