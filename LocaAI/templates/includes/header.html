{% load static %}
<header id="header" class="header d-flex align-items-center fixed-top">
  <div class="container-fluid container-xl position-relative d-flex align-items-center">

    <a href="{% url 'index' %}" class="logo d-flex align-items-center me-auto">
      <img src="{% static 'assets/img/logo.png' %}" alt="">
      <h1 class="sitename">Loca Ai</h1>
    </a>

    <nav id="navmenu" class="navmenu">
      <ul>
        <li><a href="{% url 'index' %}" class="active">Home</a></li>
        <li><a href="/#about">About</a></li>
        <li><a href="{% url 'AI_Analyzer:analyze_page' %}">Services</a></li>
        <li><a href="{% url 'shopdash:dashboard' %}">Data</a></li>
        <li><a href="{% url 'border:portfolio_list' %}">Portfolio</a></li>
        <li><a href="/#contact">Contact Us</a></li>
        <li class="dropdown"><a href="javascript:void(0);"><span>Support</span><i class="bi bi-chevron-down toggle-dropdown"></i></a>
          <ul>
            <li><a href="#">guide book</a></li>
            <li><a href="{% url 'border:notice_list' %}">notice</a></li>
            <li><a href="{% url 'border:inquiry_list' %}">customer board</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#"><span>Language</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
          <ul> 
            <li><a href="#" onclick="setSelectedLangValue('KOR'); return false;">ğŸ‡°ğŸ‡· í•œêµ­ì–´</a></li>
            <li><a href="#" onclick="setSelectedLangValue('ENG'); return false;">ğŸ‡ºğŸ‡¸ ì˜ì–´</a></li>
            <li><a href="#" onclick="setSelectedLangValue('ESP'); return false;">ğŸ‡ªğŸ‡¸ ìŠ¤í˜ì¸ì–´</a></li>
          </ul>
        </li>
      </ul>
      
      <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
    </nav>

    {% if request.user.is_authenticated %}
      <!-- ë¡œê·¸ì¸í•œ ê²½ìš° - ì‚¬ìš©ì í”„ë¡œí•„ ë“œë¡­ë‹¤ìš´ -->
      <div class="user-profile-dropdown">
        <a href="#" class="user-profile-toggle d-flex align-items-center text-decoration-none" id="userProfileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          <div class="user-avatar me-2">
            <i class="bi bi-person-circle fs-4 text-primary"></i>
          </div>
          <span class="user-name text-dark fw-medium">{{ request.user.username }}</span>
          <i class="bi bi-chevron-down ms-2"></i>
        </a>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userProfileDropdown">
          <li><a class="dropdown-item" href="{% url 'custom_auth:mypage' %}"><i class="bi bi-person me-2"></i>ë§ˆì´í˜ì´ì§€</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" href="{% url 'custom_auth:logout' %}"><i class="bi bi-box-arrow-right me-2"></i>ë¡œê·¸ì•„ì›ƒ</a></li>
        </ul>
      </div>
    {% else %}
     <!-- ë¹„ë¡œê·¸ì¸í•œ ê²½ìš° -->
      <a class="btn-getstarted flex-md-shrink-0" href="{% url 'custom_auth:login' %}?next={{ request.path }}">Get Started</a>
    {% endif %}

  </div>

  <style>
    .user-profile-dropdown {
      position: relative;
    }
    
    .user-profile-toggle {
      padding: 0.5rem 1rem;
      border-radius: 25px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }
    
    .user-profile-toggle:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-1px);
    }
    
    .user-avatar i {
      color: #47b2e4;
    }
    
    .dropdown-menu {
      border: none;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      border-radius: 10px;
      padding: 0.5rem 0;
      margin-top: 0.5rem;
    }
    
    .dropdown-item {
      padding: 0.75rem 1.5rem;
      transition: all 0.3s ease;
    }
    
    .dropdown-item:hover {
      background: #f8f9fa;
      transform: translateX(5px);
    }
    
    .dropdown-item i {
      width: 20px;
    }
  </style>

  <script>
    // ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì •í•˜ì—¬ ì¤‘ë³µ ì„ ì–¸ ë°©ì§€
    if (typeof window.sessionLang === 'undefined') {
      window.sessionLang = "{{ request.session.language|default:'KOR' }}";
    }

		$(window).ready(function() {
		  funcChangeLang(window.sessionLang);
		})
    
    // ì„ íƒí•œ ì–¸ì–´ë¥¼ ì„¸ì…˜ì— ì €ì¥í•˜ëŠ” function
    function setSelectedLangValue(lang) {
      $.ajax({
        type: 'POST',
        url: '/set-lang/',
        data: {
          "lang": lang
        },
        headers: {
          'X-CSRFToken': getCSRFToken()   // í† í°ì¶”ê°€
        },
        success: function(res) {
          window.sessionLang = lang;    // ì „ì—­ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
          funcChangeLang(lang);         // UI ì „í™˜
          console.log(res.code, res.message, 'session lang changed to', lang)
        },
        error: function(xhr, status, error) {
          console.log('session lang change error', lang)
        }
      });
    }

    // ì–¸ì–´ ë³€ê²½ í•¨ìˆ˜
    function funcChangeLang(lang) {
      console.log("funcChangeLang ì‹¤í–‰ë¨:", lang); // ì½˜ì†”ì— ì¶œë ¥ í™•ì¸
			$('[data-lang]').hide();
			$('[data-lang="'+lang+'"]').show();
		}
        
    // CSRF í† í°ì„ ê°€ì ¸ì˜¤ëŠ” function
    function getCSRFToken() {
      return document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    }
  </script>
</header>
