{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}ìƒê¶Œ ë¶„ì„{% endblock %}

{% block content %}


  <!-- AI Analyzer CSS íŒŒì¼ë“¤ -->
  <link rel="stylesheet" href="{% static 'css/ai_analyzer/analyze-base.css' %}">
  <link rel="stylesheet" href="{% static 'css/ai_analyzer/analyze-progress.css' %}">
  <link rel="stylesheet" href="{% static 'css/ai_analyzer/analyze-chatbot.css' %}">
  <link rel="stylesheet" href="{% static 'css/ai_analyzer/analyze-pip.css' %}">

  <!-- Daum ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤ -->
  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  
  <!-- ì¹´ì¹´ì˜¤ë§µ API -->
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey={{ KAKAO_JS_API_KEY }}&libraries=services"></script>
  
  <!-- OpenLayers 10.6.1 ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.6.1/ol.css" type="text/css">
  <script src="https://cdn.jsdelivr.net/npm/ol@v10.6.1/dist/ol.js"></script>
  
  <!-- jsPDF ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- í•œêµ­ì–´ í°íŠ¸ ì§€ì› -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf-customfonts@0.0.4/dist/jspdf-customfonts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-customfonts@0.0.4/dist/customfonts.js"></script>
  <!-- html2canvas ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <!-- Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- AI Analyzer Data ë¡œë“œ (ìµœìš°ì„ ) -->
  <script src="{% static 'js/ai_analyzer/analyze-data.js' %}"></script>
  
  <!-- AI Analyzer Utils ë¡œë“œ -->
  <script src="{% static 'js/ai_analyzer/analyze-utils.js' %}"></script>
  
  <!-- AI Analyzer Address ë¡œë“œ -->
  <script src="{% static 'js/ai_analyzer/analyze-address.js' %}"></script>
  
  <!-- AI Analyzer Map ë¡œë“œ -->
  <script src="{% static 'js/ai_analyzer/analyze-map.js' %}"></script>
  
  <!-- AI Analyzer OpenLayers Map ë¡œë“œ -->
  <script src="{% static 'js/ai_analyzer/analyze-openmap.js' %}"></script>
  
  <!-- AI Analyzer PIP ë¡œë“œ -->
  <script src="{% static 'js/ai_analyzer/analyze-pip.js' %}"></script>
  
  <!-- AI Analyzer PDF ë¡œë“œ -->
  <script src="{% static 'js/ai_analyzer/analyze-pdf.js' %}"></script>
  
  <!-- AI Analyzer Chatbot ë¡œë“œ -->
  <script src="{% static 'js/ai_analyzer/analyze-chatbot.js' %}"></script>
  
  <!-- AI Analyzer Explainable AI ë¡œë“œ (íšŒì›ìš© XGBoost ì„¤ëª…) -->
  <script src="{% static 'js/ai_analyzer/analyze-explainable.js' %}"></script>
  
  <!-- AI Analyzer Core ë¡œë“œ -->
  <script src="{% static 'js/ai_analyzer/analyze-core.js' %}"></script>
  
  <!-- AI Analyzer ë‹¤êµ­ì–´ ì§€ì› ë¡œë“œ -->
  <script src="{% static 'js/ai_analyzer/analyze-i18n.js' %}"></script>

    <script>
    // Django í…œí”Œë¦¿ì—ì„œ JavaScript ë³€ìˆ˜ë¡œ ì‚¬ìš©ì ì¸ì¦ ìƒíƒœ ì „ë‹¬
    const USER_AUTHENTICATED = {% if user.is_authenticated %}true{% else %}false{% endif %};
    const USER_ID = {% if user.is_authenticated %}'{{ user.id }}'{% else %}null{% endif %};
    const CSRF_TOKEN = '{{ csrf_token }}';
    
    // ì¹´ì¹´ì˜¤ë§µ API í‚¤ (analyze-map.jsì—ì„œ ì‚¬ìš©)
    window.KAKAO_JS_API_KEY = '{{ KAKAO_JS_API_KEY }}';
    window.KAKAO_REST_API_KEY = '{{ KAKAO_REST_API_KEY }}';
  </script>

  <script>
    window.currentAnalysisData = null;
    
    $(document).ready(function() {
      // ì´ˆê¸°í™”
      $('.result-section').hide();
      $('#analysisResults').hide();
      
      // PIP ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” ë™ì  ìƒì„± ì‹œ ì¶”ê°€ë¨
      
      // ë‹¤êµ­ì–´ ì§€ì› ì´ˆê¸°í™”
      if (typeof initializeLanguageSupport === 'function') {
        initializeLanguageSupport();
      }
    });

    $(window).on('load', function() {
      _eventBind();
    });

    // í˜ì´ì§€ ë‚´ ì´ë²¤íŠ¸ ë°”ì¸ë”©
    function _eventBind() {
      // ëª¨ë“ˆ ë¡œë“œ í›„ ì±—ë´‡ ì´ˆê¸°í™” (ì§€ì—° ì‹¤í–‰)
      setTimeout(function() {
        // ì±—ë´‡ ì´ˆê¸° ìƒíƒœ ì„¤ì •
        if (typeof window.initializeChatbotState === 'function') {
          window.initializeChatbotState();
        }
        
        // WebSocket ì´ˆê¸°í™” (ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œ)
        if (USER_AUTHENTICATED && typeof window.initializeChatSocket === 'function') {
          window.initializeChatSocket();
        }
      }, 100);
    }

    // ===========================================
    // ëª¨ë“  ì£¼ìš” ê¸°ëŠ¥ë“¤ì€ ë‹¤ìŒ ëª¨ë“ˆë“¤ì—ì„œ ë¡œë“œë¨:
    // - analyze-core.js: ìƒê¶Œë¶„ì„ ë©”ì¸ ë¡œì§
    // - analyze-chatbot.js: ì±—ë´‡ ë° WebSocket  
    // - analyze-pip.js: PIP ëª¨ë‹¬ ê´€ë¦¬
    // - analyze-pdf.js: PDF ìƒì„±
    // - analyze-address.js: ì£¼ì†Œ ê²€ìƒ‰
    // - analyze-utils.js: ê³µí†µ ìœ í‹¸ë¦¬í‹°
    // ===========================================
    
    // ì „ì—­ ë³€ìˆ˜ ì„ ì–¸ ë° ë””ë²„ê¹… í•¨ìˆ˜
    window.debugPDF = function() {
      console.log('ğŸ” [DEBUG] PDF ë””ë²„ê¹… ì •ë³´:');
      console.log('- window.currentRequestId:', window.currentRequestId);
      console.log('- window.currentAnalysisData:', window.currentAnalysisData);
      
      // currentAnalysisDataê°€ ìˆìœ¼ë©´ ìƒì„¸ ì •ë³´ í™•ì¸
      if (window.currentAnalysisData) {
        console.log('- currentAnalysisData.request:', window.currentAnalysisData.request);
        console.log('- currentAnalysisData.request.id:', window.currentAnalysisData.request?.id);
        
        // currentRequestIdê°€ nullì´ë©´ currentAnalysisDataì—ì„œ ì¶”ì¶œ ì‹œë„
        if (!window.currentRequestId && window.currentAnalysisData.request?.id) {
          console.log('ğŸ”§ [FIX] currentRequestIdë¥¼ currentAnalysisDataì—ì„œ ë³µêµ¬ ì‹œë„...');
          window.currentRequestId = window.currentAnalysisData.request.id;
          console.log('âœ… currentRequestId ë³µêµ¬ë¨:', window.currentRequestId);
        }
      }
      
      console.log('- typeof generatePDF:', typeof generatePDF);
      if (window.currentRequestId) {
        console.log('âœ… currentRequestIdê°€ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
      } else {
        console.log('âŒ currentRequestIdê°€ nullì´ê±°ë‚˜ undefinedì…ë‹ˆë‹¤.');
      }
    };
    
    // ... existing code ...
  </script>

  <!-- Page Title -->
  <div class="container my-6" style="margin-top: 20px; margin-bottom: 100px; ">
          
      <!-- ìƒê¶Œ ë¶„ì„ ì •ë³´ ì…ë ¥ -->
    <div class="row">
      <div class="col-lg-12 mb-4">
        <div class="card p-4 shadow-sm">
          <h3 class="mb-3">
            <span data-lang="KOR">ìƒê¶Œ ì •ë³´ì…ë ¥</span>
            <span data-lang="ENG" style="display: none;">Enter Commercial Area Info</span>
            <span data-lang="ESP" style="display: none;">Ingresar InformaciÃ³n del Ãrea Comercial</span>
          </h3>

          <form>
            <div class="row g-3">
              <!-- ì—…ì¢… ì„ íƒ -->
              <div class="col-md-3">
                <label for="business_type_id" class="form-label">
                  <span data-lang="KOR">ì—…ì¢…</span>
                  <span data-lang="ENG" style="display: none;">Industry</span>
                  <span data-lang="ESP" style="display: none;">Industria</span>
                </label>
                <select class="form-select" id="business_type_id" name="business_type_id" required>
                  <!-- ì—…ì¢… ì˜µì…˜ì€ analyze-data.jsì—ì„œ ë™ì  ìƒì„± -->
                </select>
                
                <!-- ì˜ì–´/ìŠ¤í˜ì¸ì–´ ì—…ì¢… ì„ íƒì€ analyze-data.jsì—ì„œ ë™ì  ì²˜ë¦¬ -->
              </div>

              <!-- ì£¼ì†Œ ì…ë ¥ -->
              <div class="col-md-3">
                <input type="hidden" id="latitude" name="latitude">
                <input type="hidden" id="longitude" name="longitude">
                <input type="hidden" id="x_coord" name="x_coord">
                <input type="hidden" id="y_coord" name="y_coord">
                
                <label for="address" class="form-label" data-lang="KOR">ì£¼ì†Œ</label>
                <label for="address" class="form-label" data-lang="ENG" style="display: none;">Address</label>
                <label for="address" class="form-label" data-lang="ESP" style="display: none;">DirecciÃ³n</label>
                
                <div class="input-group">
                  <input type="text" class="form-control" id="address" name="address" placeholder="ì„œìš¸íŠ¹ë³„ì‹œ ë‚´ ì£¼ì†Œë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”" readonly onclick="openAddressSearch()" style="cursor: pointer;" data-i18n-placeholder="address-search">
                  <button class="btn btn-outline-secondary" type="button" onclick="openAddressSearch()">
                    <i class="bi bi-search me-1"></i>
                    <span data-lang="KOR">ê²€ìƒ‰</span>
                    <span data-lang="ENG" style="display: none;">Search</span>
                    <span data-lang="ESP" style="display: none;">Buscar</span>
                  </button>
                </div>
              </div>

              <!-- ì í¬ ë©´ì  ì…ë ¥ -->
              <div class="col-md-3">
                <label for="area" class="form-label" data-lang="KOR">ì í¬ ë©´ì  (ã¡)</label>
                <label for="area" class="form-label" data-lang="ENG" style="display: none;">Store Area (ã¡)</label>
                <label for="area" class="form-label" data-lang="ESP" style="display: none;">Ãrea del local (ã¡)</label>
                <input type="number" class="form-control" id="area" name="area" placeholder="ì˜ˆ: 33.2" required data-i18n-placeholder="area-example">
              </div>

              <!-- ì£¼ë¥˜ íŒë§¤ ì—¬ë¶€ ì„ íƒ -->
              <div class="col-md-3">
                <label for="service_type" class="form-label">
                  <span data-lang="KOR">ì£¼ë¥˜ íŒë§¤ ì—¬ë¶€</span>
                  <span data-lang="ENG" style="display: none;">Alcohol Sales</span>
                  <span data-lang="ESP" style="display: none;">Venta de Alcohol</span>
                </label>
                <select class="form-select" id="service_type" name="service_type" required>
                  <option selected disabled>ì„ íƒ</option>
                  <!-- ì˜µì…˜ë“¤ì€ JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </select>
              </div>

              <!-- ì¹´ì¹´ì˜¤ë§µ ì§€ë„ ì˜ì—­ -->
              <div class="col-md-12 mt-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <label class="form-label mb-0">
                    <span data-lang="KOR">ìœ„ì¹˜ ì§€ë„</span>
                    <span data-lang="ENG" style="display: none;">Location Map</span>
                    <span data-lang="ESP" style="display: none;">Mapa de UbicaciÃ³n</span>
                  </label>
                  <small class="text-muted">
                    <span data-lang="KOR">ì§€ë„ë¥¼ í´ë¦­í•˜ë©´ ì£¼ì†Œê°€ ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤</span>
                    <span data-lang="ENG" style="display: none;">Click on the map to automatically enter address</span>
                    <span data-lang="ESP" style="display: none;">Haga clic en el mapa para ingresar la direcciÃ³n automÃ¡ticamente</span>
                  </small>
                </div>
                <div id="kakao-map" style="width: 100%; height: 400px; border: 1px solid #ddd; border-radius: 8px;"></div>
                
                <!-- ì§€ë„ ì‚¬ìš© ì•ˆë‚´ -->
                <div class="mt-3">
                  <div class="alert alert-info" style="margin-bottom: 0;">
                    <div class="row">
                      <div class="col-md-6">
                        <h6 class="alert-heading mb-2">
                          <i class="bi bi-info-circle me-2"></i>
                          <span data-lang="KOR">ğŸ“ ì§€ë„ ì‚¬ìš© ë°©ë²•</span>
                          <span data-lang="ENG" style="display: none;">ğŸ“ How to Use Map</span>
                          <span data-lang="ESP" style="display: none;">ğŸ“ CÃ³mo usar el mapa</span>
                        </h6>
                        <ul class="mb-0" style="font-size: 0.85rem;">
                          <li data-lang="KOR">ì£¼ì†Œ ê²€ìƒ‰ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì •í™•í•œ ì£¼ì†Œ ê²€ìƒ‰</li>
                          <li data-lang="ENG" style="display: none;">Click address search button for precise address</li>
                          <li data-lang="ESP" style="display: none;">Haga clic en el botÃ³n de bÃºsqueda para buscar direcciÃ³n</li>
                          
                          <li data-lang="KOR">ì§€ë„ë¥¼ ì§ì ‘ í´ë¦­í•˜ì—¬ ìœ„ì¹˜ ì„ íƒ ê°€ëŠ¥</li>
                          <li data-lang="ENG" style="display: none;">Click directly on map to select location</li>
                          <li data-lang="ESP" style="display: none;">Haga clic directamente en el mapa para seleccionar ubicaciÃ³n</li>
                        </ul>
                      </div>
                      <div class="col-md-6">
                        <h6 class="alert-heading mb-2">
                          <i class="bi bi-geo-alt me-2"></i>
                          <span data-lang="KOR">ğŸ” ì„œë¹„ìŠ¤ ì§€ì—­ ì•ˆë‚´</span>
                          <span data-lang="ENG" style="display: none;">ğŸ” Service Area Guide</span>
                          <span data-lang="ESP" style="display: none;">ğŸ” GuÃ­a del Ã¡rea de servicio</span>
                        </h6>
                        <div style="font-size: 0.85rem;">
                          <div class="mb-2">
                            <span class="badge bg-success me-2">O</span>
                            <span data-lang="KOR"><strong>ì„œìš¸íŠ¹ë³„ì‹œ 25ê°œ êµ¬</strong> ì „ ì§€ì—­</span>
                            <span data-lang="ENG" style="display: none;"><strong>All 25 districts</strong> of Seoul Metropolitan City</span>
                            <span data-lang="ESP" style="display: none;"><strong>Los 25 distritos</strong> de la Ciudad Metropolitana de SeÃºl</span>
                          </div>
                          <div>
                            <span class="badge bg-danger me-2">X</span>
                            <span data-lang="KOR">ê²½ê¸°ë„, ì¸ì²œ, ê¸°íƒ€ ê´‘ì—­ì‹œ (ì„œìš¸ ì™¸ ì§€ì—­ í´ë¦­ ì‹œ ìë™ìœ¼ë¡œ ì„œìš¸ ì¤‘ì‹¬ìœ¼ë¡œ ì´ë™)</span>
                            <span data-lang="ENG" style="display: none;">Gyeonggi-do, Incheon, other cities (clicking outside Seoul will auto-center to Seoul)</span>
                            <span data-lang="ESP" style="display: none;">Gyeonggi-do, Incheon, otras ciudades (hacer clic fuera de SeÃºl centrarÃ¡ automÃ¡ticamente en SeÃºl)</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ë²„íŠ¼ -->
            <div class="text-center mt-4">
              <button type="button" class="btn btn-primary custom px-5" onclick="getFormData();" id="startAnalysisBtn">
                <span data-lang="KOR">ìƒê¶Œ ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”</span>
                <span data-lang="ENG" style="display: none;">Start Commercial Analysis</span>
                <span data-lang="ESP" style="display: none;">Iniciar AnÃ¡lisis Comercial</span>
              </button>
            </div>
          </form>

        </div>
      </div>
    </div>  <!-- ìƒê¶Œ ì •ë³´ ì…ë ¥ ì¹´ë“œ ë -->

    <!-- ğŸ“ ìµœê·¼ ë¶„ì„ ê²°ê³¼ (ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œ) -->
    {% if user.is_authenticated %}
    <div class="row mt-5">
      <div class="col-lg-12">
        <div class="accordion mb-4" id="analysisHistoryAccordion">
          <div class="accordion-item shadow-sm">
            <h2 class="accordion-header" id="analysisHistoryHeading">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#analysisHistoryCollapse" aria-expanded="false" aria-controls="analysisHistoryCollapse">
                <i class="bi bi-person-check me-2"></i>
                <strong>
                  <span data-lang="KOR">ğŸ“ ë‚´ ìµœê·¼ ë¶„ì„ ê¸°ë¡</span>
                  <span data-lang="ENG" style="display: none;">ğŸ“ My Recent Analyses</span>
                  <span data-lang="ESP" style="display: none;">ğŸ“ Mis anÃ¡lisis recientes</span>
                </strong>
                <small class="text-muted ms-2">
                  <span data-lang="KOR">({{ user.username }}ë‹˜ì˜ ê°œì¸ ê¸°ë¡{% if previous_docs %} - {{ previous_docs|length }}ê°œ{% endif %})</span>
                  <span data-lang="ENG" style="display: none;">({{ user.username }}'s personal records{% if previous_docs %} - {{ previous_docs|length }} items{% endif %})</span>
                  <span data-lang="ESP" style="display: none;">(Registros personales de {{ user.username }}{% if previous_docs %} - {{ previous_docs|length }} elementos{% endif %})</span>
                </small>
              </button>
            </h2>
            <div id="analysisHistoryCollapse" class="accordion-collapse collapse" aria-labelledby="analysisHistoryHeading" data-bs-parent="#analysisHistoryAccordion">
              <div class="accordion-body">
          {% if previous_docs %}
                  <ul class="list-group list-group-flush">
              {% for doc in previous_docs %}
                      <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                  <div>
                          <strong>
                            <span data-lang="KOR">ë¶„ì„ ID: {{ doc.request.id }}</span>
                            <span data-lang="ENG" style="display: none;">Analysis ID: {{ doc.request.id }}</span>
                            <span data-lang="ESP" style="display: none;">ID de AnÃ¡lisis: {{ doc.request.id }}</span>
                          </strong>
                          <span class="badge bg-{% if doc.survival_percentage >= 80 %}success{% elif doc.survival_percentage >= 60 %}warning{% else %}danger{% endif %} ms-2">
                            {{ doc.survival_percentage|floatformat:1 }}%
                          </span>
                          <br>
                          <small class="text-muted">
                            <i class="bi bi-geo-alt me-1"></i>{{ doc.request.address|truncatechars:50 }}
                          </small><br>
                          <small class="text-muted">
                            <i class="bi bi-calendar me-1"></i>{{ doc.created_at|date:"Y-m-d H:i" }}
                            <i class="bi bi-shop ms-3 me-1"></i>{{ doc.request.business_type.name }}
                          </small>
                  </div>
                        <button class="btn btn-sm btn-outline-primary" onclick="showPdfPreview({{ doc.request.id }})">
                          <i class="bi bi-eye me-1"></i>
                          <span data-lang="KOR">ê²°ê³¼ë³´ê¸°</span>
                          <span data-lang="ENG" style="display: none;">View Results</span>
                          <span data-lang="ESP" style="display: none;">Ver Resultados</span>
                        </button>
                </li>
              {% endfor %}
            </ul>
                  {% if previous_docs|length > 5 %}
                    <div class="text-center mt-3">
                      <small class="text-muted">
                        <span data-lang="KOR">ìµœê·¼ {{ previous_docs|length }}ê°œ ê¸°ë¡ ì¤‘ ì¼ë¶€ë§Œ í‘œì‹œë©ë‹ˆë‹¤.</span>
                        <span data-lang="ENG" style="display: none;">Showing partial results of recent {{ previous_docs|length }} records.</span>
                        <span data-lang="ESP" style="display: none;">Mostrando resultados parciales de {{ previous_docs|length }} registros recientes.</span>
                      </small>
                    </div>
                  {% endif %}
          {% else %}
                  <div class="text-center p-3">
                    <i class="bi bi-folder2-open text-muted" style="font-size: 3rem;"></i>
                    <p class="text-muted mt-2">
                      <span data-lang="KOR">ì•„ì§ ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</span>
                      <span data-lang="ENG" style="display: none;">No analysis results yet.</span>
                      <span data-lang="ESP" style="display: none;">AÃºn no hay resultados de anÃ¡lisis.</span>
                    </p>
                    <p class="text-muted small">
                      <span data-lang="KOR">ìœ„ì˜ ì–‘ì‹ì„ ì‘ì„±í•˜ì—¬ ì²« ë²ˆì§¸ ìƒê¶Œ ë¶„ì„ì„ ì‹œì‘í•´ë³´ì„¸ìš”!</span>
                      <span data-lang="ENG" style="display: none;">Fill out the form above to start your first commercial analysis!</span>
                      <span data-lang="ESP" style="display: none;">Â¡Complete el formulario de arriba para comenzar su primer anÃ¡lisis comercial!</span>
                    </p>
                  </div>
          {% endif %}
        </div>
      </div>
    </div>
        </div>
      </div>
    </div>
    {% else %}
    <!-- ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìë¥¼ ìœ„í•œ ì•ˆë‚´ -->
    <div class="row mt-5">
      <div class="col-lg-12">
        <div class="card p-4 shadow-sm mb-4 border-warning">
          <h4 class="mb-3 text-warning">
            <i class="bi bi-person-x me-2"></i>
            <span data-lang="KOR">ê°œì¸ ë¶„ì„ ê¸°ë¡</span>
            <span data-lang="ENG" style="display: none;">Personal Analysis Records</span>
            <span data-lang="ESP" style="display: none;">Registros de AnÃ¡lisis Personal</span>
          </h4>
          <div class="text-center p-3">
            <i class="bi bi-lock text-warning" style="font-size: 3rem;"></i>
            <p class="text-muted mt-2">
              <span data-lang="KOR">ë¶„ì„ ê¸°ë¡ì„ ë³´ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</span>
              <span data-lang="ENG" style="display: none;">Login is required to view analysis records.</span>
              <span data-lang="ESP" style="display: none;">Se requiere iniciar sesiÃ³n para ver los registros de anÃ¡lisis.</span>
            </p>
            <a href="{% url 'custom_auth:login' %}?next={{ request.get_full_path }}" class="btn btn-warning">
              <i class="bi bi-box-arrow-in-right me-1"></i>
              <span data-lang="KOR">ë¡œê·¸ì¸í•˜ê¸°</span>
              <span data-lang="ENG" style="display: none;">Login</span>
              <span data-lang="ESP" style="display: none;">Iniciar SesiÃ³n</span>
            </a>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

  
    <!-- ë³¸ë¬¸: ë¶„ì„ ê²°ê³¼ + ì±—ë´‡ -->
    <div class="row">
      <!-- ì™¼ìª½: ë¶„ì„ ë¦¬í¬íŠ¸ -->
      <div class="col-lg-8 mb-4 analysis-container">
        <div class="card p-4 shadow-sm">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h4 class="mb-0">
              <span data-lang="KOR">ìƒê¶Œ ë¶„ì„ ê²°ê³¼</span>
              <span data-lang="ENG" style="display: none;">Commercial Area Analysis Result</span>
              <span data-lang="ESP" style="display: none;">Resultado del AnÃ¡lisis Comercial</span>
            </h4>
            <!-- ëª¨ë‹¬ ë²„íŠ¼ -->
            <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#explanationModal">
              <span data-lang="KOR">ìƒê¶Œ ë¶„ì„ ë„ì›€ë§</span>
              <span data-lang="ENG" style="display: none;">Commercial Analysis Guide</span>
              <span data-lang="ESP" style="display: none;">GuÃ­a de AnÃ¡lisis Comercial</span>
            </button>
            
            <!-- Bootstrap ëª¨ë‹¬ -->
            <div class="modal fade" id="explanationModal" tabindex="-1" aria-labelledby="explanationModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="explanationModalLabel">
                      <span data-lang="KOR">ìƒê¶Œ ë¶„ì„ì´ë€ ë¬´ì—‡ì¸ê°€?</span>
                      <span data-lang="ENG" style="display: none;">What is Commercial Area Analysis?</span>
                      <span data-lang="ESP" style="display: none;">Â¿QuÃ© es el AnÃ¡lisis de Zona Comercial?</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
                  </div>
                  <div class="modal-body">
                    <div data-lang="KOR">
                      ìƒê¶Œë¶„ì„ì€ íŠ¹ì • ì§€ì—­ ë‚´ ì í¬ë‚˜ ì‚¬ì—…ì¥ì˜ ê²½ì œì  í™˜ê²½ê³¼ ì†Œë¹„ì íŠ¹ì„±ì„ ì²´ê³„ì ìœ¼ë¡œ ì¡°ì‚¬í•˜ì—¬<br>
                      ì‚¬ì—… ì„±ê³µ ê°€ëŠ¥ì„±ì„ ë†’ì´ê¸° ìœ„í•œ ì¤‘ìš”í•œ ê³¼ì •ì…ë‹ˆë‹¤.<br><br>
              
                      <strong>ì™œ ìƒê¶Œë¶„ì„ì´ í•„ìš”í•œê°€ìš”?</strong><br>
                      - ìƒê¶Œì˜ ì†Œë¹„ íŒ¨í„´ê³¼ ìœ ë™ ì¸êµ¬ë¥¼ íŒŒì•…í•˜ì—¬ íš¨ìœ¨ì ì¸ ë§ˆì¼€íŒ… ì „ëµì„ ì„¸ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                      - ê²½ìŸ ì—…ì²´ í˜„í™©ê³¼ ê³ ê° ìˆ˜ìš”ë¥¼ ë¶„ì„í•´ ì ì ˆí•œ ì…ì§€ì™€ ì„œë¹„ìŠ¤ë¥¼ ê²°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                      - íˆ¬ì ìœ„í—˜ì„ ìµœì†Œí™”í•˜ê³  ì•ˆì •ì ì¸ ë§¤ì¶œì„ ê¸°ëŒ€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br><br>
              
                      <strong>AI ê¸°ë°˜ ìƒê¶Œë¶„ì„ì€ ë‹¤ìŒì„ ì œê³µí•©ë‹ˆë‹¤:</strong><br>
                      - ì í¬ì˜ ìƒì¡´ í™•ë¥  ì˜ˆì¸¡<br>
                      - SHAP ìš”ì¸ ë¶„ì„<br><br>
              
                      ì„±ê³µì ì¸ ì°½ì—…ê³¼ ìš´ì˜ì„ ìœ„í•´<br>
                      ì •í™•í•œ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì „ëµì„ ì„¸ì›Œë³´ì„¸ìš”!
                    </div>
                    
                    <div data-lang="ENG" style="display: none;">
                      Commercial area analysis is an important process that systematically investigates the economic environment and consumer characteristics of stores or businesses in a specific area to increase the chances of business success.<br><br>
              
                      <strong>Why is commercial area analysis necessary?</strong><br>
                      - You can identify consumption patterns and foot traffic in the commercial area to establish efficient marketing strategies.<br>
                      - You can analyze competitor status and customer demand to determine appropriate location and services.<br>
                      - You can minimize investment risks and expect stable sales.<br><br>
              
                      <strong>AI-based commercial area analysis provides:</strong><br>
                      - Store survival probability prediction<br>
                      - SHAP factor analysis<br><br>
              
                      For successful startup and operation,<br>
                      develop strategies based on accurate information!
                    </div>
                    
                    <div data-lang="ESP" style="display: none;">
                      El anÃ¡lisis de zona comercial es un proceso importante que investiga sistemÃ¡ticamente el entorno econÃ³mico y las caracterÃ­sticas del consumidor de tiendas o negocios en un Ã¡rea especÃ­fica para aumentar las posibilidades de Ã©xito empresarial.<br><br>
              
                      <strong>Â¿Por quÃ© es necesario el anÃ¡lisis de zona comercial?</strong><br>
                      - Puede identificar patrones de consumo y trÃ¡fico peatonal en la zona comercial para establecer estrategias de marketing eficientes.<br>
                      - Puede analizar el estado de la competencia y la demanda del cliente para determinar la ubicaciÃ³n y servicios apropiados.<br>
                      - Puede minimizar los riesgos de inversiÃ³n y esperar ventas estables.<br><br>
              
                      <strong>El anÃ¡lisis de zona comercial basado en IA proporciona:</strong><br>
                      - PredicciÃ³n de probabilidad de supervivencia de la tienda<br>
                      - AnÃ¡lisis de factores SHAP<br><br>
              
                      Para una startup y operaciÃ³n exitosa,<br>
                      Â¡desarrolle estrategias basadas en informaciÃ³n precisa!
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                      <span data-lang="KOR">ë‹«ê¸°</span>
                      <span data-lang="ENG" style="display: none;">Close</span>
                      <span data-lang="ESP" style="display: none;">Cerrar</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- ë¶„ì„ ëŒ€ê¸° ë©”ì‹œì§€ -->
          <div id="analysisWaiting">
            <div class="text-center p-4">
              <i class="bi bi-analytics text-muted" style="font-size: 3rem;"></i>
              <h5 class="mt-3 text-muted">
                <span data-lang="KOR">ìƒê¶Œ ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”</span>
                <span data-lang="ENG" style="display: none;">Start Commercial Analysis</span>
                <span data-lang="ESP" style="display: none;">Iniciar AnÃ¡lisis Comercial</span>
              </h5>
              <p class="text-muted">
                <span data-lang="KOR">
                  ìœ„ì˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  'ìƒê¶Œ ë¶„ì„í•˜ê¸°' ë²„íŠ¼ì„ í´ë¦­í•˜ë©´<br>ì´ ì˜ì—­ì— ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                </span>
                <span data-lang="ENG" style="display: none;">
                  Enter the information above and click the 'Analyze Commercial Area' button<br>to display analysis results in this area.
                </span>
                <span data-lang="ESP" style="display: none;">
                  Ingrese la informaciÃ³n anterior y haga clic en el botÃ³n 'Analizar Zona Comercial'<br>para mostrar los resultados del anÃ¡lisis en esta Ã¡rea.
                </span>
              </p>
              <button class="btn btn-outline-secondary mt-3" disabled>
                <i class="bi bi-file-earmark-pdf me-2"></i>
                <span data-lang="KOR">PDFë¡œ ì €ì¥</span>
                <span data-lang="ENG" style="display: none;">Save as PDF</span>
                <span data-lang="ESP" style="display: none;">Guardar como PDF</span>
              </button>
            </div>
          </div>
          
          <!-- ë¶„ì„ ì§„í–‰ ìƒí™© UI (ì»´í¬ë„ŒíŠ¸ include) -->
          {% include 'AI_Analyzer/components/progress_steps.html' %}
          
          <!-- ë¶„ì„ ê²°ê³¼ ë‚´ìš© (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) -->
          <div id="analysisResults" style="display: none;">
            
            <!-- ìœ„ì¹˜ ì •ë³´ -->
            <div class="alert alert-info mb-4">
              <div class="row align-items-center">
                <div class="col-md-8">
                  <h5 class="mb-2">
                    <i class="bi bi-geo-alt-fill me-2"></i>
                    <span id="resultAddress"></span>
                  </h5>
                  <div class="row">
                    <div class="col-md-4">
                      <strong>
                        <span data-lang="KOR">ì—…ì¢…:</span>
                        <span data-lang="ENG" style="display: none;">Business Type:</span>
                        <span data-lang="ESP" style="display: none;">Tipo de Negocio:</span>
                      </strong> <span id="resultBusinessType"></span>
                    </div>
                    <div class="col-md-4">
                      <strong>
                        <span data-lang="KOR">ë©´ì :</span>
                        <span data-lang="ENG" style="display: none;">Area:</span>
                        <span data-lang="ESP" style="display: none;">Ãrea:</span>
                      </strong> <span id="resultArea"></span>ã¡
                    </div>
                    <div class="col-md-4">
                      <strong>
                        <span data-lang="KOR">ìœ í˜•:</span>
                        <span data-lang="ENG" style="display: none;">Type:</span>
                        <span data-lang="ESP" style="display: none;">Tipo:</span>
                      </strong> <span id="resultServiceType"></span>
                    </div>
                  </div>
                </div>
                <div class="col-md-4 text-end">
                  <small class="text-muted">
                    <span data-lang="KOR">ë¶„ì„ì™„ë£Œ</span>
                    <span data-lang="ENG" style="display: none;">Analysis Complete</span>
                    <span data-lang="ESP" style="display: none;">AnÃ¡lisis Completo</span>
                  </small>
                </div>
              </div>
            </div>

            <!-- í•µì‹¬ ì§€í‘œ -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3">
                <i class="bi bi-speedometer me-2"></i>
                <span data-lang="KOR">í•µì‹¬ ì§€í‘œ</span>
                <span data-lang="ENG" style="display: none;">Key Indicators</span>
                <span data-lang="ESP" style="display: none;">Indicadores Clave</span>
              </h5>
              <div class="row g-3">
                <div class="col-md-3">
                  <div class="card border text-center" style="background-color: white; border-color: #dee2e6;">
                    <div class="card-body">
                      <h3 id="lifePop300" class="fw-bold" style="color: #1e3a8a;">-</h3>
                      <small style="color: #1e3a8a;">
                        <span data-lang="KOR">300m ë‚´ ìƒí™œì¸êµ¬</span>
                        <span data-lang="ENG" style="display: none;">Resident Pop. within 300m</span>
                        <span data-lang="ESP" style="display: none;">Pobl. Residente dentro de 300m</span>
                      </small>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card border text-center" style="background-color: white; border-color: #dee2e6;">
                    <div class="card-body">
                      <h3 id="workingPop300" class="fw-bold" style="color: #1e3a8a;">-</h3>
                      <small style="color: #1e3a8a;">
                        <span data-lang="KOR">300m ë‚´ ì§ì¥ì¸êµ¬</span>
                        <span data-lang="ENG" style="display: none;">Working Pop. within 300m</span>
                        <span data-lang="ESP" style="display: none;">PoblaciÃ³n Trabajadora en 300m</span>
                      </small>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card border text-center" style="background-color: white; border-color: #dee2e6;">
                    <div class="card-body">
                      <h3 id="competitor300" class="fw-bold" style="color: #1e3a8a;">-</h3>
                      <small style="color: #1e3a8a;">
                        <span data-lang="KOR">ë™ì¼ì—…ì¢… ê²½ìŸì—…ì²´</span>
                        <span data-lang="ENG" style="display: none;">Same Business Type Competitors</span>
                        <span data-lang="ESP" style="display: none;">Competidores del Mismo Tipo de Negocio</span>
                      </small>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card border text-center" style="background-color: white; border-color: #dee2e6;">
                    <div class="card-body">
                      <h3 id="totalLandValue" class="fw-bold" style="color: #1e3a8a;">-</h3>
                      <small style="color: #1e3a8a;">
                        <span data-lang="KOR">ì´ ê³µì‹œì§€ê°€</span>
                        <span data-lang="ENG" style="display: none;">Total Public Land Price</span>
                        <span data-lang="ESP" style="display: none;">Precio Total del Terreno PÃºblico</span>
                      </small>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- AI ì˜ˆì¸¡ ìƒì¡´ í™•ë¥  -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3">
                <i class="bi bi-cpu me-2"></i>
                <span data-lang="KOR">AI ì˜ˆì¸¡ ë¶„ì„</span>
                <span data-lang="ENG" style="display: none;">AI Prediction Analysis</span>
                <span data-lang="ESP" style="display: none;">AnÃ¡lisis de PredicciÃ³n IA</span>
              </h5>
              <div class="row align-items-center">
                <div class="col-md-6">
                  <div class="text-center">
                    <div class="display-1 fw-bold mb-3" id="survivalPercentage">-%</div>
                    <h4 class="mb-3">
                      <span data-lang="KOR">ì¥ê¸° ìƒì¡´ í™•ë¥ </span>
                      <span data-lang="ENG" style="display: none;">Long-term Survival Rate</span>
                      <span data-lang="ESP" style="display: none;">Probabilidad de Supervivencia a Largo Plazo</span>
                    </h4>
                    <div class="progress" style="height: 25px;">
                      <div id="survivalBar" class="progress-bar" style="width: 0%; transition: width 0.6s ease;"></div>
                    </div>
                    <div class="mt-2">
                      <span id="survivalBarText" class="badge fs-6" style="font-size: 1rem; font-weight: 500;">
                        <span data-lang="KOR">ë¶„ì„ì¤‘...</span>
                        <span data-lang="ENG" style="display: none;">Analyzing...</span>
                        <span data-lang="ESP" style="display: none;">Analizando...</span>
                      </span>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="p-3">
                    <h6 class="mb-3">
                      <span data-lang="KOR">AI ë¶„ì„ ê²°ê³¼</span>
                      <span data-lang="ENG" style="display: none;">AI Analysis Result</span>
                      <span data-lang="ESP" style="display: none;">Resultado del AnÃ¡lisis IA</span>
                    </h6>
                    <div id="survivalAnalysis" class="alert">
                      <!-- AI ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                    <small class="text-muted">
                      <i class="bi bi-info-circle me-1"></i>
                      <span data-lang="KOR">AI ëª¨ë¸ì´ 25ê°œ ì§€í‘œë¥¼ ì¢…í•© ë¶„ì„í•œ ê²°ê³¼ì…ë‹ˆë‹¤.</span>
                      <span data-lang="ENG" style="display: none;">Results from AI model's comprehensive analysis of 25 indicators.</span>
                      <span data-lang="ESP" style="display: none;">Resultados del anÃ¡lisis integral de 25 indicadores del modelo IA.</span>
                    </small>
                  </div>
                </div>
              </div>
            </div>

            <!-- AI ì¶”ì²œ ì—…ì¢… (íšŒì› ì „ìš©) -->
            <div class="mb-4" id="businessRecommendationSection" style="display: none;">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3">
                <i class="bi bi-star me-2"></i>
                <span data-lang="KOR">AI ì¶”ì²œ ì—…ì¢…</span>
                <span data-lang="ENG" style="display: none;">AI Recommended Business Types</span>
                <span data-lang="ESP" style="display: none;">Tipos de Negocio Recomendados por IA</span>
                <small class="text-muted ms-2">
                  <span data-lang="KOR">(íšŒì› ì „ìš©)</span>
                  <span data-lang="ENG" style="display: none;">(Members Only)</span>
                  <span data-lang="ESP" style="display: none;">(Solo Miembros)</span>
                </small>
              </h5>
              <div class="row">
                <!-- 1ìœ„ ì—…ì¢… - í¬ê²Œ í‘œì‹œ -->
                <div class="col-md-6">
                  <div class="card border-primary h-100">
                    <div class="card-header bg-primary text-white text-center">
                      <h6 class="mb-0">
                        <i class="bi bi-trophy me-2"></i>
                        <span data-lang="KOR">1ìœ„ ì¶”ì²œ ì—…ì¢…</span>
                        <span data-lang="ENG" style="display: none;">Top Recommended Business</span>
                        <span data-lang="ESP" style="display: none;">Negocio MÃ¡s Recomendado</span>
                      </h6>
                    </div>
                    <div class="card-body text-center">
                      <div class="display-1 fw-bold mb-3" id="topRecommendationPercentage">-%</div>
                      <h5 class="mb-3" id="topRecommendationName">-</h5>
                      <div class="progress" style="height: 25px;">
                        <div id="topRecommendationBar" class="progress-bar" style="width: 0%; transition: width 0.6s ease;"></div>
                      </div>
                      <div class="mt-3" id="topRecommendationBadge" style="display: none;">
                        <span class="badge bg-success">
                          <i class="bi bi-arrow-up me-1"></i>
                          <span data-lang="KOR">ì„ íƒ ì—…ì¢… ëŒ€ë¹„ ìš°ìˆ˜</span>
                          <span data-lang="ENG" style="display: none;">Better than Selected Business</span>
                          <span data-lang="ESP" style="display: none;">Mejor que el Negocio Seleccionado</span>
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- 2, 3, 4ìœ„ ì—…ì¢… -->
                <div class="col-md-6">
                  <div class="row" id="otherRecommendations">
                    <!-- 2,3,4ìœ„ ì—…ì¢…ì€ JavaScriptë¡œ ë™ì  ìƒì„± -->
                  </div>
                  
                  <!-- ì „ì²´ ìˆœìœ„ ë³´ê¸° ë²„íŠ¼ -->
                  <div class="text-center mt-3">
                    <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#allRecommendationsModal" onclick="showAllRecommendationsModal()">
                      <i class="bi bi-list me-2"></i>
                      <span data-lang="KOR">ì „ì²´ ì—…ì¢… ìˆœìœ„ ë³´ê¸°</span>
                      <span data-lang="ENG" style="display: none;">View All Business Rankings</span>
                      <span data-lang="ESP" style="display: none;">Ver Todas las Clasificaciones de Negocios</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- ìƒê¶Œ ê²½ìŸ ë¶„ì„ -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3">
                <i class="bi bi-shop me-2"></i>
                <span data-lang="KOR">ìƒê¶Œ ê²½ìŸ ë¶„ì„ (300m ë°˜ê²½)</span>
                <span data-lang="ENG" style="display: none;">Competition Analysis (300m radius)</span>
                <span data-lang="ESP" style="display: none;">AnÃ¡lisis de Competencia (radio 300m)</span>
              </h5>
              <div class="row g-3 text-center">
                <div class="col-md-3">
                  <h6>
                    <span data-lang="KOR">ê²½ìŸì—…ì²´ ìˆ˜</span>
                    <span data-lang="ENG" style="display: none;">Competitors</span>
                    <span data-lang="ESP" style="display: none;">Competidores</span>
                  </h6>
                  <div class="h4 text-danger" id="competitorCount">-</div>
                </div>
                <div class="col-md-3">
                  <h6>
                    <span data-lang="KOR">ì „ì²´ ìš”ì‹ì—…ì²´</span>
                    <span data-lang="ENG" style="display: none;">Total Restaurants</span>
                    <span data-lang="ESP" style="display: none;">Total Restaurantes</span>
                  </h6>
                  <div class="h4 text-info" id="adjacentBiz">-</div>
                </div>
                <div class="col-md-3">
                  <h6>
                    <span data-lang="KOR">ê²½ìŸì—…ì²´ ë¹„ìœ¨</span>
                    <span data-lang="ENG" style="display: none;">Competitor Ratio</span>
                    <span data-lang="ESP" style="display: none;">ProporciÃ³n de Competidores</span>
                  </h6>
                  <div class="h4 text-warning" id="competitorRatio">-%</div>
                </div>
                <div class="col-md-3">
                  <h6>
                    <span data-lang="KOR">ì—…ì¢… ë‹¤ì–‘ì„±</span>
                    <span data-lang="ENG" style="display: none;">Business Diversity</span>
                    <span data-lang="ESP" style="display: none;">Diversidad de Negocios</span>
                  </h6>
                  <div class="h4 text-success" id="businessDiversity">-</div>
                </div>
              </div>
              
              <div class="mt-4">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <h6 class="mb-0">
                    <span data-lang="KOR">ê²½ìŸ ê°•ë„ ë¶„ì„</span>
                    <span data-lang="ENG" style="display: none;">Competition Intensity</span>
                    <span data-lang="ESP" style="display: none;">Intensidad de Competencia</span>
                  </h6>
                  <span id="competitionLevel" class="badge fs-6" style="font-size: 1.1rem; font-weight: 500;">
                    <span data-lang="KOR">ë¶„ì„ì¤‘...</span>
                    <span data-lang="ENG" style="display: none;">Analyzing...</span>
                    <span data-lang="ESP" style="display: none;">Analizando...</span>
                  </span>
                  </div>
                <div class="progress" style="height: 40px;">
                  <div id="competitionBar" class="progress-bar" style="width: 0%; transition: width 0.6s ease;"></div>
                </div>
                <small class="text-muted mt-2 d-block">
                  <span data-lang="KOR">ê²½ìŸì—…ì²´ ë¹„ìœ¨ì´ 20% ì´í•˜ë©´ ë‚®ìŒ, 20-50%ëŠ” ë³´í†µ, 50% ì´ìƒì€ ë†’ìŒìœ¼ë¡œ ë¶„ë¥˜ë©ë‹ˆë‹¤.</span>
                  <span data-lang="ENG" style="display: none;">Competitor ratio below 20% is low, 20-50% is medium, above 50% is high.</span>
                  <span data-lang="ESP" style="display: none;">ProporciÃ³n de competidores por debajo del 20% es baja, 20-50% es media, por encima del 50% es alta.</span>
                </small>
              </div>
            </div>

            <!-- ì¸êµ¬ êµ¬ì„± ë¶„ì„ -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3">
                <i class="bi bi-people me-2"></i>
                <span data-lang="KOR">ì¸êµ¬ êµ¬ì„± ë¶„ì„ (1000m ë°˜ê²½)</span>
                <span data-lang="ENG" style="display: none;">Population Analysis (1000m radius)</span>
                <span data-lang="ESP" style="display: none;">AnÃ¡lisis de PoblaciÃ³n (radio 1000m)</span>
              </h5>
              <div class="row">
                <div class="col-md-6">
                  <div class="card h-100">
                    <div class="card-body text-center">
                      <h6 class="card-title mb-3">
                        <span data-lang="KOR">ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë¹„ìœ¨</span>
                        <span data-lang="ENG" style="display: none;">Population by Age Group</span>
                        <span data-lang="ESP" style="display: none;">PoblaciÃ³n por Grupo de Edad</span>
                      </h6>
                      <div style="position: relative; height: 300px; width: 100%;">
                        <canvas id="ageChart" style="max-height: 300px; max-width: 100%;"></canvas>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card h-100">
                    <div class="card-body">
                      <h6 class="card-title mb-3">
                        <span data-lang="KOR">ì—°ë ¹ëŒ€ë³„ ìƒì„¸ ì •ë³´</span>
                        <span data-lang="ENG" style="display: none;">Detailed Age Information</span>
                        <span data-lang="ESP" style="display: none;">InformaciÃ³n Detallada de Edad</span>
                      </h6>
                      <div class="row g-2">
                        <div class="col-6">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #FF6384;" id="age20Percent">-%</div>
                            <small class="text-muted">
                              <span data-lang="KOR">20ëŒ€</span>
                              <span data-lang="ENG" style="display: none;">20s</span>
                              <span data-lang="ESP" style="display: none;">20s</span>
                            </small>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #36A2EB;" id="age30Percent">-%</div>
                            <small class="text-muted">
                              <span data-lang="KOR">30ëŒ€</span>
                              <span data-lang="ENG" style="display: none;">30s</span>
                              <span data-lang="ESP" style="display: none;">30s</span>
                            </small>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #FFCE56;" id="age40Percent">-%</div>
                            <small class="text-muted">
                              <span data-lang="KOR">40ëŒ€</span>
                              <span data-lang="ENG" style="display: none;">40s</span>
                              <span data-lang="ESP" style="display: none;">40s</span>
                            </small>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #4BC0C0;" id="age50Percent">-%</div>
                            <small class="text-muted">
                              <span data-lang="KOR">50ëŒ€</span>
                              <span data-lang="ENG" style="display: none;">50s</span>
                              <span data-lang="ESP" style="display: none;">50s</span>
                            </small>
                          </div>
                        </div>
                        <div class="col-12">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #9966FF;" id="age60Percent">-%</div>
                            <small class="text-muted">
                              <span data-lang="KOR">60ëŒ€ ì´ìƒ</span>
                              <span data-lang="ENG" style="display: none;">60+ years</span>
                              <span data-lang="ESP" style="display: none;">60+ aÃ±os</span>
                            </small>
                          </div>
                        </div>
                      </div>
                      <div class="mt-3 text-center">
                        <small class="text-muted">
                          <i class="bi bi-info-circle me-1"></i>
                          <span data-lang="KOR">1000m ë°˜ê²½ ë‚´ ìƒí™œì¸êµ¬ ê¸°ì¤€</span>
                          <span data-lang="ENG" style="display: none;">Based on population within 1000m radius</span>
                          <span data-lang="ESP" style="display: none;">Basado en la poblaciÃ³n dentro de un radio de 1000m</span>
                        </small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ì™¸êµ­ì¸ ë¶„ì„ -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3">
                <i class="bi bi-globe me-2"></i>
                <span data-lang="KOR">ì™¸êµ­ì¸ ë¶„ì„</span>
                <span data-lang="ENG" style="display: none;">Foreign Population Analysis</span>
                <span data-lang="ESP" style="display: none;">AnÃ¡lisis de PoblaciÃ³n Extranjera</span>
              </h5>
              <div class="row g-3 text-center">
                <div class="col-md-4">
                  <div class="card h-100">
                    <div class="card-body">
                      <i class="bi bi-airplane text-primary mb-2" style="font-size: 2rem;"></i>
                      <h6>
                        <span data-lang="KOR">ë‹¨ê¸°ì²´ë¥˜ ì™¸êµ­ì¸</span>
                        <span data-lang="ENG" style="display: none;">Short-term Foreign Visitors</span>
                        <span data-lang="ESP" style="display: none;">Visitantes Extranjeros a Corto Plazo</span>
                      </h6>
                      <div class="h4 text-primary" id="tempForeign1000">-</div>
                      <small class="text-muted">
                        <span data-lang="KOR">1000m ë°˜ê²½</span>
                        <span data-lang="ENG" style="display: none;">1000m radius</span>
                        <span data-lang="ESP" style="display: none;">radio 1000m</span>
                      </small>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card h-100">
                    <div class="card-body">
                      <i class="bi bi-house text-success mb-2" style="font-size: 2rem;"></i>
                      <h6>
                        <span data-lang="KOR">ì¥ê¸°ì²´ë¥˜ ì™¸êµ­ì¸</span>
                        <span data-lang="ENG" style="display: none;">Long-term Foreign Residents</span>
                        <span data-lang="ESP" style="display: none;">Residentes Extranjeros a Largo Plazo</span>
                      </h6>
                      <div class="h4 text-success" id="longForeign300">-</div>
                      <small class="text-muted">
                        <span data-lang="KOR">300m ë°˜ê²½</span>
                        <span data-lang="ENG" style="display: none;">300m radius</span>
                        <span data-lang="ESP" style="display: none;">radio 300m</span>
                      </small>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card h-100">
                    <div class="card-body">
                      <i class="bi bi-flag text-warning mb-2" style="font-size: 2rem;"></i>
                      <h6>
                        <span data-lang="KOR">ì¥ê¸°ì²´ë¥˜ ì¤‘êµ­ì¸ ë¹„ìœ¨</span>
                        <span data-lang="ENG" style="display: none;">Long-term Chinese Residents Ratio</span>
                        <span data-lang="ESP" style="display: none;">ProporciÃ³n de Residentes Chinos a Largo Plazo</span>
                      </h6>
                      <div class="h4 text-warning" id="longForeignCNRatio300">-</div>
                      <small class="text-muted">
                        <span data-lang="KOR">1000m ë°˜ê²½</span>
                        <span data-lang="ENG" style="display: none;">1000m radius</span>
                        <span data-lang="ESP" style="display: none;">radio 1000m</span>
                      </small>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ë¶„ì„ ìš”ì•½ -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3">
                <i class="bi bi-lightbulb me-2"></i>
                <span data-lang="KOR">AI ë¶„ì„ ìš”ì•½</span>
                <span data-lang="ENG" style="display: none;">AI Analysis Summary</span>
                <span data-lang="ESP" style="display: none;">Resumen del AnÃ¡lisis IA</span>
              </h5>
              <div class="row">
                <div class="col-md-6">
                  <h6 class="text-success">
                    <i class="bi bi-check-circle me-2"></i>
                    <span data-lang="KOR">ê°•ì </span>
                    <span data-lang="ENG" style="display: none;">Strengths</span>
                    <span data-lang="ESP" style="display: none;">Fortalezas</span>
                  </h6>
                  <ul id="strengthsList">
                    <!-- ê°•ì  ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                  </ul>
                </div>
                <div class="col-md-6">
                  <h6 class="text-warning">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <span data-lang="KOR">ì£¼ì˜ì‚¬í•­</span>
                    <span data-lang="ENG" style="display: none;">Cautions</span>
                    <span data-lang="ESP" style="display: none;">Precauciones</span>
                  </h6>
                  <ul id="cautionsList">
                    <!-- ì£¼ì˜ì‚¬í•­ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                  </ul>
                </div>
              </div>
            </div>

            <!-- ìƒê¶Œ ìœ„ì¹˜ ì§€ë„ ì‹œê°í™” (íšŒì› ì „ìš©) -->
            {% if user.is_authenticated %}
            <div class="mb-4" id="analysis-map-section" style="display: none;">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3">
                <i class="bi bi-map me-2"></i>
                <span data-lang="KOR">ìƒê¶Œ ìœ„ì¹˜ ì§€ë„</span>
                <span data-lang="ENG" style="display: none;">Commercial Area Map</span>
                <span data-lang="ESP" style="display: none;">Mapa del Ãrea Comercial</span>
                <small class="text-muted ms-2">
                  <span data-lang="KOR">(íšŒì› ì „ìš©)</span>
                  <span data-lang="ENG" style="display: none;">(Members Only)</span>
                  <span data-lang="ESP" style="display: none;">(Solo Miembros)</span>
                </small>
              </h5>
              
              <!-- ì§€ë„ ì»¨íŠ¸ë¡¤ UI -->
              <div class="card border-0 mb-3">
                <div class="card-body p-3" style="background-color: #f8f9fa;">
                  <div class="row align-items-center">
                    <!-- ì§€ë„ ëª¨ë“œ íƒ­ -->
                    <div class="col-md-6">
                      <div class="btn-group w-100" role="group" aria-label="ì§€ë„ í‘œì‹œ ëª¨ë“œ">
                        <input type="radio" class="btn-check" name="mapMode" id="populationMode" value="population" checked>
                        <label class="btn btn-outline-success map-mode-tab" for="populationMode" data-mode="population" onclick="changeMapMode('population')">
                          <i class="bi bi-people me-1"></i>
                          <span data-lang="KOR">ê±°ì£¼ì¸êµ¬</span>
                          <span data-lang="ENG" style="display: none;">Population</span>
                          <span data-lang="ESP" style="display: none;">PoblaciÃ³n</span>
                        </label>
                        
                        <input type="radio" class="btn-check" name="mapMode" id="workplaceMode" value="workplace">
                        <label class="btn btn-outline-primary map-mode-tab" for="workplaceMode" data-mode="workplace" onclick="changeMapMode('workplace')">
                          <i class="bi bi-briefcase me-1"></i>
                          <span data-lang="KOR">ì§ì¥ì¸êµ¬</span>
                          <span data-lang="ENG" style="display: none;">Workplace</span>
                          <span data-lang="ESP" style="display: none;">Trabajo</span>
                        </label>
                        
                        <input type="radio" class="btn-check" name="mapMode" id="shopsMode" value="shops">
                        <label class="btn btn-outline-warning map-mode-tab" for="shopsMode" data-mode="shops" onclick="changeMapMode('shops')">
                          <i class="bi bi-shop me-1"></i>
                          <span data-lang="KOR">ì£¼ë³€ìƒì </span>
                          <span data-lang="ENG" style="display: none;">Shops</span>
                          <span data-lang="ESP" style="display: none;">Tiendas</span>
                        </label>
                      </div>
                    </div>
                    
                    <!-- ë²„í¼ ë²”ìœ„ ì„ íƒ -->
                    <div class="col-md-4">
                      <div class="btn-group w-100" role="group" aria-label="ë²„í¼ ë²”ìœ„">
                        <input type="radio" class="btn-check" name="bufferSize" id="buffer300" value="300" checked>
                        <label class="btn btn-outline-info buffer-btn" for="buffer300" data-size="300" onclick="changeBufferSize(300)">
                          <span data-lang="KOR">300m</span>
                          <span data-lang="ENG" style="display: none;">300m</span>
                          <span data-lang="ESP" style="display: none;">300m</span>
                        </label>
                        
                        <input type="radio" class="btn-check" name="bufferSize" id="buffer1000" value="1000">
                        <label class="btn btn-outline-danger buffer-btn" for="buffer1000" data-size="1000" onclick="changeBufferSize(1000)">
                          <span data-lang="KOR">1000m</span>
                          <span data-lang="ENG" style="display: none;">1000m</span>
                          <span data-lang="ESP" style="display: none;">1000m</span>
                        </label>
                      </div>
                    </div>
                    
                    <!-- ì§€ë„ ìƒíƒœ í‘œì‹œ -->
                    <div class="col-md-2 text-end">
                      <small class="text-muted">
                        <i class="bi bi-info-circle me-1"></i>
                        <span id="map-status">300m ë°˜ê²½ ê±°ì£¼ì¸êµ¬ ë°ì´í„°</span>
                      </small>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- ì§€ë„ ì»¨í…Œì´ë„ˆ -->
              <div class="position-relative">
                <div id="analysis-openmap" style="height: 500px; width: 100%; border: 1px solid #dee2e6; border-radius: 8px;">
                  <!-- ì§€ë„ê°€ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                </div>
                
                <!-- ì§€ë„ ë¡œë”© ì˜¤ë²„ë ˆì´ -->
                <div id="map-loading" class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" 
                     style="background: rgba(255,255,255,0.8); border-radius: 8px; display: none;">
                  <div class="text-center">
                    <div class="spinner-border text-primary mb-2" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                    <div class="text-muted">
                      <span data-lang="KOR">ì§€ë„ ë°ì´í„° ë¡œë”© ì¤‘...</span>
                      <span data-lang="ENG" style="display: none;">Loading map data...</span>
                      <span data-lang="ESP" style="display: none;">Cargando datos del mapa...</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- ì§€ë„ ë²”ë¡€ -->
              <div class="row mt-3">
                <div class="col-md-6">
                  <div class="card border-0" style="background-color: #f8f9fa;">
                    <div class="card-body p-2">
                      <h6 class="mb-2">
                        <i class="bi bi-palette me-1"></i>
                        <span data-lang="KOR">ë²”ë¡€</span>
                        <span data-lang="ENG" style="display: none;">Legend</span>
                        <span data-lang="ESP" style="display: none;">Leyenda</span>
                      </h6>
                      <div class="d-flex flex-wrap gap-3">
                        <div class="d-flex align-items-center">
                          <div class="me-2" style="width: 12px; height: 12px; background-color: #dc3545; border-radius: 50%;"></div>
                          <small>
                            <span data-lang="KOR">ë¶„ì„ ìœ„ì¹˜</span>
                            <span data-lang="ENG" style="display: none;">Analysis Location</span>
                            <span data-lang="ESP" style="display: none;">UbicaciÃ³n de AnÃ¡lisis</span>
                          </small>
                        </div>
                        <div class="d-flex align-items-center" id="legend-population">
                          <div class="me-2" style="width: 12px; height: 12px; background-color: #28a745; border-radius: 50%;"></div>
                          <small>
                            <span data-lang="KOR">ê±°ì£¼ì¸êµ¬</span>
                            <span data-lang="ENG" style="display: none;">Population</span>
                            <span data-lang="ESP" style="display: none;">PoblaciÃ³n</span>
                          </small>
                        </div>
                        <div class="d-flex align-items-center" id="legend-workplace" style="display: none;">
                          <div class="me-2" style="width: 12px; height: 12px; background-color: #007bff; border-radius: 50%;"></div>
                          <small>
                            <span data-lang="KOR">ì§ì¥ì¸êµ¬</span>
                            <span data-lang="ENG" style="display: none;">Workplace</span>
                            <span data-lang="ESP" style="display: none;">Trabajo</span>
                          </small>
                        </div>
                        <div class="d-flex align-items-center" id="legend-shops" style="display: none;">
                          <div class="me-2" style="width: 12px; height: 12px; background-color: #ffc107; border-radius: 50%;"></div>
                          <small>
                            <span data-lang="KOR">ìƒì </span>
                            <span data-lang="ENG" style="display: none;">Shops</span>
                            <span data-lang="ESP" style="display: none;">Tiendas</span>
                          </small>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card border-0" style="background-color: #f8f9fa;">
                    <div class="card-body p-2">
                      <h6 class="mb-2">
                        <i class="bi bi-circle me-1"></i>
                        <span data-lang="KOR">ë¶„ì„ ë°˜ê²½</span>
                        <span data-lang="ENG" style="display: none;">Analysis Radius</span>
                        <span data-lang="ESP" style="display: none;">Radio de AnÃ¡lisis</span>
                      </h6>
                      <div class="d-flex flex-wrap gap-3">
                        <div class="d-flex align-items-center">
                          <div class="me-2" style="width: 20px; height: 3px; background-color: #4a90e2; border-radius: 2px;"></div>
                          <small>300m</small>
                        </div>
                        <div class="d-flex align-items-center">
                          <div class="me-2" style="width: 20px; height: 3px; background-color: #f44336; border-radius: 2px;"></div>
                          <small>1000m</small>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- ì‚¬ìš©ë²• ì•ˆë‚´ -->
              <div class="alert alert-info mt-3">
                <div class="row">
                  <div class="col-md-6">
                    <h6 class="alert-heading mb-2">
                      <i class="bi bi-lightbulb me-2"></i>
                      <span data-lang="KOR">ì§€ë„ ì‚¬ìš©ë²•</span>
                      <span data-lang="ENG" style="display: none;">How to Use Map</span>
                      <span data-lang="ESP" style="display: none;">CÃ³mo Usar el Mapa</span>
                    </h6>
                    <ul class="mb-0" style="font-size: 0.85rem;">
                      <li data-lang="KOR">ìƒë‹¨ íƒ­ì„ í´ë¦­í•˜ì—¬ í‘œì‹œí•  ë°ì´í„° ì„ íƒ</li>
                      <li data-lang="ENG" style="display: none;">Click top tabs to select data to display</li>
                      <li data-lang="ESP" style="display: none;">Haga clic en las pestaÃ±as superiores para seleccionar datos</li>
                      
                      <li data-lang="KOR">300m/1000m ë²„íŠ¼ìœ¼ë¡œ ë¶„ì„ ë°˜ê²½ ì¡°ì •</li>
                      <li data-lang="ENG" style="display: none;">Use 300m/1000m buttons to adjust analysis radius</li>
                      <li data-lang="ESP" style="display: none;">Use botones 300m/1000m para ajustar radio de anÃ¡lisis</li>
                    </ul>
                  </div>
                  <div class="col-md-6">
                    <h6 class="alert-heading mb-2">
                      <i class="bi bi-mouse me-2"></i>
                      <span data-lang="KOR">ìƒì  ì •ë³´ ë³´ê¸°</span>
                      <span data-lang="ENG" style="display: none;">View Shop Information</span>
                      <span data-lang="ESP" style="display: none;">Ver InformaciÃ³n de Tienda</span>
                    </h6>
                    <ul class="mb-0" style="font-size: 0.85rem;">
                      <li data-lang="KOR">ìƒì  ë§ˆì»¤ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ê°„ë‹¨í•œ ì •ë³´ í‘œì‹œ</li>
                      <li data-lang="ENG" style="display: none;">Hover over shop markers for brief info</li>
                      <li data-lang="ESP" style="display: none;">Pase el cursor sobre marcadores de tienda para info</li>
                      
                      <li data-lang="KOR">ìƒì  ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ íŒì—…</li>
                      <li data-lang="ENG" style="display: none;">Click shop markers for detailed popup</li>
                      <li data-lang="ESP" style="display: none;">Haga clic en marcadores para popup detallado</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            {% else %}
            <!-- ë¹„íšŒì›ìš© ì§€ë„ ì•ˆë‚´ -->
            <div class="mb-4">
              <div class="alert alert-warning">
                <div class="row align-items-center">
                  <div class="col-md-8">
                    <h6 class="mb-2">
                      <i class="bi bi-map me-2"></i>
                      <span data-lang="KOR">ìƒê¶Œ ìœ„ì¹˜ ì§€ë„ (íšŒì› ì „ìš©)</span>
                      <span data-lang="ENG" style="display: none;">Commercial Area Map (Members Only)</span>
                      <span data-lang="ESP" style="display: none;">Mapa del Ãrea Comercial (Solo Miembros)</span>
                    </h6>
                    <p class="mb-0">
                      <span data-lang="KOR">ì¸í„°ë™í‹°ë¸Œ ì§€ë„ë¡œ ê±°ì£¼ì¸êµ¬, ì§ì¥ì¸êµ¬, ì£¼ë³€ìƒì  ë¶„í¬ë¥¼ í™•ì¸í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</span>
                      <span data-lang="ENG" style="display: none;">Login is required to view population, workplace, and nearby shops distribution on interactive map.</span>
                      <span data-lang="ESP" style="display: none;">Se requiere iniciar sesiÃ³n para ver la distribuciÃ³n de poblaciÃ³n, lugares de trabajo y tiendas cercanas en el mapa interactivo.</span>
                    </p>
                  </div>
                  <div class="col-md-4 text-end">
                    <a href="{% url 'custom_auth:login' %}?next={{ request.get_full_path }}" class="btn btn-warning">
                      <i class="bi bi-box-arrow-in-right me-1"></i>
                      <span data-lang="KOR">ë¡œê·¸ì¸í•˜ê¸°</span>
                      <span data-lang="ENG" style="display: none;">Login</span>
                      <span data-lang="ESP" style="display: none;">Iniciar SesiÃ³n</span>
                    </a>
                  </div>
                </div>
              </div>
            </div>
            {% endif %}

            <!-- PDF ì €ì¥ ë²„íŠ¼ -->
            <div class="text-center">
              <button id="pdfSaveBtn" class="btn btn-primary" onclick="generatePDF()">
                <i class="bi bi-file-earmark-pdf me-2"></i>
                <span data-lang="KOR">PDFë¡œ ì €ì¥</span>
                <span data-lang="ENG" style="display: none;">Save as PDF</span>
                <span data-lang="ESP" style="display: none;">Guardar como PDF</span>
              </button>
              <div id="guestPdfMessage" style="display: none;" class="alert alert-info mt-3">
                <i class="bi bi-info-circle me-2"></i>
                <strong>
                  <span data-lang="KOR">ë¹„íšŒì› ì œí•œ:</span>
                  <span data-lang="ENG" style="display: none;">Non-member restriction:</span>
                  <span data-lang="ESP" style="display: none;">RestricciÃ³n de no miembro:</span>
                </strong> 
                <span data-lang="KOR">PDF ì €ì¥ ê¸°ëŠ¥ì€ íšŒì›ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
                <span data-lang="ENG" style="display: none;">PDF save function is only available to members.</span>
                <span data-lang="ESP" style="display: none;">La funciÃ³n de guardar PDF solo estÃ¡ disponible para miembros.</span>
                <a href="{% url 'custom_auth:login' %}?next={{ request.get_full_path }}" class="btn btn-sm btn-outline-primary ms-2">
                  <span data-lang="KOR">ë¡œê·¸ì¸í•˜ê¸°</span>
                  <span data-lang="ENG" style="display: none;">Login</span>
                  <span data-lang="ESP" style="display: none;">Iniciar SesiÃ³n</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½: ë¶„ì„ê²°ê³¼ ì±—ë´‡ -->
      <div class="col-lg-4">
        <div class="card p-4 shadow-sm chatbot-sticky" style="height: 845px; max-height: 845px; overflow: hidden;">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">
              <span data-lang="KOR">ë¶„ì„ê²°ê³¼ ìƒë‹´</span>
              <span data-lang="ENG" style="display: none;">Analysis Consultation</span>
              <span data-lang="ESP" style="display: none;">Consulta de AnÃ¡lisis</span>
            </h5>
            <span class="badge bg-secondary" id="chatbotStatus">
              <span data-lang="KOR">ëŒ€ê¸°ì¤‘</span>
              <span data-lang="ENG" style="display: none;">Waiting</span>
              <span data-lang="ESP" style="display: none;">Esperando</span>
            </span>
          </div>
          
          <!-- ì±—ë´‡ ì»¨í…Œì´ë„ˆ -->
          <div id="chatbotContainer" class="d-flex flex-column h-100">
            
            <!-- ë¹„í™œì„±í™” ìƒíƒœ (ê¸°ë³¸) - ê°„ë‹¨í•œ ì•ˆë‚´ë§Œ -->
            <div id="chatbotInactive" class="text-center d-flex flex-column justify-content-center h-100">
              <i class="bi bi-chat-dots text-muted mb-3" style="font-size: 4rem;"></i>
              <h5 class="text-muted mb-3">
                <span data-lang="KOR">ë¶„ì„ê²°ê³¼ ìƒë‹´ AI</span>
                <span data-lang="ENG" style="display: none;">Analysis Consultation AI</span>
                <span data-lang="ESP" style="display: none;">IA de Consulta de AnÃ¡lisis</span>
              </h5>
              {% if not user.is_authenticated %}
                <p class="text-muted mb-3">
                  <span data-lang="KOR">ìƒê¶Œ ë¶„ì„ ê²°ê³¼ì— ëŒ€í•´<br>AIì™€ ìƒë‹´í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</span>
                  <span data-lang="ENG" style="display: none;">Login is required to<br>consult with AI about analysis results.</span>
                  <span data-lang="ESP" style="display: none;">Se requiere iniciar sesiÃ³n para<br>consultar con IA sobre los resultados del anÃ¡lisis.</span>
                </p>
                <a href="{% url 'custom_auth:login' %}?next={{ request.get_full_path }}" class="btn btn-primary btn-sm">
                  <i class="bi bi-box-arrow-in-right me-2"></i>
                  <span data-lang="KOR">ë¡œê·¸ì¸í•˜ê¸°</span>
                  <span data-lang="ENG" style="display: none;">Login</span>
                  <span data-lang="ESP" style="display: none;">Iniciar SesiÃ³n</span>
                </a>
              {% else %}
                <p class="text-muted mb-3">
                  <span data-lang="KOR">ìƒê¶Œ ë¶„ì„ì„ ì™„ë£Œí•˜ë©´<br>AI ìƒë‹´ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
                  <span data-lang="ENG" style="display: none;">Once commercial analysis is complete,<br>you can use AI consultation service.</span>
                  <span data-lang="ESP" style="display: none;">Una vez completado el anÃ¡lisis comercial,<br>puede usar el servicio de consulta IA.</span>
                </p>
                <div class="d-flex align-items-center justify-content-center">
                  <i class="bi bi-lock me-2 text-secondary"></i>
                  <span class="text-secondary small">
                    <span data-lang="KOR">ë¶„ì„ ì™„ë£Œ í›„ ìë™ í™œì„±í™”</span>
                    <span data-lang="ENG" style="display: none;">Auto-activated after analysis</span>
                    <span data-lang="ESP" style="display: none;">ActivaciÃ³n automÃ¡tica despuÃ©s del anÃ¡lisis</span>
                  </span>
                </div>
              {% endif %}
          </div>

            <!-- í™œì„±í™” ìƒíƒœ (ë¶„ì„ ì™„ë£Œ í›„) - ì™„ì „í•œ ì±—ë´‡ UI -->
            <div id="chatbotActive" class="d-flex flex-column h-100" style="display: none !important;">
              
              <!-- ì¶”ì²œ ì§ˆë¬¸ ë²„íŠ¼ -->
              <div class="mb-3">
                <small class="text-muted">
                  <span data-lang="KOR">ğŸ’¡ ì¶”ì²œ ì§ˆë¬¸</span>
                  <span data-lang="ENG" style="display: none;">ğŸ’¡ Recommended Questions</span>
                  <span data-lang="ESP" style="display: none;">ğŸ’¡ Preguntas Recomendadas</span>
                </small>
                <div class="mt-2">
                  <button class="btn btn-sm btn-outline-primary me-1 mb-1" data-question-type="survival">
                    <i class="bi bi-graph-up me-1"></i>
                    <span data-lang="KOR">ìƒì¡´ í™•ë¥ </span>
                    <span data-lang="ENG" style="display: none;">Survival Rate</span>
                    <span data-lang="ESP" style="display: none;">Probabilidad</span>
                  </button>
                  <button class="btn btn-sm btn-outline-warning me-1 mb-1" data-question-type="competition">
                    <i class="bi bi-shop me-1"></i>
                    <span data-lang="KOR">ê²½ìŸ í˜„í™©</span>
                    <span data-lang="ENG" style="display: none;">Competition</span>
                    <span data-lang="ESP" style="display: none;">Competencia</span>
                  </button>
                  <button class="btn btn-sm btn-outline-success me-1 mb-1" data-question-type="precautions">
                    <i class="bi bi-exclamation-triangle me-1"></i>
                    <span data-lang="KOR">ì£¼ì˜ì‚¬í•­</span>
                    <span data-lang="ENG" style="display: none;">Precautions</span>
                    <span data-lang="ESP" style="display: none;">Precauciones</span>
                  </button>
                </div>
          </div>

              <!-- ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ -->
              <div id="chatMessages" class="flex-grow-1 overflow-auto mb-3 border rounded p-3" style="background-color: #f8f9fa; min-height: 470px;">
                <div class="d-flex align-items-start mb-3">
                  <div class="bg-gradient bg-primary rounded-circle me-2 d-flex align-items-center justify-content-center" style="width: 36px; height: 36px; min-width: 36px;">
                    <i class="bi bi-robot text-white" style="font-size: 16px;"></i>
        </div>
                  <div class="flex-grow-1">
                    <div class="bg-white rounded-3 p-3 shadow-sm border">
                      <div class="d-flex align-items-center mb-2">
                        <strong class="text-primary me-2">
                          <span data-lang="KOR">ë¶„ì„ê²°ê³¼ ìƒë‹´ AI</span>
                          <span data-lang="ENG" style="display: none;">Analysis Consultation AI</span>
                          <span data-lang="ESP" style="display: none;">IA de Consulta de AnÃ¡lisis</span>
                        </strong>
                        <span class="badge bg-success-subtle text-success">
                          <span data-lang="KOR">ì˜¨ë¼ì¸</span>
                          <span data-lang="ENG" style="display: none;">Online</span>
                          <span data-lang="ESP" style="display: none;">En lÃ­nea</span>
                        </span>
                      </div>
                      <p class="mb-0">
                        <span data-lang="KOR">ì•ˆë…•í•˜ì„¸ìš”! ğŸ¯ ë°©ê¸ˆ ì™„ë£Œëœ ìƒê¶Œ ë¶„ì„ ê²°ê³¼ì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë¬¼ì–´ë³´ì„¸ìš”.<br><br>
                        <strong>ìƒë‹´ ê°€ëŠ¥í•œ ë‚´ìš©:</strong><br>
                        â€¢ ğŸ“Š AI ìƒì¡´ í™•ë¥  í•´ì„<br>
                        â€¢ ğŸ‘¥ ì¸êµ¬ ë° ê³ ê°ì¸µ ë¶„ì„<br>
                        â€¢ ğŸª ê²½ìŸì—…ì²´ í˜„í™©<br>
                        â€¢ ğŸ’° ìˆ˜ìµì„± ì „ë§<br>
                        â€¢ ğŸš€ ì°½ì—… ì „ëµ ì¡°ì–¸</span>
                        <span data-lang="ENG" style="display: none;">Hello! ğŸ¯ If you have any questions about the commercial analysis results just completed, please feel free to ask anytime.<br><br>
                        <strong>Available consultation topics:</strong><br>
                        â€¢ ğŸ“Š AI survival probability interpretation<br>
                        â€¢ ğŸ‘¥ Population and customer analysis<br>
                        â€¢ ğŸª Competitor status<br>
                        â€¢ ğŸ’° Profitability outlook<br>
                        â€¢ ğŸš€ Business strategy advice</span>
                        <span data-lang="ESP" style="display: none;">Â¡Hola! ğŸ¯ Si tiene alguna pregunta sobre los resultados del anÃ¡lisis comercial reciÃ©n completado, no dude en preguntar en cualquier momento.<br><br>
                        <strong>Temas de consulta disponibles:</strong><br>
                        â€¢ ğŸ“Š InterpretaciÃ³n de probabilidad de supervivencia IA<br>
                        â€¢ ğŸ‘¥ AnÃ¡lisis de poblaciÃ³n y clientes<br>
                        â€¢ ğŸª Estado de competidores<br>
                        â€¢ ğŸ’° Perspectiva de rentabilidad<br>
                        â€¢ ğŸš€ Consejos de estrategia empresarial</span>
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ì…ë ¥ ì˜ì—­ -->
                              <div class="mt-auto">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <small class="text-muted">
                    <i class="bi bi-shield-check me-1"></i>
                    <span data-lang="KOR">í˜„ì¬ ë¶„ì„ ì„¸ì…˜ ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹µë³€</span>
                    <span data-lang="ENG" style="display: none;">Answers based on current analysis session results</span>
                    <span data-lang="ESP" style="display: none;">Respuestas basadas en resultados de la sesiÃ³n de anÃ¡lisis actual</span>
                  </small>
                  <button class="btn btn-sm btn-outline-secondary" onclick="openChatbotPIP()" title="í™•ëŒ€ ë³´ê¸°">
                    <i class="bi bi-arrows-fullscreen"></i>
                  </button>
                </div>
                
                <!-- ëª¨ë“œ ì„ íƒ í† ê¸€ -->
                <div class="d-flex justify-content-center mb-2">
                  <div class="btn-group btn-group-sm" role="group" aria-label="ì±—ë´‡ ëª¨ë“œ ì„ íƒ">
                    <input type="radio" class="btn-check" name="analyzerChatMode" id="analyzerLlmMode" value="llm" checked autocomplete="off">
                    <label class="btn btn-outline-primary" for="analyzerLlmMode">
                      <i class="bi bi-brain me-1"></i>LLM
                    </label>
                    
                    <input type="radio" class="btn-check" name="analyzerChatMode" id="analyzerRagMode" value="rag" autocomplete="off">
                    <label class="btn btn-outline-success" for="analyzerRagMode">
                      <i class="bi bi-database me-1"></i>RAG
                    </label>
                  </div>
                  <i class="bi bi-info-circle text-muted ms-2" data-bs-toggle="tooltip" data-bs-placement="top" 
                     title="LLM: ì¼ë°˜ ëŒ€í™”í˜• AI | RAG: ë²¡í„°DB ê¸°ë°˜ ì •ë³´ ê²€ìƒ‰" style="cursor: help;"></i>
                </div>
                
                <div class="input-group">
                  <input type="text" id="chatInput" class="form-control" disabled>
                  <button class="btn btn-primary" id="chatSendBtn" type="button" disabled>
                    <i class="bi bi-send-fill"></i>
                  </button>
                </div>
                <div id="chatConnectionStatus" class="mt-2" style="display: none;">
                  <small class="text-primary">
                    <span class="spinner-border spinner-border-sm me-1" role="status"></span>
                    <span data-lang="KOR">AI ì—°ê²° ì¤‘...</span>
                    <span data-lang="ENG" style="display: none;">Connecting to AI...</span>
                    <span data-lang="ESP" style="display: none;">Conectando a IA...</span>
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PDF ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ (ë¶„ì„ ê¸°ë¡ìš©) -->
  <div class="modal fade" id="pdfPreviewModal" tabindex="-1" aria-labelledby="pdfPreviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="pdfPreviewModalLabel">
            <i class="bi bi-file-earmark-pdf me-2"></i>
            <span data-lang="KOR">ë¶„ì„ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°</span>
            <span data-lang="ENG" style="display: none;">Analysis Result Preview</span>
            <span data-lang="ESP" style="display: none;">Vista Previa del Resultado del AnÃ¡lisis</span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
          <div id="previewLoading" class="text-center">
            <div class="spinner-border text-primary mb-3" role="status">
              <span class="visually-hidden">
                <span data-lang="KOR">ë¡œë”© ì¤‘...</span>
                <span data-lang="ENG" style="display: none;">Loading...</span>
                <span data-lang="ESP" style="display: none;">Cargando...</span>
              </span>
            </div>
            <h6>
              <span data-lang="KOR">ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</span>
              <span data-lang="ENG" style="display: none;">Loading analysis results...</span>
              <span data-lang="ESP" style="display: none;">Cargando resultados del anÃ¡lisis...</span>
            </h6>
            <p class="text-muted">
              <span data-lang="KOR">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</span>
              <span data-lang="ENG" style="display: none;">Please wait a moment.</span>
              <span data-lang="ESP" style="display: none;">Por favor espere un momento.</span>
            </p>
          </div>
          
          <div id="previewError" style="display: none;" class="text-center">
            <i class="bi bi-exclamation-triangle text-warning mb-3" style="font-size: 3rem;"></i>
            <h6>ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h6>
            <p class="text-muted" id="previewErrorMessage">ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</p>
          </div>
          
          <!-- PDF ìŠ¤íƒ€ì¼ ë¯¸ë¦¬ë³´ê¸° ë‚´ìš© -->
          <div id="previewContent" style="display: none; background: white; padding: 30px; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); font-family: 'Nanum Gothic', Arial, sans-serif;">
            <!-- í—¤ë” -->
            <div class="text-center mb-4" style="border-bottom: 3px solid #1e3a8a; padding-bottom: 20px;">
              <h2 class="text-primary mb-1" style="font-weight: 800; font-size: 24px;" id="previewReportTitle">
                <span data-lang="KOR">AI ìƒê¶Œë¶„ì„ ë³´ê³ ì„œ</span>
                <span data-lang="ENG" style="display: none;">AI Commercial Area Analysis Report</span>
                <span data-lang="ESP" style="display: none;">Informe de AnÃ¡lisis de Ãrea Comercial IA</span>
              </h2>
              <p class="text-muted mb-0" style="font-size: 14px;" id="previewReportSubtitle">
                <span data-lang="KOR">ì¸ê³µì§€ëŠ¥ ê¸°ë°˜ ìƒì—…ì§€êµ¬ ë¶„ì„ ê²°ê³¼</span>
                <span data-lang="ENG" style="display: none;">AI-Based Commercial Area Analysis Results</span>
                <span data-lang="ESP" style="display: none;">Resultados del AnÃ¡lisis de Ãrea Comercial Basado en IA</span>
              </p>
            </div>
            
            <!-- ê¸°ë³¸ ì •ë³´ -->
            <div class="mb-4" style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #1e3a8a;">
              <h5 class="text-primary mb-3">
                <i class="bi bi-geo-alt me-2"></i>
                <span data-lang="KOR">ë¶„ì„ ëŒ€ìƒ ì •ë³´</span>
                <span data-lang="ENG" style="display: none;">Analysis Target Information</span>
                <span data-lang="ESP" style="display: none;">InformaciÃ³n del Objetivo de AnÃ¡lisis</span>
              </h5>
              <div class="row">
                <div class="col-md-6">
                  <p><strong>
                    <span data-lang="KOR">ì£¼ì†Œ:</span>
                    <span data-lang="ENG" style="display: none;">Address:</span>
                    <span data-lang="ESP" style="display: none;">DirecciÃ³n:</span>
                  </strong> <span id="previewAddr">-</span></p>
                  <p><strong>
                    <span data-lang="KOR">ì—…ì¢…:</span>
                    <span data-lang="ENG" style="display: none;">Business Type:</span>
                    <span data-lang="ESP" style="display: none;">Tipo de Negocio:</span>
                  </strong> <span id="previewBizType">-</span></p>
                </div>
                <div class="col-md-6">
                  <p><strong>
                    <span data-lang="KOR">ë©´ì :</span>
                    <span data-lang="ENG" style="display: none;">Area:</span>
                    <span data-lang="ESP" style="display: none;">Ãrea:</span>
                  </strong> <span id="previewAreaSize">-</span>ã¡</p>
                  <p><strong>
                    <span data-lang="KOR">ë¶„ì„ì¼ì‹œ:</span>
                    <span data-lang="ENG" style="display: none;">Analysis Date:</span>
                    <span data-lang="ESP" style="display: none;">Fecha de AnÃ¡lisis:</span>
                  </strong> <span id="previewAnalysisDate">-</span></p>
                </div>
              </div>
            </div>
            
            <!-- AI ìƒì¡´ í™•ë¥  -->
            <div class="mb-4" style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
              <h5 class="text-success mb-3">
                <i class="bi bi-robot me-2"></i>
                <span data-lang="KOR">AI ìƒì¡´ í™•ë¥ </span>
                <span data-lang="ENG" style="display: none;">AI Survival Probability</span>
                <span data-lang="ESP" style="display: none;">Probabilidad de Supervivencia IA</span>
              </h5>
              <div class="display-4 mb-3 text-primary" id="previewSurvivalRate" style="font-weight: 800;">-%</div>
              <div class="progress mb-3" style="height: 20px;">
                <div class="progress-bar" id="previewSurvivalProgressBar" role="progressbar" style="width: 0%"></div>
              </div>
              <p class="text-muted mb-0" id="previewSurvivalComment">
                <span data-lang="KOR">ë¶„ì„ ì¤‘...</span>
                <span data-lang="ENG" style="display: none;">Analyzing...</span>
                <span data-lang="ESP" style="display: none;">Analizando...</span>
              </p>
            </div>
            
            <!-- í•µì‹¬ ì§€í‘œ -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3">
                <i class="bi bi-speedometer me-2"></i>
                <span data-lang="KOR">í•µì‹¬ ì§€í‘œ</span>
                <span data-lang="ENG" style="display: none;">Key Indicators</span>
                <span data-lang="ESP" style="display: none;">Indicadores Clave</span>
              </h5>
              <div class="row">
                <div class="col-md-3">
                  <div class="card border-info h-100 text-center">
                    <div class="card-body">
                      <i class="bi bi-people text-info mb-2" style="font-size: 2rem;"></i>
                      <h6 class="card-title">
                        <span data-lang="KOR">ìƒí™œì¸êµ¬</span>
                        <span data-lang="ENG" style="display: none;">Residential Pop.</span>
                        <span data-lang="ESP" style="display: none;">Pob. Residente</span>
                      </h6>
                      <p class="card-text fw-bold text-primary" id="previewLifePopulation">-</p>
                      <small class="text-muted">
                        <span data-lang="KOR">300m ë°˜ê²½</span>
                        <span data-lang="ENG" style="display: none;">300m radius</span>
                        <span data-lang="ESP" style="display: none;">radio 300m</span>
                      </small>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card border-warning h-100 text-center">
                    <div class="card-body">
                      <i class="bi bi-briefcase text-warning mb-2" style="font-size: 2rem;"></i>
                      <h6 class="card-title">
                        <span data-lang="KOR">ì§ì¥ì¸êµ¬</span>
                        <span data-lang="ENG" style="display: none;">Working Pop.</span>
                        <span data-lang="ESP" style="display: none;">Pob. Trabajadora</span>
                      </h6>
                      <p class="card-text fw-bold text-primary" id="previewWorkingPopulation">-</p>
                      <small class="text-muted">
                        <span data-lang="KOR">300m ë°˜ê²½</span>
                        <span data-lang="ENG" style="display: none;">300m radius</span>
                        <span data-lang="ESP" style="display: none;">radio 300m</span>
                      </small>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card border-danger h-100 text-center">
                    <div class="card-body">
                      <i class="bi bi-shop text-danger mb-2" style="font-size: 2rem;"></i>
                      <h6 class="card-title">
                        <span data-lang="KOR">ê²½ìŸì—…ì²´</span>
                        <span data-lang="ENG" style="display: none;">Competitors</span>
                        <span data-lang="ESP" style="display: none;">Competidores</span>
                      </h6>
                      <p class="card-text fw-bold text-primary" id="previewCompetitors">-</p>
                      <small class="text-muted">
                        <span data-lang="KOR">300m ë°˜ê²½</span>
                        <span data-lang="ENG" style="display: none;">300m radius</span>
                        <span data-lang="ESP" style="display: none;">radio 300m</span>
                      </small>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card border-secondary h-100 text-center">
                    <div class="card-body">
                      <i class="bi bi-currency-dollar text-secondary mb-2" style="font-size: 2rem;"></i>
                      <h6 class="card-title">
                        <span data-lang="KOR">ê³µì‹œì§€ê°€</span>
                        <span data-lang="ENG" style="display: none;">Land Price</span>
                        <span data-lang="ESP" style="display: none;">Precio del Terreno</span>
                      </h6>
                      <p class="card-text fw-bold text-primary" id="previewLandPrice">-</p>
                      <small class="text-muted">
                        <span data-lang="KOR">ì´ ê³µì‹œì§€ê°€</span>
                        <span data-lang="ENG" style="display: none;">Total Public Land Price</span>
                        <span data-lang="ESP" style="display: none;">Precio Total del Terreno PÃºblico</span>
                      </small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- ê²½ìŸê°•ë„ ë¶„ì„ -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3">
                <i class="bi bi-shop me-2"></i>
                <span data-lang="KOR">ê²½ìŸê°•ë„ ë¶„ì„</span>
                <span data-lang="ENG" style="display: none;">Competition Analysis</span>
                <span data-lang="ESP" style="display: none;">AnÃ¡lisis de Competencia</span>
              </h5>
              <div class="row">
                <div class="col-md-6">
                  <div class="card h-100">
                    <div class="card-body">
                      <h6 class="card-title">
                        <span data-lang="KOR">ê²½ìŸì—…ì²´ í˜„í™©</span>
                        <span data-lang="ENG" style="display: none;">Competitor Status</span>
                        <span data-lang="ESP" style="display: none;">Estado de la Competencia</span>
                      </h6>
                      <div class="row g-2 text-center">
                        <div class="col-6">
                          <div class="p-2 border rounded">
                            <div class="h5 text-danger" id="previewCompetitorCount">-</div>
                            <small class="text-muted">
                              <span data-lang="KOR">ë™ì¼ì—…ì¢…</span>
                              <span data-lang="ENG" style="display: none;">Same Industry</span>
                              <span data-lang="ESP" style="display: none;">Misma Industria</span>
                            </small>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="p-2 border rounded">
                            <div class="h5 text-warning" id="previewAdjacentBiz">-</div>
                            <small class="text-muted">
                              <span data-lang="KOR">ì¸ì ‘ì—…ì²´</span>
                              <span data-lang="ENG" style="display: none;">Adjacent Businesses</span>
                              <span data-lang="ESP" style="display: none;">Negocios Adyacentes</span>
                            </small>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card h-100">
                    <div class="card-body">
                      <h6 class="card-title">
                        <span data-lang="KOR">ê²½ìŸ ê°•ë„</span>
                        <span data-lang="ENG" style="display: none;">Competition Intensity</span>
                        <span data-lang="ESP" style="display: none;">Intensidad de Competencia</span>
                      </h6>
                      <div class="progress mb-2" style="height: 30px;">
                        <div id="previewCompetitionBar" class="progress-bar" style="width: 0%;"></div>
                      </div>
                      <div class="text-center">
                        <span id="previewCompetitionLevel" class="badge fs-6">
                          <span data-lang="KOR">ë¶„ì„ì¤‘...</span>
                          <span data-lang="ENG" style="display: none;">Analyzing...</span>
                          <span data-lang="ESP" style="display: none;">Analizando...</span>
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ì™¸êµ­ì¸ ë¶„ì„ -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3">
                <i class="bi bi-globe me-2"></i>
                <span data-lang="KOR">ì™¸êµ­ì¸ ë¶„ì„</span>
                <span data-lang="ENG" style="display: none;">Foreigner Analysis</span>
                <span data-lang="ESP" style="display: none;">AnÃ¡lisis de Extranjeros</span>
              </h5>
              <div class="row g-3 text-center">
                <div class="col-md-4">
                  <div class="card h-100">
                    <div class="card-body">
                      <i class="bi bi-airplane text-primary mb-2" style="font-size: 1.5rem;"></i>
                      <h6>
                        <span data-lang="KOR">ë‹¨ê¸°ì²´ë¥˜ ì™¸êµ­ì¸</span>
                        <span data-lang="ENG" style="display: none;">Short-term Foreigners</span>
                        <span data-lang="ESP" style="display: none;">Extranjeros de Corta Estancia</span>
                      </h6>
                      <div class="h5 text-primary" id="previewTempForeign">-</div>
                      <small class="text-muted">
                        <span data-lang="KOR">1000m ë°˜ê²½</span>
                        <span data-lang="ENG" style="display: none;">1000m radius</span>
                        <span data-lang="ESP" style="display: none;">radio de 1000m</span>
                      </small>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card h-100">
                    <div class="card-body">
                      <i class="bi bi-house text-success mb-2" style="font-size: 1.5rem;"></i>
                      <h6>
                        <span data-lang="KOR">ì¥ê¸°ì²´ë¥˜ ì™¸êµ­ì¸</span>
                        <span data-lang="ENG" style="display: none;">Long-term Foreigners</span>
                        <span data-lang="ESP" style="display: none;">Extranjeros de Larga Estancia</span>
                      </h6>
                      <div class="h5 text-success" id="previewLongForeign">-</div>
                      <small class="text-muted">
                        <span data-lang="KOR">300m ë°˜ê²½</span>
                        <span data-lang="ENG" style="display: none;">300m radius</span>
                        <span data-lang="ESP" style="display: none;">radio de 300m</span>
                      </small>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card h-100">
                    <div class="card-body">
                      <i class="bi bi-flag text-warning mb-2" style="font-size: 1.5rem;"></i>
                      <h6>
                        <span data-lang="KOR">ì¤‘êµ­ì¸ ë¹„ìœ¨</span>
                        <span data-lang="ENG" style="display: none;">Chinese Ratio</span>
                        <span data-lang="ESP" style="display: none;">ProporciÃ³n China</span>
                      </h6>
                      <div class="h5 text-warning" id="previewChinaRatio">-</div>
                      <small class="text-muted">
                        <span data-lang="KOR">1000m ë°˜ê²½</span>
                        <span data-lang="ENG" style="display: none;">1000m radius</span>
                        <span data-lang="ESP" style="display: none;">radio de 1000m</span>
                      </small>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë¶„ì„ -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3"><i class="bi bi-people me-2"></i>ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë¶„ì„ (1000m ë°˜ê²½)</h5>
              <div class="row">
                <div class="col-md-6">
                  <div class="card h-100">
                    <div class="card-body text-center">
                      <h6 class="card-title mb-3">ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë¹„ìœ¨</h6>
                      <div style="position: relative; height: 250px; width: 100%;">
                        <canvas id="previewAgeChart" style="max-height: 250px; max-width: 100%;"></canvas>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card h-100">
                    <div class="card-body">
                      <h6 class="card-title mb-3">ì—°ë ¹ëŒ€ë³„ ìƒì„¸ ì •ë³´</h6>
                      <div class="row g-2">
                        <div class="col-6">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #FF6384;" id="previewAge20">-%</div>
                            <small class="text-muted">20ëŒ€</small>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #36A2EB;" id="previewAge30">-%</div>
                            <small class="text-muted">30ëŒ€</small>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #FFCE56;" id="previewAge40">-%</div>
                            <small class="text-muted">40ëŒ€</small>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #4BC0C0;" id="previewAge50">-%</div>
                            <small class="text-muted">50ëŒ€</small>
                          </div>
                        </div>
                        <div class="col-12">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #9966FF;" id="previewAge60">-%</div>
                            <small class="text-muted">60ëŒ€ ì´ìƒ</small>
                          </div>
                        </div>
                      </div>
                      <div class="mt-3 text-center">
                        <small class="text-muted">
                          <i class="bi bi-info-circle me-1"></i>
                          1000m ë°˜ê²½ ë‚´ ìƒí™œì¸êµ¬ ê¸°ì¤€
                        </small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- AI ì¶”ì²œ ì—…ì¢… (íšŒì› ì „ìš©) -->
            <div class="mb-4" id="previewBusinessRecommendations" style="display: none;">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3"><i class="bi bi-star me-2"></i>AI ì¶”ì²œ ì—…ì¢… (íšŒì› ì „ìš©)</h5>
              <div class="row">
                <!-- 1ìœ„ ì—…ì¢… (í° ì¹´ë“œ) -->
                <div class="col-md-6">
                  <div class="card border-warning h-100">
                    <div class="card-body text-center">
                      <div class="badge bg-warning text-dark mb-2 fs-6">ğŸ† 1ìœ„</div>
                      <h5 class="card-title text-warning" id="previewRecommendedBusinessType">-</h5>
                      <div class="display-6 text-warning mb-2" id="previewRecommendedPercentage">-%</div>
                      <div class="progress mb-2" style="height: 10px;">
                        <div class="progress-bar bg-warning" id="previewRecommendedProgressBar" style="width: 0%"></div>
                      </div>
                      <small class="text-muted">AI ì˜ˆì¸¡ ìƒì¡´í™•ë¥ </small>
                    </div>
                  </div>
                </div>
                
                <!-- 2,3,4ìœ„ ì—…ì¢… (ì‘ì€ ì¹´ë“œë“¤) -->
                <div class="col-md-6">
                  <div class="row g-2 h-100">
                    <div class="col-12">
                      <div class="card border-light h-100">
                        <div class="card-body p-2 text-center">
                          <div class="badge bg-secondary mb-1">2ìœ„</div>
                          <h6 class="card-title mb-1" id="previewRecommended2nd">-</h6>
                          <small class="text-muted" id="previewRecommended2ndPercent">-%</small>
                        </div>
                      </div>
                    </div>
                    <div class="col-12">
                      <div class="card border-light h-100">
                        <div class="card-body p-2 text-center">
                          <div class="badge bg-secondary mb-1">3ìœ„</div>
                          <h6 class="card-title mb-1" id="previewRecommended3rd">-</h6>
                          <small class="text-muted" id="previewRecommended3rdPercent">-%</small>
                        </div>
                      </div>
                    </div>
                    <div class="col-12">
                      <div class="card border-light h-100">
                        <div class="card-body p-2 text-center">
                          <div class="badge bg-secondary mb-1">4ìœ„</div>
                          <h6 class="card-title mb-1" id="previewRecommended4th">-</h6>
                          <small class="text-muted" id="previewRecommended4thPercent">-%</small>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- AI ë¶„ì„ ë¦¬í¬íŠ¸ (íšŒì› ì „ìš©) -->
            <div class="mb-4" id="previewAiReport" style="display: none;">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3"><i class="bi bi-cpu me-2"></i>AI ë¶„ì„ ë¦¬í¬íŠ¸</h5>
              <div class="card border-info">
                <div class="card-body">
                  <div id="previewAiReportContent" class="ai-report-content" style="line-height: 1.6; font-size: 14px;">
                    <!-- AI ë¶„ì„ ë¦¬í¬íŠ¸ ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                  </div>
                </div>
              </div>
            </div>

            <!-- ê°•ì /ì£¼ì˜ì‚¬í•­ -->
            <div class="row mb-4">
              <div class="col-md-6">
                <div class="card border-success h-100">
                  <div class="card-header bg-light">
                    <h6 class="mb-0 text-success"><i class="bi bi-check-circle me-2"></i>ê°•ì </h6>
                  </div>
                  <div class="card-body" id="previewStrengthsList">
                    <ul class="list-unstyled mb-0">
                      <li class="text-muted">ë¶„ì„ ì¤‘...</li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card border-warning h-100">
                  <div class="card-header bg-light">
                    <h6 class="mb-0 text-warning"><i class="bi bi-exclamation-triangle me-2"></i>ì£¼ì˜ì‚¬í•­</h6>
                  </div>
                  <div class="card-body" id="previewCautionsList">
                    <ul class="list-unstyled mb-0">
                      <li class="text-muted">ë¶„ì„ ì¤‘...</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- ë³´ê³ ì„œ í•˜ë‹¨ -->
            <div class="text-center text-muted" style="border-top: 1px solid #dee2e6; padding-top: 20px;">
              <small>
                <span data-lang="KOR">ë³¸ ë³´ê³ ì„œëŠ” AI ê¸°ë°˜ ìƒê¶Œë¶„ì„ ì‹œìŠ¤í…œì— ì˜í•´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
                ë¶„ì„ ê¸°ì¤€ì¼:</span>
                <span data-lang="ENG" style="display: none;">This report was generated by an AI-based commercial area analysis system.<br>
                Analysis Date:</span>
                <span data-lang="ESP" style="display: none;">Este informe fue generado por un sistema de anÃ¡lisis de Ã¡rea comercial basado en IA.<br>
                Fecha de AnÃ¡lisis:</span>
                <span id="previewReportGeneratedDate"></span>
              </small>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <span data-lang="KOR">ë‹«ê¸°</span>
            <span data-lang="ENG" style="display: none;">Close</span>
            <span data-lang="ESP" style="display: none;">Cerrar</span>
          </button>
          <div class="btn-group">
            <button type="button" class="btn btn-primary" id="previewDownloadPdfBtn" onclick="downloadPreviewPDF()" style="display: none;">
              <i class="bi bi-download me-2"></i>
              <span data-lang="KOR">ê³ í’ˆì§ˆ PDF (ì´ë¯¸ì§€)</span>
              <span data-lang="ENG" style="display: none;">High Quality PDF (Image)</span>
              <span data-lang="ESP" style="display: none;">PDF de Alta Calidad (Imagen)</span>
            </button>
            <button type="button" class="btn btn-outline-primary" id="previewDownloadLightPdfBtn" onclick="downloadPreviewLightweightPDF()" style="display: none;">
              <i class="bi bi-file-text me-2"></i>
              <span data-lang="KOR">ê²½ëŸ‰ PDF (í…ìŠ¤íŠ¸)</span>
              <span data-lang="ENG" style="display: none;">Lightweight PDF (Text)</span>
              <span data-lang="ESP" style="display: none;">PDF Ligero (Texto)</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PDF ë‹¤ìš´ë¡œë“œ ëª¨ë‹¬ -->
  <div class="modal fade" id="pdfModal" tabindex="-1" aria-labelledby="pdfModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="pdfModalLabel">
            <i class="bi bi-file-earmark-pdf me-2"></i>AI ìƒê¶Œë¶„ì„ ë³´ê³ ì„œ ë¯¸ë¦¬ë³´ê¸°
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="pdfGenerating" style="display: none;" class="text-center">
            <div class="spinner-border text-primary mb-3" role="status">
              <span class="visually-hidden">ìƒì„± ì¤‘...</span>
            </div>
            <h6>PDF ë³´ê³ ì„œë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</h6>
            <p class="text-muted">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</p>
          </div>
          
          <div id="pdfError" style="display: none;" class="text-center">
            <i class="bi bi-exclamation-triangle text-warning mb-3" style="font-size: 3rem;"></i>
            <h6>PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h6>
            <p class="text-muted" id="pdfErrorMessage">ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</p>
          </div>
          
          <!-- PDF ë¯¸ë¦¬ë³´ê¸° ë‚´ìš© -->
          <div id="pdfPreviewContainer" style="background: white; padding: 30px; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <div class="text-center mb-4">
              <h2 class="text-primary mb-1" style="font-weight: 700;">AI ìƒê¶Œë¶„ì„ ë³´ê³ ì„œ</h2>
              <p class="text-muted mb-0">ì¸ê³µì§€ëŠ¥ ê¸°ë°˜ ìƒì—…ì§€êµ¬ ë¶„ì„ ê²°ê³¼</p>
              <hr class="my-3" style="border-color: #1e3a8a; border-width: 2px;">
            </div>
            
            <!-- ê¸°ë³¸ ì •ë³´ -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card border-primary">
                  <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-geo-alt me-2"></i>ë¶„ì„ ëŒ€ìƒ ì •ë³´</h5>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-6">
                        <p><strong>ì£¼ì†Œ:</strong> <span id="previewAddress">-</span></p>
                        <p><strong>ì—…ì¢…:</strong> <span id="previewBusinessType">-</span></p>
                      </div>
                      <div class="col-md-6">
                        <p><strong>ë©´ì :</strong> <span id="previewArea">-</span></p>
                        <p><strong>ë¶„ì„ì¼ì‹œ:</strong> <span id="previewDate">-</span></p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- AI ìƒì¡´ í™•ë¥  -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card border-success">
                  <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-robot me-2"></i>AI ìƒì¡´ í™•ë¥ </h5>
                  </div>
                  <div class="card-body text-center">
                    <div class="display-4 mb-3" id="previewSurvival">-%</div>
                    <div class="progress mb-3" style="height: 20px;">
                      <div class="progress-bar" id="previewSurvivalBar" role="progressbar" style="width: 0%"></div>
                    </div>
                    <p class="text-muted mb-0" id="previewSurvivalText">ë¶„ì„ ì¤‘...</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- í•µì‹¬ ì§€í‘œ -->
            <div class="row mb-4">
              <div class="col-md-3">
                <div class="card border-info h-100">
                  <div class="card-body text-center">
                    <i class="bi bi-people text-info mb-2" style="font-size: 2rem;"></i>
                    <h6 class="card-title">ìƒí™œì¸êµ¬</h6>
                    <p class="card-text fw-bold" id="previewLifePop">-</p>
                    <small class="text-muted">300m ë°˜ê²½</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card border-warning h-100">
                  <div class="card-body text-center">
                    <i class="bi bi-briefcase text-warning mb-2" style="font-size: 2rem;"></i>
                    <h6 class="card-title">ì§ì¥ì¸êµ¬</h6>
                    <p class="card-text fw-bold" id="previewWorkingPop">-</p>
                    <small class="text-muted">300m ë°˜ê²½</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card border-danger h-100">
                  <div class="card-body text-center">
                    <i class="bi bi-shop text-danger mb-2" style="font-size: 2rem;"></i>
                    <h6 class="card-title">ê²½ìŸì—…ì²´</h6>
                    <p class="card-text fw-bold" id="previewCompetitor">-</p>
                    <small class="text-muted">300m ë°˜ê²½</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card border-secondary h-100">
                  <div class="card-body text-center">
                    <i class="bi bi-currency-dollar text-secondary mb-2" style="font-size: 2rem;"></i>
                    <h6 class="card-title">ê³µì‹œì§€ê°€</h6>
                    <p class="card-text fw-bold" id="previewLandValue">-</p>
                    <small class="text-muted">ì´ ê³µì‹œì§€ê°€</small>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- ê²½ìŸê°•ë„ ë¶„ì„ -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card border-warning">
                  <div class="card-header bg-warning text-white">
                    <h5 class="mb-0"><i class="bi bi-shop me-2"></i>ê²½ìŸê°•ë„ ë¶„ì„</h5>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-6">
                        <h6>ê²½ìŸì—…ì²´ í˜„í™©</h6>
                        <div class="row g-2 text-center mb-3">
                          <div class="col-6">
                            <div class="p-2 border rounded">
                              <div class="h6 text-danger" id="pdfPreviewCompetitorCount">-</div>
                              <small class="text-muted">ë™ì¼ì—…ì¢…</small>
                            </div>
                          </div>
                          <div class="col-6">
                            <div class="p-2 border rounded">
                              <div class="h6 text-warning" id="pdfPreviewAdjacentBiz">-</div>
                              <small class="text-muted">ì¸ì ‘ì—…ì²´</small>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <h6>ê²½ìŸ ê°•ë„</h6>
                        <div class="progress mb-2" style="height: 25px;">
                                                     <div id="pdfPreviewCompetitionBar" class="progress-bar" style="width: 0%;"></div>
                        </div>
                        <div class="text-center">
                          <span id="pdfPreviewCompetitionLevel" class="badge fs-6">ë¶„ì„ì¤‘...</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ì™¸êµ­ì¸ ë¶„ì„ -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card border-info">
                  <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                      <i class="bi bi-globe me-2"></i>
                      <span data-lang="KOR">ì™¸êµ­ì¸ ë¶„ì„</span>
                      <span data-lang="ENG" style="display: none;">Foreigner Analysis</span>
                      <span data-lang="ESP" style="display: none;">AnÃ¡lisis de Extranjeros</span>
                    </h5>
                  </div>
                  <div class="card-body">
                    <div class="row g-3 text-center">
                      <div class="col-md-4">
                        <div class="p-3 border rounded">
                          <i class="bi bi-airplane text-primary mb-2" style="font-size: 1.5rem;"></i>
                          <h6>
                            <span data-lang="KOR">ë‹¨ê¸°ì²´ë¥˜ ì™¸êµ­ì¸</span>
                            <span data-lang="ENG" style="display: none;">Short-term Foreigners</span>
                            <span data-lang="ESP" style="display: none;">Extranjeros de Corta Estancia</span>
                          </h6>
                          <div class="h6 text-primary" id="pdfPreviewTempForeign">-</div>
                          <small class="text-muted">
                            <span data-lang="KOR">1000m ë°˜ê²½</span>
                            <span data-lang="ENG" style="display: none;">1000m radius</span>
                            <span data-lang="ESP" style="display: none;">radio de 1000m</span>
                          </small>
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="p-3 border rounded">
                          <i class="bi bi-house text-success mb-2" style="font-size: 1.5rem;"></i>
                          <h6>
                            <span data-lang="KOR">ì¥ê¸°ì²´ë¥˜ ì™¸êµ­ì¸</span>
                            <span data-lang="ENG" style="display: none;">Long-term Foreigners</span>
                            <span data-lang="ESP" style="display: none;">Extranjeros de Larga Estancia</span>
                          </h6>
                          <div class="h6 text-success" id="pdfPreviewLongForeign">-</div>
                          <small class="text-muted">
                            <span data-lang="KOR">300m ë°˜ê²½</span>
                            <span data-lang="ENG" style="display: none;">300m radius</span>
                            <span data-lang="ESP" style="display: none;">radio de 300m</span>
                          </small>
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="p-3 border rounded">
                          <i class="bi bi-flag text-warning mb-2" style="font-size: 1.5rem;"></i>
                          <h6>
                            <span data-lang="KOR">ì¤‘êµ­ì¸ ë¹„ìœ¨</span>
                            <span data-lang="ENG" style="display: none;">Chinese Ratio</span>
                            <span data-lang="ESP" style="display: none;">ProporciÃ³n China</span>
                          </h6>
                          <div class="h6 text-warning" id="pdfPreviewChinaRatio">-</div>
                          <small class="text-muted">
                            <span data-lang="KOR">1000m ë°˜ê²½</span>
                            <span data-lang="ENG" style="display: none;">1000m radius</span>
                            <span data-lang="ESP" style="display: none;">radio de 1000m</span>
                          </small>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë¶„ì„ -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card border-secondary">
                  <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">
                      <i class="bi bi-people me-2"></i>
                      <span data-lang="KOR">ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë¶„ì„ (1000m ë°˜ê²½)</span>
                      <span data-lang="ENG" style="display: none;">Age Group Analysis (1000m radius)</span>
                      <span data-lang="ESP" style="display: none;">AnÃ¡lisis de Grupos de Edad (radio de 1000m)</span>
                    </h5>
                  </div>
                  <div class="card-body">
                    <div class="row g-2 text-center">
                      <div class="col">
                        <div class="p-2 border rounded">
                          <div class="fw-bold text-danger" id="pdfPreviewAge20">-%</div>
                          <small class="text-muted">
                            <span data-lang="KOR">20ëŒ€</span>
                            <span data-lang="ENG" style="display: none;">20s</span>
                            <span data-lang="ESP" style="display: none;">20s</span>
                          </small>
                        </div>
                      </div>
                      <div class="col">
                        <div class="p-2 border rounded">
                          <div class="fw-bold text-primary" id="pdfPreviewAge30">-%</div>
                          <small class="text-muted">
                            <span data-lang="KOR">30ëŒ€</span>
                            <span data-lang="ENG" style="display: none;">30s</span>
                            <span data-lang="ESP" style="display: none;">30s</span>
                          </small>
                        </div>
                      </div>
                      <div class="col">
                        <div class="p-2 border rounded">
                          <div class="fw-bold text-warning" id="pdfPreviewAge40">-%</div>
                          <small class="text-muted">
                            <span data-lang="KOR">40ëŒ€</span>
                            <span data-lang="ENG" style="display: none;">40s</span>
                            <span data-lang="ESP" style="display: none;">40s</span>
                          </small>
                        </div>
                      </div>
                      <div class="col">
                        <div class="p-2 border rounded">
                          <div class="fw-bold text-info" id="pdfPreviewAge50">-%</div>
                          <small class="text-muted">
                            <span data-lang="KOR">50ëŒ€</span>
                            <span data-lang="ENG" style="display: none;">50s</span>
                            <span data-lang="ESP" style="display: none;">50s</span>
                          </small>
                        </div>
                      </div>
                      <div class="col">
                        <div class="p-2 border rounded">
                          <div class="fw-bold text-secondary" id="pdfPreviewAge60">-%</div>
                          <small class="text-muted">
                            <span data-lang="KOR">60ëŒ€+</span>
                            <span data-lang="ENG" style="display: none;">60+</span>
                            <span data-lang="ESP" style="display: none;">60+</span>
                          </small>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- AI ì¶”ì²œ ì—…ì¢… (íšŒì› ì „ìš©) -->
            <div class="row mb-4" id="pdfPreviewBusinessRecommendations" style="display: none;">
              <div class="col-12">
                <div class="card border-success">
                  <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                      <i class="bi bi-star me-2"></i>
                      <span data-lang="KOR">AI ì¶”ì²œ ì—…ì¢… (íšŒì› ì „ìš©)</span>
                      <span data-lang="ENG" style="display: none;">AI Recommended Business Types (Members Only)</span>
                      <span data-lang="ESP" style="display: none;">Tipos de Negocio Recomendados por IA (Solo Miembros)</span>
                    </h5>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <!-- 1ìœ„ ì—…ì¢… (í° ì¹´ë“œ) -->
                      <div class="col-md-6">
                        <div class="card border-warning h-100">
                          <div class="card-body text-center">
                            <div class="badge bg-warning text-dark mb-2 fs-6">
                              ğŸ† 
                              <span data-lang="KOR">1ìœ„</span>
                              <span data-lang="ENG" style="display: none;">1st</span>
                              <span data-lang="ESP" style="display: none;">1Âº</span>
                            </div>
                            <h5 class="card-title text-warning" id="pdfPreviewRecommendedBusinessType">-</h5>
                            <div class="display-6 text-warning mb-2" id="pdfPreviewRecommendedPercentage">-%</div>
                            <div class="progress mb-2" style="height: 10px;">
                              <div class="progress-bar bg-warning" id="pdfPreviewRecommendedProgressBar" style="width: 0%"></div>
                            </div>
                            <small class="text-muted">
                              <span data-lang="KOR">AI ì˜ˆì¸¡ ìƒì¡´í™•ë¥ </span>
                              <span data-lang="ENG" style="display: none;">AI Predicted Survival Rate</span>
                              <span data-lang="ESP" style="display: none;">Tasa de Supervivencia Predicha por IA</span>
                            </small>
                          </div>
                        </div>
                      </div>
                      
                      <!-- 2,3,4ìœ„ ì—…ì¢… (ì‘ì€ ì¹´ë“œë“¤) -->
                      <div class="col-md-6">
                        <div class="row g-2 h-100">
                          <div class="col-12">
                            <div class="card border-light h-100">
                              <div class="card-body p-2 text-center">
                                <div class="badge bg-secondary mb-1">
                                  <span data-lang="KOR">2ìœ„</span>
                                  <span data-lang="ENG" style="display: none;">2nd</span>
                                  <span data-lang="ESP" style="display: none;">2Âº</span>
                                </div>
                                <h6 class="card-title mb-1" id="pdfPreviewRecommended2nd">-</h6>
                                <small class="text-muted" id="pdfPreviewRecommended2ndPercent">-%</small>
                              </div>
                            </div>
                          </div>
                          <div class="col-12">
                            <div class="card border-light h-100">
                              <div class="card-body p-2 text-center">
                                <div class="badge bg-secondary mb-1">
                                  <span data-lang="KOR">3ìœ„</span>
                                  <span data-lang="ENG" style="display: none;">3rd</span>
                                  <span data-lang="ESP" style="display: none;">3Âº</span>
                                </div>
                                <h6 class="card-title mb-1" id="pdfPreviewRecommended3rd">-</h6>
                                <small class="text-muted" id="pdfPreviewRecommended3rdPercent">-%</small>
                              </div>
                            </div>
                          </div>
                          <div class="col-12">
                            <div class="card border-light h-100">
                              <div class="card-body p-2 text-center">
                                <div class="badge bg-secondary mb-1">
                                  <span data-lang="KOR">4ìœ„</span>
                                  <span data-lang="ENG" style="display: none;">4th</span>
                                  <span data-lang="ESP" style="display: none;">4Âº</span>
                                </div>
                                <h6 class="card-title mb-1" id="pdfPreviewRecommended4th">-</h6>
                                <small class="text-muted" id="pdfPreviewRecommended4thPercent">-%</small>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ê°•ì /ì£¼ì˜ì‚¬í•­ -->
            <div class="row mb-4">
              <div class="col-md-6">
                <div class="card border-success h-100">
                  <div class="card-header bg-light">
                    <h6 class="mb-0 text-success">
                      <i class="bi bi-check-circle me-2"></i>
                      <span data-lang="KOR">ê°•ì </span>
                      <span data-lang="ENG" style="display: none;">Strengths</span>
                      <span data-lang="ESP" style="display: none;">Fortalezas</span>
                    </h6>
                  </div>
                  <div class="card-body" id="previewStrengths">
                    <ul class="list-unstyled mb-0"></ul>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card border-warning h-100">
                  <div class="card-header bg-light">
                    <h6 class="mb-0 text-warning">
                      <i class="bi bi-exclamation-triangle me-2"></i>
                      <span data-lang="KOR">ì£¼ì˜ì‚¬í•­</span>
                      <span data-lang="ENG" style="display: none;">Precautions</span>
                      <span data-lang="ESP" style="display: none;">Precauciones</span>
                    </h6>
                  </div>
                  <div class="card-body" id="previewCautions">
                    <ul class="list-unstyled mb-0"></ul>
                  </div>
                </div>
              </div>
            </div>

            <!-- AI ë¶„ì„ ë¦¬í¬íŠ¸ -->
            <div class="row mb-4" id="pdfPreviewAiReport" style="display: none;">
              <div class="col-12">
                <div class="card border-info">
                  <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                      <i class="bi bi-cpu me-2"></i>
                      <span data-lang="KOR">AI ë¶„ì„ ë¦¬í¬íŠ¸</span>
                      <span data-lang="ENG" style="display: none;">AI Analysis Report</span>
                      <span data-lang="ESP" style="display: none;">Informe de AnÃ¡lisis de IA</span>
                    </h5>
                  </div>
                  <div class="card-body">
                    <div id="pdfPreviewAiReportContent" class="ai-report-content" style="line-height: 1.6; font-size: 14px;">
                      <!-- AI ë¶„ì„ ë¦¬í¬íŠ¸ ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <style>
            .ai-report-content h3, .ai-report-content h4, .ai-report-content h5 {
              color: #0d6efd !important;
              margin-top: 1rem;
              margin-bottom: 0.75rem;
            }
            .ai-report-content ul {
              margin-bottom: 1rem;
              padding-left: 1.5rem;
            }
            .ai-report-content li {
              margin-bottom: 0.25rem;
            }
            .ai-report-content .badge {
              font-size: 0.9em;
              margin: 0 2px;
            }
            .ai-report-content p {
              margin-bottom: 0.75rem;
            }
            .ai-report-content strong {
              font-weight: 600;
            }
            </style>
            
            <!-- ë³´ê³ ì„œ í•˜ë‹¨ -->
            <div class="text-center text-muted" style="border-top: 1px solid #dee2e6; padding-top: 20px;">
              <small>
                <span data-lang="KOR">ë³¸ ë³´ê³ ì„œëŠ” AI ê¸°ë°˜ ìƒê¶Œë¶„ì„ ì‹œìŠ¤í…œì— ì˜í•´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</span>
                <span data-lang="ENG" style="display: none;">This report was generated by an AI-based commercial district analysis system.</span>
                <span data-lang="ESP" style="display: none;">Este informe fue generado por un sistema de anÃ¡lisis de distrito comercial basado en IA.</span>
                <br>
                <span data-lang="KOR">ë¶„ì„ ê¸°ì¤€ì¼:</span>
                <span data-lang="ENG" style="display: none;">Analysis Date:</span>
                <span data-lang="ESP" style="display: none;">Fecha de AnÃ¡lisis:</span>
                <span id="previewReportDate"></span>
              </small>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <span data-lang="KOR">ì·¨ì†Œ</span>
            <span data-lang="ENG" style="display: none;">Cancel</span>
            <span data-lang="ESP" style="display: none;">Cancelar</span>
          </button>
          <div class="btn-group">
            <button type="button" class="btn btn-primary" id="downloadPdfBtn" onclick="downloadPDF()">
              <i class="bi bi-download me-2"></i>
              <span data-lang="KOR">ê³ í’ˆì§ˆ PDF (ì´ë¯¸ì§€)</span>
              <span data-lang="ENG" style="display: none;">High Quality PDF (Image)</span>
              <span data-lang="ESP" style="display: none;">PDF de Alta Calidad (Imagen)</span>
            </button>
            <button type="button" class="btn btn-outline-primary" id="downloadLightPdfBtn" onclick="downloadLightweightPDF()">
              <i class="bi bi-file-text me-2"></i>
              <span data-lang="KOR">ê²½ëŸ‰ PDF (í…ìŠ¤íŠ¸)</span>
              <span data-lang="ENG" style="display: none;">Lightweight PDF (Text)</span>
              <span data-lang="ESP" style="display: none;">PDF Ligero (Texto)</span>
            </button>
          </div>
          <button type="button" class="btn btn-primary" id="retryPdfBtn" onclick="downloadPDF()" style="display: none;">
            <i class="bi bi-arrow-clockwise me-2"></i>
            <span data-lang="KOR">ë‹¤ì‹œ ì‹œë„</span>
            <span data-lang="ENG" style="display: none;">Retry</span>
            <span data-lang="ESP" style="display: none;">Reintentar</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ì£¼ì†Œ ê²€ìƒ‰ PIP íŒì—… ëª¨ë‹¬ -->
  <div id="addressSearchModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 10000; pointer-events: none;">
    <div style="position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
      <!-- ëª¨ë‹¬ í—¤ë” -->
      <div style="position: absolute; top: 20px; left: 50%; transform: translateX(-50%); z-index: 10001; background: white; padding: 15px 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 2px solid #0d6efd;">
        <div style="margin: 0; color: #333; text-align: center;">
          <h5 style="margin: 0; margin-bottom: 8px;">
            <i class="bi bi-search me-2 text-primary"></i>
            <span data-lang="KOR">ì£¼ì†Œ ê²€ìƒ‰</span>
            <span data-lang="ENG" style="display: none;">Address Search</span>
            <span data-lang="ESP" style="display: none;">BÃºsqueda de DirecciÃ³n</span>
            <button onclick="closeAddressSearch()" style="float: right; background: none; border: none; font-size: 1.5rem; color: #999; cursor: pointer; margin-left: 20px;">&times;</button>
          </h5>
          <div style="font-size: 0.85rem; color: #dc3545; background: #fff3cd; padding: 8px; border-radius: 4px; border-left: 4px solid #ffc107;">
            <i class="bi bi-exclamation-triangle me-1"></i>
            <strong>
              <span data-lang="KOR">ì„œë¹„ìŠ¤ ì§€ì—­:</span>
              <span data-lang="ENG" style="display: none;">Service Area:</span>
              <span data-lang="ESP" style="display: none;">Ãrea de Servicio:</span>
            </strong> 
            <span data-lang="KOR">ì„œìš¸íŠ¹ë³„ì‹œë§Œ ì§€ì›ë©ë‹ˆë‹¤</span>
            <span data-lang="ENG" style="display: none;">Only Seoul Metropolitan City is supported</span>
            <span data-lang="ESP" style="display: none;">Solo se admite la Ciudad Metropolitana de SeÃºl</span>
          </div>
          
          <!-- ì–¸ì–´ë³„ ì‚¬ìš©ë²• ì•ˆë‚´ -->
          <div style="font-size: 0.8rem; color: #0066cc; background: #e7f3ff; padding: 8px; border-radius: 4px; margin-top: 8px; border-left: 4px solid #0066cc;">
            <div data-lang="KOR">
              <i class="bi bi-info-circle me-1"></i>
              <strong>ê²€ìƒ‰ íŒ:</strong> ë„ë¡œëª…+ë²ˆí˜¸ (ì˜ˆ: íŒêµì—­ë¡œ 166) ë˜ëŠ” ë™ëª…+ë²ˆì§€ (ì˜ˆ: ë°±í˜„ë™ 532)ë¡œ ê²€ìƒ‰í•˜ì„¸ìš”
            </div>
            <div data-lang="ENG" style="display: none;">
              <i class="bi bi-info-circle me-1"></i>
              <strong>Search Tips:</strong> Use Road Name + Number (e.g., Pangyo-ro 166) or District + Address (e.g., Baekhyeon-dong 532)
            </div>
            <div data-lang="ESP" style="display: none;">
              <i class="bi bi-info-circle me-1"></i>
              <strong>Consejos de BÃºsqueda:</strong> Use Nombre de Calle + NÃºmero (ej: Pangyo-ro 166) o Distrito + DirecciÃ³n (ej: Baekhyeon-dong 532)
            </div>
          </div>
        </div>
      </div>
      
      <!-- ì£¼ì†Œ ê²€ìƒ‰ ì»¨í…Œì´ë„ˆ -->
      <div id="addressSearchContainer" style="width: 90%; max-width: 600px; height: 80%; max-height: 500px; background: white; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); margin-top: 60px; z-index: 10002; position: relative; pointer-events: auto;"></div>
      
      <!-- ë‹«ê¸° ë²„íŠ¼ (ë°°ê²½ í´ë¦­) -->
      <div onclick="closeAddressSearch()" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 9998; pointer-events: none; display: none;"></div>
    </div>
  </div>

  <!-- ì±—ë´‡ PIP í™•ëŒ€ ëª¨ë‹¬ (ë™ì  ìƒì„±) -->

  <!-- ì „ì²´ ì—…ì¢… ì¶”ì²œ ëª¨ë‹¬ -->
  <div class="modal fade" id="allRecommendationsModal" tabindex="-1" aria-labelledby="allRecommendationsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="allRecommendationsModalLabel">
            <i class="bi bi-star me-2"></i>
            <span data-lang="KOR">ì „ì²´ ì—…ì¢… ìƒì¡´í™•ë¥  ìˆœìœ„</span>
            <span data-lang="ENG" style="display: none;">All Business Type Survival Rankings</span>
            <span data-lang="ESP" style="display: none;">Ranking de Supervivencia de Todos los Tipos de Negocio</span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row mb-3">
            <div class="col-md-8">
              <div class="alert alert-info">
                <i class="bi bi-info-circle me-2"></i>
                <strong>
                  <span data-lang="KOR">í˜„ì¬ ì…ë ¥í•˜ì‹  ì¡°ê±´(ì£¼ì†Œ, ë©´ì , ì£¼ë¥˜íŒë§¤ì—¬ë¶€)ì„ ê¸°ì¤€ìœ¼ë¡œ</span>
                  <span data-lang="ENG" style="display: none;">Based on the conditions you entered (address, area, alcohol sales)</span>
                  <span data-lang="ESP" style="display: none;">Basado en las condiciones que ingresÃ³ (direcciÃ³n, Ã¡rea, venta de alcohol)</span>
                </strong><br>
                <span data-lang="KOR">ëª¨ë“  ì—…ì¢…ì— ëŒ€í•´ AIê°€ ìƒì¡´í™•ë¥ ì„ ë¶„ì„í•œ ê²°ê³¼ì…ë‹ˆë‹¤.</span>
                <span data-lang="ENG" style="display: none;">AI has analyzed survival probabilities for all business types.</span>
                <span data-lang="ESP" style="display: none;">La IA ha analizado las probabilidades de supervivencia para todos los tipos de negocio.</span>
              </div>
            </div>
            <div class="col-md-4">
              <div class="alert alert-warning">
                <small>
                  <i class="bi bi-exclamation-triangle me-1"></i>
                  <strong>
                    <span data-lang="KOR">ì„ íƒí•˜ì‹  ì—…ì¢…:</span>
                    <span data-lang="ENG" style="display: none;">Selected Business Type:</span>
                    <span data-lang="ESP" style="display: none;">Tipo de Negocio Seleccionado:</span>
                  </strong><br>
                  <span id="currentSelectedBusinessType">-</span>
                  (<span id="currentSelectedSurvivalRate">-%</span>)
                </small>
              </div>
            </div>
          </div>
          
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-primary">
                <tr>
                  <th width="60">
                    <span data-lang="KOR">ìˆœìœ„</span>
                    <span data-lang="ENG" style="display: none;">Rank</span>
                    <span data-lang="ESP" style="display: none;">Rango</span>
                  </th>
                  <th width="200">
                    <span data-lang="KOR">ì—…ì¢…ëª…</span>
                    <span data-lang="ENG" style="display: none;">Business Type</span>
                    <span data-lang="ESP" style="display: none;">Tipo de Negocio</span>
                  </th>
                  <th width="120">
                    <span data-lang="KOR">ìƒì¡´í™•ë¥ </span>
                    <span data-lang="ENG" style="display: none;">Survival Rate</span>
                    <span data-lang="ESP" style="display: none;">Tasa de Supervivencia</span>
                  </th>
                  <th width="200">
                    <span data-lang="KOR">í™•ë¥  ë°”</span>
                    <span data-lang="ENG" style="display: none;">Probability Bar</span>
                    <span data-lang="ESP" style="display: none;">Barra de Probabilidad</span>
                  </th>
                  <th>
                    <span data-lang="KOR">ì„ íƒ ì—…ì¢… ëŒ€ë¹„</span>
                    <span data-lang="ENG" style="display: none;">Compared to Selected</span>
                    <span data-lang="ESP" style="display: none;">Comparado con Seleccionado</span>
                  </th>
                </tr>
              </thead>
              <tbody id="allRecommendationsTableBody">
                <!-- í…Œì´ë¸” ë‚´ìš©ì€ JavaScriptë¡œ ë™ì  ìƒì„± -->
              </tbody>
            </table>
          </div>
          
          <div class="text-center mt-3">
            <small class="text-muted">
              <i class="bi bi-cpu me-1"></i>
              <span data-lang="KOR">XGBoost AI ëª¨ë¸ì„ í†µí•´ ë¶„ì„ëœ ê²°ê³¼ì…ë‹ˆë‹¤.</span>
              <span data-lang="ENG" style="display: none;">Results analyzed through XGBoost AI model.</span>
              <span data-lang="ESP" style="display: none;">Resultados analizados a travÃ©s del modelo XGBoost AI.</span>
            </small>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <span data-lang="KOR">ë‹«ê¸°</span>
            <span data-lang="ENG" style="display: none;">Close</span>
            <span data-lang="ESP" style="display: none;">Cerrar</span>
          </button>
        </div>
      </div>
    </div>
  </div>
  
{% endblock %}  