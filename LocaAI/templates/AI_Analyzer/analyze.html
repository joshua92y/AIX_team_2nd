{% extends 'base.html' %}
{% load static %}

{% block title %}ìƒê¶Œ ë¶„ì„{% endblock %}

{% block content %}


  <!-- AI Analyzer CSS íŒŒì¼ë“¤ -->
  <link rel="stylesheet" href="{% static 'css/ai_analyzer/analyze-base.css' %}">
  <link rel="stylesheet" href="{% static 'css/ai_analyzer/analyze-progress.css' %}">
  <link rel="stylesheet" href="{% static 'css/ai_analyzer/analyze-chatbot.css' %}">
  <link rel="stylesheet" href="{% static 'css/ai_analyzer/analyze-pip.css' %}">

  <!-- Daum ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤ -->
  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  
  <!-- jsPDF ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- í•œêµ­ì–´ í°íŠ¸ ì§€ì› -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf-customfonts@0.0.4/dist/jspdf-customfonts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-customfonts@0.0.4/dist/customfonts.js"></script>
  <!-- html2canvas ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <!-- Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- AI Analyzer Data ë¡œë“œ (ìµœìš°ì„ ) -->
  <script src="{% static 'js/ai_analyzer/analyze-data.js' %}"></script>
  
  <!-- AI Analyzer Utils ë¡œë“œ -->
  <script src="{% static 'js/ai_analyzer/analyze-utils.js' %}"></script>
  
  <!-- AI Analyzer Address ë¡œë“œ -->
  <script src="{% static 'js/ai_analyzer/analyze-address.js' %}"></script>
  
  <!-- AI Analyzer PIP ë¡œë“œ -->
  <script src="{% static 'js/ai_analyzer/analyze-pip.js' %}"></script>
  
  <!-- AI Analyzer PDF ë¡œë“œ -->
  <script src="{% static 'js/ai_analyzer/analyze-pdf.js' %}"></script>
  
  <!-- AI Analyzer Chatbot ë¡œë“œ -->
  <script src="{% static 'js/ai_analyzer/analyze-chatbot.js' %}"></script>
  
  <!-- AI Analyzer Explainable AI ë¡œë“œ (íšŒì›ìš© XGBoost ì„¤ëª…) -->
  <script src="{% static 'js/ai_analyzer/analyze-explainable.js' %}"></script>
  
  <!-- AI Analyzer Core ë¡œë“œ -->
  <script src="{% static 'js/ai_analyzer/analyze-core.js' %}"></script>

    <script>
    // Django í…œí”Œë¦¿ì—ì„œ JavaScript ë³€ìˆ˜ë¡œ ì‚¬ìš©ì ì¸ì¦ ìƒíƒœ ì „ë‹¬
    const USER_AUTHENTICATED = {% if user.is_authenticated %}true{% else %}false{% endif %};
    const USER_ID = {% if user.is_authenticated %}'{{ user.id }}'{% else %}null{% endif %};
    const CSRF_TOKEN = '{{ csrf_token }}';
  </script>

  <script>
    window.currentAnalysisData = null;
    let currentRequestId = null;
    
    $(document).ready(function() {
      // ì´ˆê¸°í™”
      $('.result-section').hide();
      $('#analysisResults').hide();
      
      // PIP ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” ë™ì  ìƒì„± ì‹œ ì¶”ê°€ë¨
    });

    $(window).on('load', function() {
      _eventBind();
    });

    // í˜ì´ì§€ ë‚´ ì´ë²¤íŠ¸ ë°”ì¸ë”©
    function _eventBind() {
      // ëª¨ë“ˆ ë¡œë“œ í›„ ì±—ë´‡ ì´ˆê¸°í™” (ì§€ì—° ì‹¤í–‰)
      setTimeout(function() {
        // ì±—ë´‡ ì´ˆê¸° ìƒíƒœ ì„¤ì •
        if (typeof window.initializeChatbotState === 'function') {
          window.initializeChatbotState();
        }
        
        // WebSocket ì´ˆê¸°í™” (ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œ)
        if (USER_AUTHENTICATED && typeof window.initializeChatSocket === 'function') {
          window.initializeChatSocket();
        }
      }, 100);
    }

    // ===========================================
    // ëª¨ë“  ì£¼ìš” ê¸°ëŠ¥ë“¤ì€ ë‹¤ìŒ ëª¨ë“ˆë“¤ì—ì„œ ë¡œë“œë¨:
    // - analyze-core.js: ìƒê¶Œë¶„ì„ ë©”ì¸ ë¡œì§
    // - analyze-chatbot.js: ì±—ë´‡ ë° WebSocket  
    // - analyze-pip.js: PIP ëª¨ë‹¬ ê´€ë¦¬
    // - analyze-pdf.js: PDF ìƒì„±
    // - analyze-address.js: ì£¼ì†Œ ê²€ìƒ‰
    // - analyze-utils.js: ê³µí†µ ìœ í‹¸ë¦¬í‹°
    // ===========================================
    
    // ì „ì—­ ë³€ìˆ˜ ì„ ì–¸
    // ... existing code ...
  </script>

  <!-- Page Title -->
  <div class="container my-6" style="margin-top: 20px; margin-bottom: 100px; ">
    
    <!-- ìƒê¶Œ ë¶„ì„ ì •ë³´ ì…ë ¥ -->
    <div class="row">
      <div class="col-lg-12 mb-4">
        <div class="card p-4 shadow-sm">
          <h3 class="mb-3">
            <span data-lang="KOR">ìƒê¶Œ ì •ë³´ì…ë ¥</span>
            <span data-lang="ENG" style="display: none;">Enter Commercial Area Info</span>
            <span data-lang="ESP" style="display: none;">Ingresar InformaciÃ³n del Ãrea Comercial</span>
          </h3>

          <form>
            <div class="row g-3">
              <!-- ì—…ì¢… ì„ íƒ -->
              <div class="col-md-3">
                <label for="business_type_id" class="form-label">
                  <span data-lang="KOR">ì—…ì¢…</span>
                  <span data-lang="ENG" style="display: none;">Industry</span>
                  <span data-lang="ESP" style="display: none;">Industria</span>
                </label>
                <select class="form-select" id="business_type_id" name="business_type_id" required>
                  <!-- ì—…ì¢… ì˜µì…˜ì€ analyze-data.jsì—ì„œ ë™ì  ìƒì„± -->
                </select>
                
                <!-- ì˜ì–´/ìŠ¤í˜ì¸ì–´ ì—…ì¢… ì„ íƒì€ analyze-data.jsì—ì„œ ë™ì  ì²˜ë¦¬ -->
              </div>

              <!-- ì£¼ì†Œ ì…ë ¥ -->
              <div class="col-md-3">
                <input type="hidden" id="latitude" name="latitude">
                <input type="hidden" id="longitude" name="longitude">
                <input type="hidden" id="x_coord" name="x_coord">
                <input type="hidden" id="y_coord" name="y_coord">
                
                <label for="address" class="form-label" data-lang="KOR">ì£¼ì†Œ</label>
                <label for="address" class="form-label" data-lang="ENG" style="display: none;">Address</label>
                <label for="address" class="form-label" data-lang="ESP" style="display: none;">DirecciÃ³n</label>
                
                <div class="input-group">
                  <input type="text" class="form-control lang-input" id="address" name="address" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" data-lang="KOR">
                  <button class="btn btn-outline-secondary lang-btn" type="button" onclick="openAddressSearch()" data-lang="KOR">ê²€ìƒ‰</button>
                  
                  <input type="text" class="form-control lang-input" id="addressEng" name="address" placeholder="Please enter your address" data-lang="ENG" style="display: none;">
                  <button class="btn btn-outline-secondary lang-btn" type="button" onclick="openAddressSearch()" data-lang="ENG" style="display: none;">Search</button>
                  
                  <input type="text" class="form-control lang-input" id="addressEsp" name="address" placeholder="Por favor ingrese la direcciÃ³n" data-lang="ESP" style="display: none;">
                  <button class="btn btn-outline-secondary lang-btn" type="button" onclick="openAddressSearch()" data-lang="ESP" style="display: none;">Buscar</button>
                </div>
              </div>

              <!-- ì í¬ ë©´ì  ì…ë ¥ -->
              <div class="col-md-3">
                <label for="area" class="form-label" data-lang="KOR">ì í¬ ë©´ì  (ã¡)</label>
                <label for="area" class="form-label" data-lang="ENG" style="display: none;">Store Area (ã¡)</label>
                <label for="area" class="form-label" data-lang="ESP" style="display: none;">Ãrea del local (ã¡)</label>
                <input type="number" class="form-control" id="area" name="area" placeholder="ì˜ˆ: 33.2" required>
              </div>

              <!-- ì£¼ë¥˜ íŒë§¤ ì—¬ë¶€ ì„ íƒ -->
              <div class="col-md-3">
                <label for="service_type" class="form-label">ì£¼ë¥˜ íŒë§¤ ì—¬ë¶€</label>
                <select class="form-select" id="service_type" name="service_type" required>
                  <option selected disabled>ì„ íƒ</option>
                  <option value="1">íŒë§¤í•¨</option>
                  <option value="0">íŒë§¤ ì•ˆí•¨</option>
                </select>
              </div>
            </div>

            <!-- ë²„íŠ¼ -->
            <div class="text-center mt-4">
              <button type="button" class="btn btn-primary custom px-5" onclick="getFormData();">
                ìƒê¶Œ ë¶„ì„í•˜ê¸°
              </button>
            </div>
          </form>

        </div>
      </div>
    </div>  <!-- ìƒê¶Œ ì •ë³´ ì…ë ¥ ì¹´ë“œ ë -->

    <!-- ğŸ“ ìµœê·¼ ë¶„ì„ ê²°ê³¼ (ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œ) -->
    {% if user.is_authenticated %}
    <div class="row mt-5">
      <div class="col-lg-12">
        <div class="accordion mb-4" id="analysisHistoryAccordion">
          <div class="accordion-item shadow-sm">
            <h2 class="accordion-header" id="analysisHistoryHeading">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#analysisHistoryCollapse" aria-expanded="false" aria-controls="analysisHistoryCollapse">
                <i class="bi bi-person-check me-2"></i>
                <strong>
                  <span data-lang="KOR">ğŸ“ ë‚´ ìµœê·¼ ë¶„ì„ ê¸°ë¡</span>
                  <span data-lang="ENG" style="display: none;">ğŸ“ My Recent Analyses</span>
                  <span data-lang="ESP" style="display: none;">ğŸ“ Mis anÃ¡lisis recientes</span>
                </strong>
                <small class="text-muted ms-2">({{ user.username }}ë‹˜ì˜ ê°œì¸ ê¸°ë¡{% if previous_docs %} - {{ previous_docs|length }}ê°œ{% endif %})</small>
              </button>
            </h2>
            <div id="analysisHistoryCollapse" class="accordion-collapse collapse" aria-labelledby="analysisHistoryHeading" data-bs-parent="#analysisHistoryAccordion">
              <div class="accordion-body">
          {% if previous_docs %}
                  <ul class="list-group list-group-flush">
              {% for doc in previous_docs %}
                      <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                  <div>
                          <strong>ë¶„ì„ ID: {{ doc.request.id }}</strong>
                          <span class="badge bg-{% if doc.survival_percentage >= 80 %}success{% elif doc.survival_percentage >= 60 %}warning{% else %}danger{% endif %} ms-2">
                            {{ doc.survival_percentage|floatformat:1 }}%
                          </span>
                          <br>
                          <small class="text-muted">
                            <i class="bi bi-geo-alt me-1"></i>{{ doc.request.address|truncatechars:50 }}
                          </small><br>
                          <small class="text-muted">
                            <i class="bi bi-calendar me-1"></i>{{ doc.created_at|date:"Y-m-d H:i" }}
                            <i class="bi bi-shop ms-3 me-1"></i>{{ doc.request.business_type.name }}
                          </small>
                  </div>
                        <button class="btn btn-sm btn-outline-primary" onclick="showPdfPreview({{ doc.request.id }})">
                          <i class="bi bi-eye me-1"></i>ê²°ê³¼ë³´ê¸°
                        </button>
                </li>
              {% endfor %}
            </ul>
                  {% if previous_docs|length > 5 %}
                    <div class="text-center mt-3">
                      <small class="text-muted">ìµœê·¼ {{ previous_docs|length }}ê°œ ê¸°ë¡ ì¤‘ ì¼ë¶€ë§Œ í‘œì‹œë©ë‹ˆë‹¤.</small>
                    </div>
                  {% endif %}
          {% else %}
                  <div class="text-center p-3">
                    <i class="bi bi-folder2-open text-muted" style="font-size: 3rem;"></i>
                    <p class="text-muted mt-2">ì•„ì§ ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    <p class="text-muted small">ìœ„ì˜ ì–‘ì‹ì„ ì‘ì„±í•˜ì—¬ ì²« ë²ˆì§¸ ìƒê¶Œ ë¶„ì„ì„ ì‹œì‘í•´ë³´ì„¸ìš”!</p>
                  </div>
          {% endif %}
        </div>
      </div>
    </div>
        </div>
      </div>
    </div>
    {% else %}
    <!-- ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìë¥¼ ìœ„í•œ ì•ˆë‚´ -->
    <div class="row mt-5">
      <div class="col-lg-12">
        <div class="card p-4 shadow-sm mb-4 border-warning">
          <h4 class="mb-3 text-warning">
            <i class="bi bi-person-x me-2"></i>ê°œì¸ ë¶„ì„ ê¸°ë¡
          </h4>
          <div class="text-center p-3">
            <i class="bi bi-lock text-warning" style="font-size: 3rem;"></i>
            <p class="text-muted mt-2">ë¶„ì„ ê¸°ë¡ì„ ë³´ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
            <a href="{% url 'custom_auth:login' %}?next={{ request.get_full_path }}" class="btn btn-warning">
              <i class="bi bi-box-arrow-in-right me-1"></i>ë¡œê·¸ì¸í•˜ê¸°
            </a>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

  
    <!-- ë³¸ë¬¸: ë¶„ì„ ê²°ê³¼ + ì±—ë´‡ -->
    <div class="row">
      <!-- ì™¼ìª½: ë¶„ì„ ë¦¬í¬íŠ¸ -->
      <div class="col-lg-8 mb-4 analysis-container">
        <div class="card p-4 shadow-sm">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h4 class="mb-0">
              <span data-lang="KOR">ìƒê¶Œ ë¶„ì„ ê²°ê³¼</span>
              <span data-lang="ENG" style="display: none;">Commercial Area Analysis Result</span>
              <span data-lang="ESP" style="display: none;">Resultado del AnÃ¡lisis Comercial</span>
            </h4>
            <!-- ëª¨ë‹¬ ë²„íŠ¼ -->
            <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#explanationModal">
              <span data-lang="KOR">ìƒê¶Œ ë¶„ì„ ë„ì›€ë§</span>
              <span data-lang="ENG" style="display: none;">Commercial Analysis Guide</span>
              <span data-lang="ESP" style="display: none;">GuÃ­a de AnÃ¡lisis Comercial</span>
            </button>
            
            <!-- Bootstrap ëª¨ë‹¬ -->
            <div class="modal fade" id="explanationModal" tabindex="-1" aria-labelledby="explanationModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="explanationModalLabel">
                      <span data-lang="KOR">ìƒê¶Œ ë¶„ì„ì´ë€ ë¬´ì—‡ì¸ê°€?</span>
                      <span data-lang="ENG" style="display: none;">What is Commercial Area Analysis?</span>
                      <span data-lang="ESP" style="display: none;">Â¿QuÃ© es el AnÃ¡lisis de Zona Comercial?</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
                  </div>
                  <div class="modal-body">
                    <div data-lang="KOR">
                      ìƒê¶Œë¶„ì„ì€ íŠ¹ì • ì§€ì—­ ë‚´ ì í¬ë‚˜ ì‚¬ì—…ì¥ì˜ ê²½ì œì  í™˜ê²½ê³¼ ì†Œë¹„ì íŠ¹ì„±ì„ ì²´ê³„ì ìœ¼ë¡œ ì¡°ì‚¬í•˜ì—¬<br>
                      ì‚¬ì—… ì„±ê³µ ê°€ëŠ¥ì„±ì„ ë†’ì´ê¸° ìœ„í•œ ì¤‘ìš”í•œ ê³¼ì •ì…ë‹ˆë‹¤.<br><br>
              
                      <strong>ì™œ ìƒê¶Œë¶„ì„ì´ í•„ìš”í•œê°€ìš”?</strong><br>
                      - ìƒê¶Œì˜ ì†Œë¹„ íŒ¨í„´ê³¼ ìœ ë™ ì¸êµ¬ë¥¼ íŒŒì•…í•˜ì—¬ íš¨ìœ¨ì ì¸ ë§ˆì¼€íŒ… ì „ëµì„ ì„¸ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                      - ê²½ìŸ ì—…ì²´ í˜„í™©ê³¼ ê³ ê° ìˆ˜ìš”ë¥¼ ë¶„ì„í•´ ì ì ˆí•œ ì…ì§€ì™€ ì„œë¹„ìŠ¤ë¥¼ ê²°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                      - íˆ¬ì ìœ„í—˜ì„ ìµœì†Œí™”í•˜ê³  ì•ˆì •ì ì¸ ë§¤ì¶œì„ ê¸°ëŒ€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br><br>
              
                      <strong>AI ê¸°ë°˜ ìƒê¶Œë¶„ì„ì€ ë‹¤ìŒì„ ì œê³µí•©ë‹ˆë‹¤:</strong><br>
                      - ì í¬ì˜ ìƒì¡´ í™•ë¥  ì˜ˆì¸¡<br>
                      - SHAP ìš”ì¸ ë¶„ì„<br><br>
              
                      ì„±ê³µì ì¸ ì°½ì—…ê³¼ ìš´ì˜ì„ ìœ„í•´<br>
                      ì •í™•í•œ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì „ëµì„ ì„¸ì›Œë³´ì„¸ìš”!
                    </div>
                    
                    <div data-lang="ENG" style="display: none;">
                      Commercial area analysis is an important process that systematically investigates the economic environment and consumer characteristics of stores or businesses in a specific area to increase the chances of business success.<br><br>
              
                      <strong>Why is commercial area analysis necessary?</strong><br>
                      - You can identify consumption patterns and foot traffic in the commercial area to establish efficient marketing strategies.<br>
                      - You can analyze competitor status and customer demand to determine appropriate location and services.<br>
                      - You can minimize investment risks and expect stable sales.<br><br>
              
                      <strong>AI-based commercial area analysis provides:</strong><br>
                      - Store survival probability prediction<br>
                      - SHAP factor analysis<br><br>
              
                      For successful startup and operation,<br>
                      develop strategies based on accurate information!
                    </div>
                    
                    <div data-lang="ESP" style="display: none;">
                      El anÃ¡lisis de zona comercial es un proceso importante que investiga sistemÃ¡ticamente el entorno econÃ³mico y las caracterÃ­sticas del consumidor de tiendas o negocios en un Ã¡rea especÃ­fica para aumentar las posibilidades de Ã©xito empresarial.<br><br>
              
                      <strong>Â¿Por quÃ© es necesario el anÃ¡lisis de zona comercial?</strong><br>
                      - Puede identificar patrones de consumo y trÃ¡fico peatonal en la zona comercial para establecer estrategias de marketing eficientes.<br>
                      - Puede analizar el estado de la competencia y la demanda del cliente para determinar la ubicaciÃ³n y servicios apropiados.<br>
                      - Puede minimizar los riesgos de inversiÃ³n y esperar ventas estables.<br><br>
              
                      <strong>El anÃ¡lisis de zona comercial basado en IA proporciona:</strong><br>
                      - PredicciÃ³n de probabilidad de supervivencia de la tienda<br>
                      - AnÃ¡lisis de factores SHAP<br><br>
              
                      Para una startup y operaciÃ³n exitosa,<br>
                      Â¡desarrolle estrategias basadas en informaciÃ³n precisa!
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                      <span data-lang="KOR">ë‹«ê¸°</span>
                      <span data-lang="ENG" style="display: none;">Close</span>
                      <span data-lang="ESP" style="display: none;">Cerrar</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- ë¶„ì„ ëŒ€ê¸° ë©”ì‹œì§€ -->
          <div id="analysisWaiting">
            <div class="text-center p-4">
              <i class="bi bi-analytics text-muted" style="font-size: 3rem;"></i>
              <h5 class="mt-3 text-muted">ìƒê¶Œ ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”</h5>
              <p class="text-muted">
                <span data-lang="KOR">
                  ìœ„ì˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  'ìƒê¶Œ ë¶„ì„í•˜ê¸°' ë²„íŠ¼ì„ í´ë¦­í•˜ë©´<br>ì´ ì˜ì—­ì— ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                </span>
                <span data-lang="ENG" style="display: none;">
                  Enter the information above and click the 'Analyze Commercial Area' button<br>to display analysis results in this area.
                </span>
                <span data-lang="ESP" style="display: none;">
                  Ingrese la informaciÃ³n anterior y haga clic en el botÃ³n 'Analizar Zona Comercial'<br>para mostrar los resultados del anÃ¡lisis en esta Ã¡rea.
                </span>
              </p>
              <button class="btn btn-outline-secondary mt-3" disabled>
                <i class="bi bi-file-earmark-pdf me-2"></i>
                <span data-lang="KOR">PDFë¡œ ì €ì¥</span>
                <span data-lang="ENG" style="display: none;">Save as PDF</span>
                <span data-lang="ESP" style="display: none;">Guardar como PDF</span>
              </button>
            </div>
          </div>
          
          <!-- ë¶„ì„ ì§„í–‰ ìƒí™© UI (ì»´í¬ë„ŒíŠ¸ include) -->
          {% include 'AI_Analyzer/components/progress_steps.html' %}
          
          <!-- ë¶„ì„ ê²°ê³¼ ë‚´ìš© (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) -->
          <div id="analysisResults" style="display: none;">
            
            <!-- ìœ„ì¹˜ ì •ë³´ -->
            <div class="alert alert-info mb-4">
              <div class="row align-items-center">
                <div class="col-md-8">
                  <h5 class="mb-2">
                    <i class="bi bi-geo-alt-fill me-2"></i>
                    <span id="resultAddress"></span>
                  </h5>
                  <div class="row">
                    <div class="col-md-4">
                      <strong>ì—…ì¢…:</strong> <span id="resultBusinessType"></span>
                    </div>
                    <div class="col-md-4">
                      <strong>ë©´ì :</strong> <span id="resultArea"></span>ã¡
                    </div>
                    <div class="col-md-4">
                      <strong>ìœ í˜•:</strong> <span id="resultServiceType"></span>
                    </div>
                  </div>
                </div>
                <div class="col-md-4 text-end">
                  <small class="text-muted">ë¶„ì„ì™„ë£Œ</small>
                </div>
              </div>
            </div>

            <!-- í•µì‹¬ ì§€í‘œ -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3">
                <i class="bi bi-speedometer me-2"></i>
                <span data-lang="KOR">í•µì‹¬ ì§€í‘œ</span>
                <span data-lang="ENG" style="display: none;">Key Indicators</span>
                <span data-lang="ESP" style="display: none;">Indicadores Clave</span>
              </h5>
              <div class="row g-3">
                <div class="col-md-3">
                  <div class="card border text-center" style="background-color: white; border-color: #dee2e6;">
                    <div class="card-body">
                      <h3 id="lifePop300" class="fw-bold" style="color: #1e3a8a;">-</h3>
                      <small style="color: #1e3a8a;">
                        <span data-lang="KOR">300m ë‚´ ìƒí™œì¸êµ¬</span>
                        <span data-lang="ENG" style="display: none;">Resident Pop. within 300m</span>
                        <span data-lang="ESP" style="display: none;">Pobl. Residente dentro de 300m</span>
                      </small>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card border text-center" style="background-color: white; border-color: #dee2e6;">
                    <div class="card-body">
                      <h3 id="workingPop300" class="fw-bold" style="color: #1e3a8a;">-</h3>
                      <small style="color: #1e3a8a;">300m ë‚´ ì§ì¥ì¸êµ¬</small>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card border text-center" style="background-color: white; border-color: #dee2e6;">
                    <div class="card-body">
                      <h3 id="competitor300" class="fw-bold" style="color: #1e3a8a;">-</h3>
                      <small style="color: #1e3a8a;">ë™ì¼ì—…ì¢… ê²½ìŸì—…ì²´</small>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card border text-center" style="background-color: white; border-color: #dee2e6;">
                    <div class="card-body">
                      <h3 id="totalLandValue" class="fw-bold" style="color: #1e3a8a;">-</h3>
                      <small style="color: #1e3a8a;">ì´ ê³µì‹œì§€ê°€</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- AI ì˜ˆì¸¡ ìƒì¡´ í™•ë¥  -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3">
                <i class="bi bi-cpu me-2"></i>AI ì˜ˆì¸¡ ë¶„ì„
              </h5>
              <div class="row align-items-center">
                <div class="col-md-6">
                  <div class="text-center">
                    <div class="display-1 fw-bold mb-3" id="survivalPercentage">-%</div>
                    <h4 class="mb-3">ì¥ê¸° ìƒì¡´ í™•ë¥ </h4>
                    <div class="progress" style="height: 25px;">
                      <div id="survivalBar" class="progress-bar" style="width: 0%; transition: width 0.6s ease;"></div>
                    </div>
                    <div class="mt-2">
                      <span id="survivalBarText" class="badge fs-6" style="font-size: 1rem; font-weight: 500;">ë¶„ì„ì¤‘...</span>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="p-3">
                    <h6 class="mb-3">AI ë¶„ì„ ê²°ê³¼</h6>
                    <div id="survivalAnalysis" class="alert">
                      <!-- AI ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                    <small class="text-muted">
                      <i class="bi bi-info-circle me-1"></i>
                      AI ëª¨ë¸ì´ 25ê°œ ì§€í‘œë¥¼ ì¢…í•© ë¶„ì„í•œ ê²°ê³¼ì…ë‹ˆë‹¤.
                    </small>
                  </div>
                </div>
              </div>
            </div>

            <!-- ìƒê¶Œ ê²½ìŸ ë¶„ì„ -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3">
                <i class="bi bi-shop me-2"></i>ìƒê¶Œ ê²½ìŸ ë¶„ì„ (300m ë°˜ê²½)
              </h5>
              <div class="row g-3 text-center">
                <div class="col-md-3">
                  <h6>ê²½ìŸì—…ì²´ ìˆ˜</h6>
                  <div class="h4 text-danger" id="competitorCount">-</div>
                </div>
                <div class="col-md-3">
                  <h6>ì „ì²´ ìš”ì‹ì—…ì²´</h6>
                  <div class="h4 text-info" id="adjacentBiz">-</div>
                </div>
                <div class="col-md-3">
                  <h6>ê²½ìŸì—…ì²´ ë¹„ìœ¨</h6>
                  <div class="h4 text-warning" id="competitorRatio">-%</div>
                </div>
                <div class="col-md-3">
                  <h6>ì—…ì¢… ë‹¤ì–‘ì„±</h6>
                  <div class="h4 text-success" id="businessDiversity">-</div>
                </div>
              </div>
              
              <div class="mt-4">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <h6 class="mb-0">ê²½ìŸ ê°•ë„ ë¶„ì„</h6>
                  <span id="competitionLevel" class="badge fs-6" style="font-size: 1.1rem; font-weight: 500;">ë¶„ì„ì¤‘...</span>
                  </div>
                <div class="progress" style="height: 40px;">
                  <div id="competitionBar" class="progress-bar" style="width: 0%; transition: width 0.6s ease;"></div>
                </div>
                <small class="text-muted mt-2 d-block">
                  ê²½ìŸì—…ì²´ ë¹„ìœ¨ì´ 20% ì´í•˜ë©´ ë‚®ìŒ, 20-50%ëŠ” ë³´í†µ, 50% ì´ìƒì€ ë†’ìŒìœ¼ë¡œ ë¶„ë¥˜ë©ë‹ˆë‹¤.
                </small>
              </div>
            </div>

            <!-- ì¸êµ¬ êµ¬ì„± ë¶„ì„ -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3">
                <i class="bi bi-people me-2"></i>ì¸êµ¬ êµ¬ì„± ë¶„ì„ (1000m ë°˜ê²½)
              </h5>
              <div class="row">
                <div class="col-md-6">
                  <div class="card h-100">
                    <div class="card-body text-center">
                      <h6 class="card-title mb-3">ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë¹„ìœ¨</h6>
                      <div style="position: relative; height: 300px; width: 100%;">
                        <canvas id="ageChart" style="max-height: 300px; max-width: 100%;"></canvas>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card h-100">
                    <div class="card-body">
                      <h6 class="card-title mb-3">ì—°ë ¹ëŒ€ë³„ ìƒì„¸ ì •ë³´</h6>
                      <div class="row g-2">
                        <div class="col-6">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #FF6384;" id="age20Percent">-%</div>
                            <small class="text-muted">20ëŒ€</small>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #36A2EB;" id="age30Percent">-%</div>
                            <small class="text-muted">30ëŒ€</small>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #FFCE56;" id="age40Percent">-%</div>
                            <small class="text-muted">40ëŒ€</small>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #4BC0C0;" id="age50Percent">-%</div>
                            <small class="text-muted">50ëŒ€</small>
                          </div>
                        </div>
                        <div class="col-12">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #9966FF;" id="age60Percent">-%</div>
                            <small class="text-muted">60ëŒ€ ì´ìƒ</small>
                          </div>
                        </div>
                      </div>
                      <div class="mt-3 text-center">
                        <small class="text-muted">
                          <i class="bi bi-info-circle me-1"></i>
                          1000m ë°˜ê²½ ë‚´ ìƒí™œì¸êµ¬ ê¸°ì¤€
                        </small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ì™¸êµ­ì¸ ë¶„ì„ -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3">
                <i class="bi bi-globe me-2"></i>ì™¸êµ­ì¸ ë¶„ì„
              </h5>
              <div class="row g-3 text-center">
                <div class="col-md-4">
                  <div class="card h-100">
                    <div class="card-body">
                      <i class="bi bi-airplane text-primary mb-2" style="font-size: 2rem;"></i>
                      <h6>ë‹¨ê¸°ì²´ë¥˜ ì™¸êµ­ì¸</h6>
                      <div class="h4 text-primary" id="tempForeign1000">-</div>
                      <small class="text-muted">1000m ë°˜ê²½</small>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card h-100">
                    <div class="card-body">
                      <i class="bi bi-house text-success mb-2" style="font-size: 2rem;"></i>
                      <h6>ì¥ê¸°ì²´ë¥˜ ì™¸êµ­ì¸</h6>
                      <div class="h4 text-success" id="longForeign300">-</div>
                      <small class="text-muted">300m ë°˜ê²½</small>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card h-100">
                    <div class="card-body">
                      <i class="bi bi-flag text-warning mb-2" style="font-size: 2rem;"></i>
                      <h6>ì¥ê¸°ì²´ë¥˜ ì¤‘êµ­ì¸ ë¹„ìœ¨</h6>
                      <div class="h4 text-warning" id="longForeignCNRatio300">-</div>
                      <small class="text-muted">1000m ë°˜ê²½</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ë¶„ì„ ìš”ì•½ -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3">
                <i class="bi bi-lightbulb me-2"></i>AI ë¶„ì„ ìš”ì•½
              </h5>
              <div class="row">
                <div class="col-md-6">
                  <h6 class="text-success">
                    <i class="bi bi-check-circle me-2"></i>ê°•ì 
                  </h6>
                  <ul id="strengthsList">
                    <!-- ê°•ì  ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                  </ul>
                </div>
                <div class="col-md-6">
                  <h6 class="text-warning">
                    <i class="bi bi-exclamation-triangle me-2"></i>ì£¼ì˜ì‚¬í•­
                  </h6>
                  <ul id="cautionsList">
                    <!-- ì£¼ì˜ì‚¬í•­ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                  </ul>
                </div>
              </div>
            </div>

            <!-- PDF ì €ì¥ ë²„íŠ¼ -->
            <div class="text-center">
              <button id="pdfSaveBtn" class="btn btn-primary" onclick="generatePDF()">
                <i class="bi bi-file-earmark-pdf me-2"></i>PDFë¡œ ì €ì¥
              </button>
              <div id="guestPdfMessage" style="display: none;" class="alert alert-info mt-3">
                <i class="bi bi-info-circle me-2"></i>
                <strong>ë¹„íšŒì› ì œí•œ:</strong> PDF ì €ì¥ ê¸°ëŠ¥ì€ íšŒì›ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
                <a href="{% url 'custom_auth:login' %}?next={{ request.get_full_path }}" class="btn btn-sm btn-outline-primary ms-2">ë¡œê·¸ì¸í•˜ê¸°</a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½: ë¶„ì„ê²°ê³¼ ì±—ë´‡ -->
      <div class="col-lg-4">
        <div class="card p-4 shadow-sm chatbot-sticky" style="height: 750px; max-height: 750px; overflow: hidden;">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">ë¶„ì„ê²°ê³¼ ìƒë‹´</h5>
            <span class="badge bg-secondary" id="chatbotStatus">ëŒ€ê¸°ì¤‘</span>
          </div>
          
          <!-- ì±—ë´‡ ì»¨í…Œì´ë„ˆ -->
          <div id="chatbotContainer" class="d-flex flex-column h-100">
            
            <!-- ë¹„í™œì„±í™” ìƒíƒœ (ê¸°ë³¸) - ê°„ë‹¨í•œ ì•ˆë‚´ë§Œ -->
            <div id="chatbotInactive" class="text-center d-flex flex-column justify-content-center h-100">
              <i class="bi bi-chat-dots text-muted mb-3" style="font-size: 4rem;"></i>
              <h5 class="text-muted mb-3">ë¶„ì„ê²°ê³¼ ìƒë‹´ AI</h5>
              {% if not user.is_authenticated %}
                <p class="text-muted mb-3">ìƒê¶Œ ë¶„ì„ ê²°ê³¼ì— ëŒ€í•´<br>AIì™€ ìƒë‹´í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
                <a href="{% url 'custom_auth:login' %}?next={{ request.get_full_path }}" class="btn btn-primary btn-sm">
                  <i class="bi bi-box-arrow-in-right me-2"></i>ë¡œê·¸ì¸í•˜ê¸°
                </a>
              {% else %}
                <p class="text-muted mb-3">ìƒê¶Œ ë¶„ì„ì„ ì™„ë£Œí•˜ë©´<br>AI ìƒë‹´ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                <div class="d-flex align-items-center justify-content-center">
                  <i class="bi bi-lock me-2 text-secondary"></i>
                  <span class="text-secondary small">ë¶„ì„ ì™„ë£Œ í›„ ìë™ í™œì„±í™”</span>
                </div>
              {% endif %}
          </div>

            <!-- í™œì„±í™” ìƒíƒœ (ë¶„ì„ ì™„ë£Œ í›„) - ì™„ì „í•œ ì±—ë´‡ UI -->
            <div id="chatbotActive" class="d-flex flex-column h-100" style="display: none !important;">
              
              <!-- ì¶”ì²œ ì§ˆë¬¸ ë²„íŠ¼ -->
              <div class="mb-3">
                <small class="text-muted">ğŸ’¡ ì¶”ì²œ ì§ˆë¬¸</small>
                <div class="mt-2">
                  <button class="btn btn-sm btn-outline-primary me-1 mb-1" onclick="fillExampleQuestion('ì´ ìƒê¶Œì˜ ìƒì¡´ í™•ë¥ ì´ ë†’ì€ ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€ìš”?')">
                    <i class="bi bi-graph-up me-1"></i>ìƒì¡´ í™•ë¥ 
                  </button>
                  <button class="btn btn-sm btn-outline-warning me-1 mb-1" onclick="fillExampleQuestion('ê²½ìŸì—…ì²´ê°€ ë§ì€ í¸ì¸ê°€ìš”?')">
                    <i class="bi bi-shop me-1"></i>ê²½ìŸ í˜„í™©
                  </button>
                  <button class="btn btn-sm btn-outline-success me-1 mb-1" onclick="fillExampleQuestion('ì°½ì—… ì‹œ ì£¼ì˜í•´ì•¼ í•  ì ì€ ë¬´ì—‡ì¸ê°€ìš”?')">
                    <i class="bi bi-exclamation-triangle me-1"></i>ì£¼ì˜ì‚¬í•­
                  </button>
                </div>
          </div>

              <!-- ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ -->
              <div id="chatMessages" class="flex-grow-1 overflow-auto mb-3 border rounded p-3" style="background-color: #f8f9fa; min-height: 420px;">
                <div class="d-flex align-items-start mb-3">
                  <div class="bg-gradient bg-primary rounded-circle me-2 d-flex align-items-center justify-content-center" style="width: 36px; height: 36px; min-width: 36px;">
                    <i class="bi bi-robot text-white" style="font-size: 16px;"></i>
        </div>
                  <div class="flex-grow-1">
                    <div class="bg-white rounded-3 p-3 shadow-sm border">
                      <div class="d-flex align-items-center mb-2">
                        <strong class="text-primary me-2">ë¶„ì„ê²°ê³¼ ìƒë‹´ AI</strong>
                        <span class="badge bg-success-subtle text-success">ì˜¨ë¼ì¸</span>
                      </div>
                      <p class="mb-0">ì•ˆë…•í•˜ì„¸ìš”! ğŸ¯ ë°©ê¸ˆ ì™„ë£Œëœ ìƒê¶Œ ë¶„ì„ ê²°ê³¼ì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë¬¼ì–´ë³´ì„¸ìš”.<br><br>
                      <strong>ìƒë‹´ ê°€ëŠ¥í•œ ë‚´ìš©:</strong><br>
                      â€¢ ğŸ“Š AI ìƒì¡´ í™•ë¥  í•´ì„<br>
                      â€¢ ğŸ‘¥ ì¸êµ¬ ë° ê³ ê°ì¸µ ë¶„ì„<br>
                      â€¢ ğŸª ê²½ìŸì—…ì²´ í˜„í™©<br>
                      â€¢ ğŸ’° ìˆ˜ìµì„± ì „ë§<br>
                      â€¢ ğŸš€ ì°½ì—… ì „ëµ ì¡°ì–¸</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ì…ë ¥ ì˜ì—­ -->
              <div class="mt-auto">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <small class="text-muted">
                    <i class="bi bi-shield-check me-1"></i>
                    í˜„ì¬ ë¶„ì„ ì„¸ì…˜ ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹µë³€
                  </small>
                  <button class="btn btn-sm btn-outline-secondary" onclick="openChatbotPIP()" title="í™•ëŒ€ ë³´ê¸°">
                    <i class="bi bi-arrows-fullscreen"></i>
                  </button>
                </div>
                <div class="input-group">
                  <input type="text" id="chatInput" class="form-control" placeholder="ë¶„ì„ ê²°ê³¼ì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì„ ë¬¼ì–´ë³´ì„¸ìš”..." disabled>
                  <button class="btn btn-primary" id="chatSendBtn" type="button" disabled>
                    <i class="bi bi-send-fill"></i>
                  </button>
                </div>
                <div id="chatConnectionStatus" class="mt-2" style="display: none;">
                  <small class="text-primary">
                    <span class="spinner-border spinner-border-sm me-1" role="status"></span>
                    AI ì—°ê²° ì¤‘...
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PDF ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ (ë¶„ì„ ê¸°ë¡ìš©) -->
  <div class="modal fade" id="pdfPreviewModal" tabindex="-1" aria-labelledby="pdfPreviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="pdfPreviewModalLabel">
            <i class="bi bi-file-earmark-pdf me-2"></i>ë¶„ì„ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
          <div id="previewLoading" class="text-center">
            <div class="spinner-border text-primary mb-3" role="status">
              <span class="visually-hidden">ë¡œë”© ì¤‘...</span>
            </div>
            <h6>ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</h6>
            <p class="text-muted">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</p>
          </div>
          
          <div id="previewError" style="display: none;" class="text-center">
            <i class="bi bi-exclamation-triangle text-warning mb-3" style="font-size: 3rem;"></i>
            <h6>ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h6>
            <p class="text-muted" id="previewErrorMessage">ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</p>
          </div>
          
          <!-- PDF ìŠ¤íƒ€ì¼ ë¯¸ë¦¬ë³´ê¸° ë‚´ìš© -->
          <div id="previewContent" style="display: none; background: white; padding: 30px; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); font-family: 'Nanum Gothic', Arial, sans-serif;">
            <!-- í—¤ë” -->
            <div class="text-center mb-4" style="border-bottom: 3px solid #1e3a8a; padding-bottom: 20px;">
              <h2 class="text-primary mb-1" style="font-weight: 800; font-size: 24px;">AI ìƒê¶Œë¶„ì„ ë³´ê³ ì„œ</h2>
              <p class="text-muted mb-0" style="font-size: 14px;">ì¸ê³µì§€ëŠ¥ ê¸°ë°˜ ìƒì—…ì§€êµ¬ ë¶„ì„ ê²°ê³¼</p>
            </div>
            
            <!-- ê¸°ë³¸ ì •ë³´ -->
            <div class="mb-4" style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #1e3a8a;">
              <h5 class="text-primary mb-3"><i class="bi bi-geo-alt me-2"></i>ë¶„ì„ ëŒ€ìƒ ì •ë³´</h5>
              <div class="row">
                <div class="col-md-6">
                  <p><strong>ì£¼ì†Œ:</strong> <span id="previewAddr">-</span></p>
                  <p><strong>ì—…ì¢…:</strong> <span id="previewBizType">-</span></p>
                </div>
                <div class="col-md-6">
                  <p><strong>ë©´ì :</strong> <span id="previewAreaSize">-</span>ã¡</p>
                  <p><strong>ë¶„ì„ì¼ì‹œ:</strong> <span id="previewAnalysisDate">-</span></p>
                </div>
              </div>
            </div>
            
            <!-- AI ìƒì¡´ í™•ë¥  -->
            <div class="mb-4" style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
              <h5 class="text-success mb-3"><i class="bi bi-robot me-2"></i>AI ìƒì¡´ í™•ë¥ </h5>
              <div class="display-4 mb-3 text-primary" id="previewSurvivalRate" style="font-weight: 800;">-%</div>
              <div class="progress mb-3" style="height: 20px;">
                <div class="progress-bar" id="previewSurvivalProgressBar" role="progressbar" style="width: 0%"></div>
              </div>
              <p class="text-muted mb-0" id="previewSurvivalComment">ë¶„ì„ ì¤‘...</p>
            </div>
            
            <!-- í•µì‹¬ ì§€í‘œ -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3"><i class="bi bi-speedometer me-2"></i>í•µì‹¬ ì§€í‘œ</h5>
              <div class="row">
                <div class="col-md-3">
                  <div class="card border-info h-100 text-center">
                    <div class="card-body">
                      <i class="bi bi-people text-info mb-2" style="font-size: 2rem;"></i>
                      <h6 class="card-title">ìƒí™œì¸êµ¬</h6>
                      <p class="card-text fw-bold text-primary" id="previewLifePopulation">-</p>
                      <small class="text-muted">300m ë°˜ê²½</small>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card border-warning h-100 text-center">
                    <div class="card-body">
                      <i class="bi bi-briefcase text-warning mb-2" style="font-size: 2rem;"></i>
                      <h6 class="card-title">ì§ì¥ì¸êµ¬</h6>
                      <p class="card-text fw-bold text-primary" id="previewWorkingPopulation">-</p>
                      <small class="text-muted">300m ë°˜ê²½</small>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card border-danger h-100 text-center">
                    <div class="card-body">
                      <i class="bi bi-shop text-danger mb-2" style="font-size: 2rem;"></i>
                      <h6 class="card-title">ê²½ìŸì—…ì²´</h6>
                      <p class="card-text fw-bold text-primary" id="previewCompetitors">-</p>
                      <small class="text-muted">300m ë°˜ê²½</small>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card border-secondary h-100 text-center">
                    <div class="card-body">
                      <i class="bi bi-currency-dollar text-secondary mb-2" style="font-size: 2rem;"></i>
                      <h6 class="card-title">ê³µì‹œì§€ê°€</h6>
                      <p class="card-text fw-bold text-primary" id="previewLandPrice">-</p>
                      <small class="text-muted">ì´ ê³µì‹œì§€ê°€</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- ê²½ìŸê°•ë„ ë¶„ì„ -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3"><i class="bi bi-shop me-2"></i>ê²½ìŸê°•ë„ ë¶„ì„</h5>
              <div class="row">
                <div class="col-md-6">
                  <div class="card h-100">
                    <div class="card-body">
                      <h6 class="card-title">ê²½ìŸì—…ì²´ í˜„í™©</h6>
                      <div class="row g-2 text-center">
                        <div class="col-6">
                          <div class="p-2 border rounded">
                            <div class="h5 text-danger" id="previewCompetitorCount">-</div>
                            <small class="text-muted">ë™ì¼ì—…ì¢…</small>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="p-2 border rounded">
                            <div class="h5 text-warning" id="previewAdjacentBiz">-</div>
                            <small class="text-muted">ì¸ì ‘ì—…ì²´</small>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card h-100">
                    <div class="card-body">
                      <h6 class="card-title">ê²½ìŸ ê°•ë„</h6>
                      <div class="progress mb-2" style="height: 30px;">
                                                 <div id="previewCompetitionBar" class="progress-bar" style="width: 0%;"></div>
                      </div>
                      <div class="text-center">
                        <span id="previewCompetitionLevel" class="badge fs-6">ë¶„ì„ì¤‘...</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ì™¸êµ­ì¸ ë¶„ì„ -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3"><i class="bi bi-globe me-2"></i>ì™¸êµ­ì¸ ë¶„ì„</h5>
              <div class="row g-3 text-center">
                <div class="col-md-4">
                  <div class="card h-100">
                    <div class="card-body">
                      <i class="bi bi-airplane text-primary mb-2" style="font-size: 1.5rem;"></i>
                      <h6>ë‹¨ê¸°ì²´ë¥˜ ì™¸êµ­ì¸</h6>
                      <div class="h5 text-primary" id="previewTempForeign">-</div>
                      <small class="text-muted">1000m ë°˜ê²½</small>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card h-100">
                    <div class="card-body">
                      <i class="bi bi-house text-success mb-2" style="font-size: 1.5rem;"></i>
                      <h6>ì¥ê¸°ì²´ë¥˜ ì™¸êµ­ì¸</h6>
                      <div class="h5 text-success" id="previewLongForeign">-</div>
                      <small class="text-muted">300m ë°˜ê²½</small>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card h-100">
                    <div class="card-body">
                      <i class="bi bi-flag text-warning mb-2" style="font-size: 1.5rem;"></i>
                      <h6>ì¤‘êµ­ì¸ ë¹„ìœ¨</h6>
                      <div class="h5 text-warning" id="previewChinaRatio">-</div>
                      <small class="text-muted">1000m ë°˜ê²½</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë¶„ì„ -->
            <div class="mb-4">
              <h5 class="text-primary border-bottom border-primary pb-2 mb-3"><i class="bi bi-people me-2"></i>ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë¶„ì„ (1000m ë°˜ê²½)</h5>
              <div class="row">
                <div class="col-md-6">
                  <div class="card h-100">
                    <div class="card-body text-center">
                      <h6 class="card-title mb-3">ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë¹„ìœ¨</h6>
                      <div style="position: relative; height: 250px; width: 100%;">
                        <canvas id="previewAgeChart" style="max-height: 250px; max-width: 100%;"></canvas>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card h-100">
                    <div class="card-body">
                      <h6 class="card-title mb-3">ì—°ë ¹ëŒ€ë³„ ìƒì„¸ ì •ë³´</h6>
                      <div class="row g-2">
                        <div class="col-6">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #FF6384;" id="previewAge20">-%</div>
                            <small class="text-muted">20ëŒ€</small>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #36A2EB;" id="previewAge30">-%</div>
                            <small class="text-muted">30ëŒ€</small>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #FFCE56;" id="previewAge40">-%</div>
                            <small class="text-muted">40ëŒ€</small>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #4BC0C0;" id="previewAge50">-%</div>
                            <small class="text-muted">50ëŒ€</small>
                          </div>
                        </div>
                        <div class="col-12">
                          <div class="text-center p-2 border rounded">
                            <div class="fw-bold" style="color: #9966FF;" id="previewAge60">-%</div>
                            <small class="text-muted">60ëŒ€ ì´ìƒ</small>
                          </div>
                        </div>
                      </div>
                      <div class="mt-3 text-center">
                        <small class="text-muted">
                          <i class="bi bi-info-circle me-1"></i>
                          1000m ë°˜ê²½ ë‚´ ìƒí™œì¸êµ¬ ê¸°ì¤€
                        </small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- ê°•ì /ì£¼ì˜ì‚¬í•­ -->
            <div class="row mb-4">
              <div class="col-md-6">
                <div class="card border-success h-100">
                  <div class="card-header bg-light">
                    <h6 class="mb-0 text-success"><i class="bi bi-check-circle me-2"></i>ê°•ì </h6>
                  </div>
                  <div class="card-body" id="previewStrengthsList">
                    <ul class="list-unstyled mb-0">
                      <li class="text-muted">ë¶„ì„ ì¤‘...</li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card border-warning h-100">
                  <div class="card-header bg-light">
                    <h6 class="mb-0 text-warning"><i class="bi bi-exclamation-triangle me-2"></i>ì£¼ì˜ì‚¬í•­</h6>
                  </div>
                  <div class="card-body" id="previewCautionsList">
                    <ul class="list-unstyled mb-0">
                      <li class="text-muted">ë¶„ì„ ì¤‘...</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- ë³´ê³ ì„œ í•˜ë‹¨ -->
            <div class="text-center text-muted" style="border-top: 1px solid #dee2e6; padding-top: 20px;">
              <small>
                ë³¸ ë³´ê³ ì„œëŠ” AI ê¸°ë°˜ ìƒê¶Œë¶„ì„ ì‹œìŠ¤í…œì— ì˜í•´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
                ë¶„ì„ ê¸°ì¤€ì¼: <span id="previewReportGeneratedDate"></span>
              </small>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
          <div class="btn-group">
            <button type="button" class="btn btn-primary" id="previewDownloadPdfBtn" onclick="downloadPreviewPDF()" style="display: none;">
              <i class="bi bi-download me-2"></i>ê³ í’ˆì§ˆ PDF (ì´ë¯¸ì§€)
            </button>
            <button type="button" class="btn btn-outline-primary" id="previewDownloadLightPdfBtn" onclick="downloadPreviewLightweightPDF()" style="display: none;">
              <i class="bi bi-file-text me-2"></i>ê²½ëŸ‰ PDF (í…ìŠ¤íŠ¸)
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PDF ë‹¤ìš´ë¡œë“œ ëª¨ë‹¬ -->
  <div class="modal fade" id="pdfModal" tabindex="-1" aria-labelledby="pdfModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="pdfModalLabel">
            <i class="bi bi-file-earmark-pdf me-2"></i>AI ìƒê¶Œë¶„ì„ ë³´ê³ ì„œ ë¯¸ë¦¬ë³´ê¸°
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="pdfGenerating" style="display: none;" class="text-center">
            <div class="spinner-border text-primary mb-3" role="status">
              <span class="visually-hidden">ìƒì„± ì¤‘...</span>
            </div>
            <h6>PDF ë³´ê³ ì„œë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</h6>
            <p class="text-muted">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</p>
          </div>
          
          <div id="pdfError" style="display: none;" class="text-center">
            <i class="bi bi-exclamation-triangle text-warning mb-3" style="font-size: 3rem;"></i>
            <h6>PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h6>
            <p class="text-muted" id="pdfErrorMessage">ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</p>
          </div>
          
          <!-- PDF ë¯¸ë¦¬ë³´ê¸° ë‚´ìš© -->
          <div id="pdfPreviewContainer" style="background: white; padding: 30px; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <div class="text-center mb-4">
              <h2 class="text-primary mb-1" style="font-weight: 700;">AI ìƒê¶Œë¶„ì„ ë³´ê³ ì„œ</h2>
              <p class="text-muted mb-0">ì¸ê³µì§€ëŠ¥ ê¸°ë°˜ ìƒì—…ì§€êµ¬ ë¶„ì„ ê²°ê³¼</p>
              <hr class="my-3" style="border-color: #1e3a8a; border-width: 2px;">
            </div>
            
            <!-- ê¸°ë³¸ ì •ë³´ -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card border-primary">
                  <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-geo-alt me-2"></i>ë¶„ì„ ëŒ€ìƒ ì •ë³´</h5>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-6">
                        <p><strong>ì£¼ì†Œ:</strong> <span id="previewAddress">-</span></p>
                        <p><strong>ì—…ì¢…:</strong> <span id="previewBusinessType">-</span></p>
                      </div>
                      <div class="col-md-6">
                        <p><strong>ë©´ì :</strong> <span id="previewArea">-</span></p>
                        <p><strong>ë¶„ì„ì¼ì‹œ:</strong> <span id="previewDate">-</span></p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- AI ìƒì¡´ í™•ë¥  -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card border-success">
                  <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-robot me-2"></i>AI ìƒì¡´ í™•ë¥ </h5>
                  </div>
                  <div class="card-body text-center">
                    <div class="display-4 mb-3" id="previewSurvival">-%</div>
                    <div class="progress mb-3" style="height: 20px;">
                      <div class="progress-bar" id="previewSurvivalBar" role="progressbar" style="width: 0%"></div>
                    </div>
                    <p class="text-muted mb-0" id="previewSurvivalText">ë¶„ì„ ì¤‘...</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- í•µì‹¬ ì§€í‘œ -->
            <div class="row mb-4">
              <div class="col-md-3">
                <div class="card border-info h-100">
                  <div class="card-body text-center">
                    <i class="bi bi-people text-info mb-2" style="font-size: 2rem;"></i>
                    <h6 class="card-title">ìƒí™œì¸êµ¬</h6>
                    <p class="card-text fw-bold" id="previewLifePop">-</p>
                    <small class="text-muted">300m ë°˜ê²½</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card border-warning h-100">
                  <div class="card-body text-center">
                    <i class="bi bi-briefcase text-warning mb-2" style="font-size: 2rem;"></i>
                    <h6 class="card-title">ì§ì¥ì¸êµ¬</h6>
                    <p class="card-text fw-bold" id="previewWorkingPop">-</p>
                    <small class="text-muted">300m ë°˜ê²½</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card border-danger h-100">
                  <div class="card-body text-center">
                    <i class="bi bi-shop text-danger mb-2" style="font-size: 2rem;"></i>
                    <h6 class="card-title">ê²½ìŸì—…ì²´</h6>
                    <p class="card-text fw-bold" id="previewCompetitor">-</p>
                    <small class="text-muted">300m ë°˜ê²½</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card border-secondary h-100">
                  <div class="card-body text-center">
                    <i class="bi bi-currency-dollar text-secondary mb-2" style="font-size: 2rem;"></i>
                    <h6 class="card-title">ê³µì‹œì§€ê°€</h6>
                    <p class="card-text fw-bold" id="previewLandValue">-</p>
                    <small class="text-muted">ì´ ê³µì‹œì§€ê°€</small>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- ê²½ìŸê°•ë„ ë¶„ì„ -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card border-warning">
                  <div class="card-header bg-warning text-white">
                    <h5 class="mb-0"><i class="bi bi-shop me-2"></i>ê²½ìŸê°•ë„ ë¶„ì„</h5>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-6">
                        <h6>ê²½ìŸì—…ì²´ í˜„í™©</h6>
                        <div class="row g-2 text-center mb-3">
                          <div class="col-6">
                            <div class="p-2 border rounded">
                              <div class="h6 text-danger" id="pdfPreviewCompetitorCount">-</div>
                              <small class="text-muted">ë™ì¼ì—…ì¢…</small>
                            </div>
                          </div>
                          <div class="col-6">
                            <div class="p-2 border rounded">
                              <div class="h6 text-warning" id="pdfPreviewAdjacentBiz">-</div>
                              <small class="text-muted">ì¸ì ‘ì—…ì²´</small>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <h6>ê²½ìŸ ê°•ë„</h6>
                        <div class="progress mb-2" style="height: 25px;">
                                                     <div id="pdfPreviewCompetitionBar" class="progress-bar" style="width: 0%;"></div>
                        </div>
                        <div class="text-center">
                          <span id="pdfPreviewCompetitionLevel" class="badge fs-6">ë¶„ì„ì¤‘...</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ì™¸êµ­ì¸ ë¶„ì„ -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card border-info">
                  <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-globe me-2"></i>ì™¸êµ­ì¸ ë¶„ì„</h5>
                  </div>
                  <div class="card-body">
                    <div class="row g-3 text-center">
                      <div class="col-md-4">
                        <div class="p-3 border rounded">
                          <i class="bi bi-airplane text-primary mb-2" style="font-size: 1.5rem;"></i>
                          <h6>ë‹¨ê¸°ì²´ë¥˜ ì™¸êµ­ì¸</h6>
                          <div class="h6 text-primary" id="pdfPreviewTempForeign">-</div>
                          <small class="text-muted">1000m ë°˜ê²½</small>
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="p-3 border rounded">
                          <i class="bi bi-house text-success mb-2" style="font-size: 1.5rem;"></i>
                          <h6>ì¥ê¸°ì²´ë¥˜ ì™¸êµ­ì¸</h6>
                          <div class="h6 text-success" id="pdfPreviewLongForeign">-</div>
                          <small class="text-muted">300m ë°˜ê²½</small>
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="p-3 border rounded">
                          <i class="bi bi-flag text-warning mb-2" style="font-size: 1.5rem;"></i>
                          <h6>ì¤‘êµ­ì¸ ë¹„ìœ¨</h6>
                          <div class="h6 text-warning" id="pdfPreviewChinaRatio">-</div>
                          <small class="text-muted">1000m ë°˜ê²½</small>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë¶„ì„ -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card border-secondary">
                  <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0"><i class="bi bi-people me-2"></i>ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë¶„ì„ (1000m ë°˜ê²½)</h5>
                  </div>
                  <div class="card-body">
                    <div class="row g-2 text-center">
                      <div class="col">
                        <div class="p-2 border rounded">
                          <div class="fw-bold text-danger" id="pdfPreviewAge20">-%</div>
                          <small class="text-muted">20ëŒ€</small>
                        </div>
                      </div>
                      <div class="col">
                        <div class="p-2 border rounded">
                          <div class="fw-bold text-primary" id="pdfPreviewAge30">-%</div>
                          <small class="text-muted">30ëŒ€</small>
                        </div>
                      </div>
                      <div class="col">
                        <div class="p-2 border rounded">
                          <div class="fw-bold text-warning" id="pdfPreviewAge40">-%</div>
                          <small class="text-muted">40ëŒ€</small>
                        </div>
                      </div>
                      <div class="col">
                        <div class="p-2 border rounded">
                          <div class="fw-bold text-info" id="pdfPreviewAge50">-%</div>
                          <small class="text-muted">50ëŒ€</small>
                        </div>
                      </div>
                      <div class="col">
                        <div class="p-2 border rounded">
                          <div class="fw-bold text-secondary" id="pdfPreviewAge60">-%</div>
                          <small class="text-muted">60ëŒ€+</small>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- ê°•ì /ì£¼ì˜ì‚¬í•­ -->
            <div class="row mb-4">
              <div class="col-md-6">
                <div class="card border-success h-100">
                  <div class="card-header bg-light">
                    <h6 class="mb-0 text-success"><i class="bi bi-check-circle me-2"></i>ê°•ì </h6>
                  </div>
                  <div class="card-body" id="previewStrengths">
                    <ul class="list-unstyled mb-0"></ul>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card border-warning h-100">
                  <div class="card-header bg-light">
                    <h6 class="mb-0 text-warning"><i class="bi bi-exclamation-triangle me-2"></i>ì£¼ì˜ì‚¬í•­</h6>
                  </div>
                  <div class="card-body" id="previewCautions">
                    <ul class="list-unstyled mb-0"></ul>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- ë³´ê³ ì„œ í•˜ë‹¨ -->
            <div class="text-center text-muted" style="border-top: 1px solid #dee2e6; padding-top: 20px;">
              <small>
                ë³¸ ë³´ê³ ì„œëŠ” AI ê¸°ë°˜ ìƒê¶Œë¶„ì„ ì‹œìŠ¤í…œì— ì˜í•´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
                ë¶„ì„ ê¸°ì¤€ì¼: <span id="previewReportDate"></span>
              </small>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
          <div class="btn-group">
            <button type="button" class="btn btn-primary" id="downloadPdfBtn" onclick="downloadPDF()">
              <i class="bi bi-download me-2"></i>ê³ í’ˆì§ˆ PDF (ì´ë¯¸ì§€)
            </button>
            <button type="button" class="btn btn-outline-primary" id="downloadLightPdfBtn" onclick="downloadLightweightPDF()">
              <i class="bi bi-file-text me-2"></i>ê²½ëŸ‰ PDF (í…ìŠ¤íŠ¸)
            </button>
          </div>
          <button type="button" class="btn btn-primary" id="retryPdfBtn" onclick="downloadPDF()" style="display: none;">
            <i class="bi bi-arrow-clockwise me-2"></i>ë‹¤ì‹œ ì‹œë„
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ì£¼ì†Œ ê²€ìƒ‰ PIP íŒì—… ëª¨ë‹¬ -->
  <div id="addressSearchModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 10000; pointer-events: none;">
    <div style="position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
      <!-- ëª¨ë‹¬ í—¤ë” -->
      <div style="position: absolute; top: 20px; left: 50%; transform: translateX(-50%); z-index: 10001; background: white; padding: 10px 20px; border-radius: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h5 style="margin: 0; color: #333;">
          <i class="bi bi-search me-2"></i>ì£¼ì†Œ ê²€ìƒ‰
          <button onclick="closeAddressSearch()" style="float: right; background: none; border: none; font-size: 1.5rem; color: #999; cursor: pointer; margin-left: 20px;">&times;</button>
        </h5>
      </div>
      
      <!-- ì£¼ì†Œ ê²€ìƒ‰ ì»¨í…Œì´ë„ˆ -->
      <div id="addressSearchContainer" style="width: 90%; max-width: 600px; height: 80%; max-height: 500px; background: white; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); margin-top: 60px; z-index: 10002; position: relative; pointer-events: auto;"></div>
      
      <!-- ë‹«ê¸° ë²„íŠ¼ (ë°°ê²½ í´ë¦­) -->
      <div onclick="closeAddressSearch()" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 9998; pointer-events: none; display: none;"></div>
    </div>
  </div>

  <!-- ì±—ë´‡ PIP í™•ëŒ€ ëª¨ë‹¬ (ë™ì  ìƒì„±) -->
  
{% endblock %}  